(()=>{var u=(Math.random()*1e4).toString().substr(0,4),c,a,l,i,r=!0,t=new Peer(u),d=document.getElementById("localVideo"),o=document.getElementById("remoteVideo"),f=document.getElementById("callButton"),g=document.getElementById("answer"),v=document.getElementById("camera"),E=document.getElementById("mic"),p=document.getElementById("camSwitch"),b=document.getElementById("hangUp"),y=document.getElementById("toggleFullScreen"),B=document.getElementById("input"),k=document.getElementById("number"),L=document.getElementById("text"),T=document.getElementById("send"),h=document.getElementById("chat"),w=document.getElementsByClassName("messaging-area")[0];function I(e){d.classList.add("small"),o.classList.add("active"),o.srcObject=e,w.classList.add("visiable"),b.classList.add("visiable"),y.classList.add("visiable"),v.classList.add("visiable"),p.classList.add("visiable"),E.classList.add("visiable"),d.srcObject=c}window.onload=async()=>{c=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0})};var j=document.createTextNode(u);k.appendChild(j);p.addEventListener("click",async()=>{r=!r,d.srcObject.getTracks().forEach(e=>{e.stop()}),c=await navigator.mediaDevices.getUserMedia({audio:!0,video:{facingMode:r?"user":"environment"}}),d.srcObject=c});v.addEventListener("click",()=>{a.getVideoTracks()[0].enabled=!a.getVideoTracks()[0].enabled});E.addEventListener("click",async()=>{a.getAuduiTracks()[0].enabled=!a.getAudioTracks()[0].enabled});y.addEventListener("click",()=>O());function O(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}T.addEventListener("click",()=>{let e=document.createElement("P"),n=document.createTextNode(L.value);e.appendChild(n),h.appendChild(e),e.classList.add("sent"),i.send(L.value)});b.addEventListener("click",()=>{l.close(),t.disconnect(),t.destroy(),d.srcObject=null,o.srcObject=null});f.onclick=()=>{d.srcObject=c,l=t.call(B.value,c,{sdpTransform:e=>{}}),l.on("stream",I),i=t.connect(B.value)};t.on("call",e=>{let n=document.createElement("H2"),s=document.createTextNode(`The ID ${e.peer} is calling...`);n.appendChild(s),document.body.appendChild(n),g.classList.add("visiable"),g.addEventListener("click",()=>{e.answer(c,{sdpTransform:m=>{}}),n.remove(),e.on("stream",I),i=t.connect(e.peer)})});t.on("connection",function(e){e.on("open",function(){e.on("data",function(n){let s=document.createElement("P"),m=document.createTextNode(n);s.appendChild(m),h.appendChild(s),s.classList.add("received")})})});t.on("disconnected",()=>{t.destroy(),d.srcObject=null,o.srcObject=null});})();

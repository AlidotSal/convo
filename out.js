(()=>{var g=(Math.random()*1e4).toString().substr(0,4),s,a,i,r;var t=new Peer(g,{config:{iceServers:[{urls:"stun:stun.zadarma.com:3478"}],sdpSemantics:"unified-plan"}}),d=document.getElementById("localVideo"),o=document.getElementById("remoteVideo"),p=document.getElementById("callButton"),m=document.getElementById("answer"),v=document.getElementById("camera"),E=document.getElementById("mic"),b=document.getElementById("hangUp"),h=document.getElementById("toggleFullScreen"),y=document.getElementById("input"),I=document.getElementById("number"),u=document.getElementById("text"),T=document.getElementById("send"),B=document.getElementById("chat"),k=document.getElementsByClassName("messaging-area")[0];function L(e){d.classList.add("small"),o.classList.add("active"),o.srcObject=e,p.classList.remove("visiable"),m.classList.remove("visiable"),k.classList.add("visiable"),b.classList.add("visiable"),h.classList.add("visiable"),v.classList.add("visiable"),E.classList.add("visiable"),d.srcObject=s}window.onload=async()=>{try{s=await navigator.mediaDevices.getUserMedia({audio:!0,video:{width:{exact:480},height:{exact:360}}})}catch(e){let c;switch(e.toString()){case"NotFoundError: Requested device not found":c="Your Device Doesnt Have The Required Equipment.";break;case"NotAllowedError: Permission denied":c="You didnt allowed the permission, please refresh the page and confirm the permission.";break;default:c="Something Went Wrong, Please Try Again.";break}Swal.fire({title:"Error!",text:c})}};var S=document.createTextNode(g);I.appendChild(S);v.addEventListener("click",()=>{a.getVideoTracks()[0].enabled=!a.getVideoTracks()[0].enabled});E.addEventListener("click",async()=>{a.getAuduiTracks()[0].enabled=!a.getAudioTracks()[0].enabled});h.addEventListener("click",()=>x());function x(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}T.addEventListener("click",()=>{let e=document.createElement("P"),n=document.createElement("SPAN"),c=document.createTextNode(u.value);n.appendChild(c),e.appendChild(n),B.appendChild(e),e.classList.add("sent"),r.send(JSON.stringify(u.value)),u.value=""});b.addEventListener("click",()=>{i.close(),t.disconnect(),t.destroy(),d.srcObject=null,o.srcObject=null});p.onclick=()=>{d.srcObject=s,i=t.call(y.value,s,{sdpTransform:e=>{}}),i.on("stream",L),r=t.connect(y.value)};t.on("call",e=>{let n=document.createElement("H2"),c=document.createTextNode(`The ID ${e.peer} is calling...`);n.appendChild(c),document.body.appendChild(n),m.classList.add("visiable"),m.addEventListener("click",()=>{e.answer(s,{sdpTransform:l=>{}}),n.remove(),e.on("stream",L),r=t.connect(e.peer)})});t.on("connection",function(e){e.on("open",function(){e.on("data",function(n){let c=document.createElement("P"),l=document.createElement("SPAN"),f=document.createTextNode(JSON.parse(n));l.appendChild(f),c.appendChild(l),B.appendChild(c),c.classList.add("received")})})});t.on("disconnected",()=>{s.getTracks().forEach(e=>e.stop()),t.destroy(),d.srcObject=null,o.srcObject=null});})();

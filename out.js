(()=>{var i=(Math.random()*1e4).toString().substr(0,4),c,s,m,l=!0,t=new Peer(i),d=document.getElementById("localVideo"),n=document.getElementById("remoteVideo"),E=document.getElementById("callButton"),p=document.getElementById("answer"),y=document.getElementById("camera"),B=document.getElementById("mic"),v=document.getElementById("camSwitch"),b=document.getElementById("hangUp"),I=document.getElementById("toggleFullScreen"),u=document.getElementById("input"),h=document.getElementById("number"),k=document.getElementById("text"),f=document.getElementById("send"),T=document.getElementById("chat");function g(e){d.classList.add("small"),n.classList.add("active"),n.srcObject=e}window.onload=async()=>{c=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0})};var w=document.createTextNode(i);h.appendChild(w);v.addEventListener("click",async()=>{l=!l,d.srcObject.getTracks().forEach(e=>{e.stop()}),c=await navigator.mediaDevices.getUserMedia({audio:!0,video:{facingMode:l?"user":"environment"}}),d.srcObject=c});y.addEventListener("click",()=>{n.getVideoTracks()[0].enabled=!n.getVideoTracks()[0].enabled});B.addEventListener("click",async()=>{n.getAuduiTracks()[0].enabled=!n.getAudioTracks()[0].enabled});I.addEventListener("click",()=>j());function j(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}E.onclick=()=>{d.srcObject=c,s=t.call(u.value,c,{sdpTransform:e=>{}}),s.on("stream",g),m=t.connect(u.value)};t.on("call",e=>{let o=document.createElement("H2"),a=document.createTextNode(`The ID ${e.peer} is calling...`);o.appendChild(a),document.body.appendChild(o),p.addEventListener("click",()=>{e.answer(c,{sdpTransform:r=>{}}),d.srcObject=c,e.on("stream",g)})});t.on("open",function(e){e.on("data",function(o){let a=document.createElement("P"),r=document.createTextNode(o);a.appendChild(r),T.appendChild(a)}),f.addEventListener("click",()=>{m.send(k.value)})});b.addEventListener("click",()=>{s.close(),t.disconnect(),t.destroy(),d.srcObject=null,n.srcObject=null});t.on("disconnected",()=>{t.disconnect(),t.destroy(),d.srcObject=null,n.srcObject=null});})();

(()=>{var wf=Object.create;var Qi=Object.defineProperty;var bf=Object.getOwnPropertyDescriptor;var _f=Object.getOwnPropertyNames;var Ef=Object.getPrototypeOf,If=Object.prototype.hasOwnProperty;var Tf=e=>Qi(e,"__esModule",{value:!0});var Sf=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Af=(e,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of _f(t))!If.call(e,r)&&r!=="default"&&Qi(e,r,{get:()=>t[r],enumerable:!(n=bf(t,r))||n.enumerable});return e},Df=e=>Af(Tf(Qi(e!=null?wf(Ef(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var Aa=Sf((ig,Tr)=>{var sa,aa,ua,ca,ha,la,fa,da,pa,Er,Wi,va,ya,ga,je,ma,wa,ba,_a,Ea,Ia,Ta,Sa,Ir;(function(e){var t=typeof global=="object"?global:typeof self=="object"?self:typeof this=="object"?this:{};typeof define=="function"&&define.amd?define("tslib",["exports"],function(r){e(n(t,n(r)))}):typeof Tr=="object"&&typeof Tr.exports=="object"?e(n(t,n(Tr.exports))):e(n(t));function n(r,i){return r!==t&&(typeof Object.create=="function"?Object.defineProperty(r,"__esModule",{value:!0}):r.__esModule=!0),function(o,s){return r[o]=i?i(o,s):s}}})(function(e){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])};sa=function(r,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");t(r,i);function o(){this.constructor=r}r.prototype=i===null?Object.create(i):(o.prototype=i.prototype,new o)},aa=Object.assign||function(r){for(var i,o=1,s=arguments.length;o<s;o++){i=arguments[o];for(var a in i)Object.prototype.hasOwnProperty.call(i,a)&&(r[a]=i[a])}return r},ua=function(r,i){var o={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&i.indexOf(s)<0&&(o[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(r);a<s.length;a++)i.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(r,s[a])&&(o[s[a]]=r[s[a]]);return o},ca=function(r,i,o,s){var a=arguments.length,u=a<3?i:s===null?s=Object.getOwnPropertyDescriptor(i,o):s,c;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(r,i,o,s);else for(var h=r.length-1;h>=0;h--)(c=r[h])&&(u=(a<3?c(u):a>3?c(i,o,u):c(i,o))||u);return a>3&&u&&Object.defineProperty(i,o,u),u},ha=function(r,i){return function(o,s){i(o,s,r)}},la=function(r,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,i)},fa=function(r,i,o,s){function a(u){return u instanceof o?u:new o(function(c){c(u)})}return new(o||(o=Promise))(function(u,c){function h(d){try{l(s.next(d))}catch(p){c(p)}}function f(d){try{l(s.throw(d))}catch(p){c(p)}}function l(d){d.done?u(d.value):a(d.value).then(h,f)}l((s=s.apply(r,i||[])).next())})},da=function(r,i){var o={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},s,a,u,c;return c={next:h(0),throw:h(1),return:h(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function h(l){return function(d){return f([l,d])}}function f(l){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,a&&(u=l[0]&2?a.return:l[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,l[1])).done)return u;switch(a=0,u&&(l=[l[0]&2,u.value]),l[0]){case 0:case 1:u=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,a=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(u=o.trys,!(u=u.length>0&&u[u.length-1])&&(l[0]===6||l[0]===2)){o=0;continue}if(l[0]===3&&(!u||l[1]>u[0]&&l[1]<u[3])){o.label=l[1];break}if(l[0]===6&&o.label<u[1]){o.label=u[1],u=l;break}if(u&&o.label<u[2]){o.label=u[2],o.ops.push(l);break}u[2]&&o.ops.pop(),o.trys.pop();continue}l=i.call(r,o)}catch(d){l=[6,d],a=0}finally{s=u=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},pa=function(r,i){for(var o in r)o!=="default"&&!Object.prototype.hasOwnProperty.call(i,o)&&Ir(i,r,o)},Ir=Object.create?function(r,i,o,s){s===void 0&&(s=o),Object.defineProperty(r,s,{enumerable:!0,get:function(){return i[o]}})}:function(r,i,o,s){s===void 0&&(s=o),r[s]=i[o]},Er=function(r){var i=typeof Symbol=="function"&&Symbol.iterator,o=i&&r[i],s=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&s>=r.length&&(r=void 0),{value:r&&r[s++],done:!r}}};throw new TypeError(i?"Object is not iterable.":"Symbol.iterator is not defined.")},Wi=function(r,i){var o=typeof Symbol=="function"&&r[Symbol.iterator];if(!o)return r;var s=o.call(r),a,u=[],c;try{for(;(i===void 0||i-- >0)&&!(a=s.next()).done;)u.push(a.value)}catch(h){c={error:h}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(c)throw c.error}}return u},va=function(){for(var r=[],i=0;i<arguments.length;i++)r=r.concat(Wi(arguments[i]));return r},ya=function(){for(var r=0,i=0,o=arguments.length;i<o;i++)r+=arguments[i].length;for(var s=Array(r),a=0,i=0;i<o;i++)for(var u=arguments[i],c=0,h=u.length;c<h;c++,a++)s[a]=u[c];return s},ga=function(r,i,o){if(o||arguments.length===2)for(var s=0,a=i.length,u;s<a;s++)(u||!(s in i))&&(u||(u=Array.prototype.slice.call(i,0,s)),u[s]=i[s]);return r.concat(u||Array.prototype.slice.call(i))},je=function(r){return this instanceof je?(this.v=r,this):new je(r)},ma=function(r,i,o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s=o.apply(r,i||[]),a,u=[];return a={},c("next"),c("throw"),c("return"),a[Symbol.asyncIterator]=function(){return this},a;function c(v){s[v]&&(a[v]=function(w){return new Promise(function(E,A){u.push([v,w,E,A])>1||h(v,w)})})}function h(v,w){try{f(s[v](w))}catch(E){p(u[0][3],E)}}function f(v){v.value instanceof je?Promise.resolve(v.value.v).then(l,d):p(u[0][2],v)}function l(v){h("next",v)}function d(v){h("throw",v)}function p(v,w){v(w),u.shift(),u.length&&h(u[0][0],u[0][1])}},wa=function(r){var i,o;return i={},s("next"),s("throw",function(a){throw a}),s("return"),i[Symbol.iterator]=function(){return this},i;function s(a,u){i[a]=r[a]?function(c){return(o=!o)?{value:je(r[a](c)),done:a==="return"}:u?u(c):c}:u}},ba=function(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r[Symbol.asyncIterator],o;return i?i.call(r):(r=typeof Er=="function"?Er(r):r[Symbol.iterator](),o={},s("next"),s("throw"),s("return"),o[Symbol.asyncIterator]=function(){return this},o);function s(u){o[u]=r[u]&&function(c){return new Promise(function(h,f){c=r[u](c),a(h,f,c.done,c.value)})}}function a(u,c,h,f){Promise.resolve(f).then(function(l){u({value:l,done:h})},c)}},_a=function(r,i){return Object.defineProperty?Object.defineProperty(r,"raw",{value:i}):r.raw=i,r};var n=Object.create?function(r,i){Object.defineProperty(r,"default",{enumerable:!0,value:i})}:function(r,i){r.default=i};Ea=function(r){if(r&&r.__esModule)return r;var i={};if(r!=null)for(var o in r)o!=="default"&&Object.prototype.hasOwnProperty.call(r,o)&&Ir(i,r,o);return n(i,r),i},Ia=function(r){return r&&r.__esModule?r:{default:r}},Ta=function(r,i,o,s){if(o==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof i=="function"?r!==i||!s:!i.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return o==="m"?s:o==="a"?s.call(r):s?s.value:i.get(r)},Sa=function(r,i,o,s,a){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof i=="function"?r!==i||!a:!i.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?a.call(r,o):a?a.value=o:i.set(r,o),o},e("__extends",sa),e("__assign",aa),e("__rest",ua),e("__decorate",ca),e("__param",ha),e("__metadata",la),e("__awaiter",fa),e("__generator",da),e("__exportStar",pa),e("__createBinding",Ir),e("__values",Er),e("__read",Wi),e("__spread",va),e("__spreadArrays",ya),e("__spreadArray",ga),e("__await",je),e("__asyncGenerator",ma),e("__asyncDelegator",wa),e("__asyncValues",ba),e("__makeTemplateObject",_a),e("__importStar",Ea),e("__importDefault",Ia),e("__classPrivateFieldGet",Ta),e("__classPrivateFieldSet",Sa)})});var Da=Df(Aa()),{__extends:R,__assign:Cn,__rest:og,__decorate:sg,__param:ag,__metadata:ug,__awaiter:m,__generator:g,__exportStar:cg,__createBinding:hg,__values:Sr,__read:Rn,__spread:lg,__spreadArrays:fg,__spreadArray:z,__await:dg,__asyncGenerator:pg,__asyncDelegator:vg,__asyncValues:yg,__makeTemplateObject:gg,__importStar:mg,__importDefault:wg,__classPrivateFieldGet:bg,__classPrivateFieldSet:_g}=Da.default;var Na=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=i&63|128):(i&64512)==55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)==56320?(i=65536+((i&1023)<<10)+(e.charCodeAt(++r)&1023),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=i&63|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=i&63|128)}return t},Nf=function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=e[n++];t[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){var o=e[n++],s=e[n++],a=e[n++],u=((i&7)<<18|(o&63)<<12|(s&63)<<6|a&63)-65536;t[r++]=String.fromCharCode(55296+(u>>10)),t[r++]=String.fromCharCode(56320+(u&1023))}else{var o=e[n++],s=e[n++];t[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|s&63)}}return t.join("")},Cf={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var o=e[i],s=i+1<e.length,a=s?e[i+1]:0,u=i+2<e.length,c=u?e[i+2]:0,h=o>>2,f=(o&3)<<4|a>>4,l=(a&15)<<2|c>>6,d=c&63;u||(d=64,s||(l=64)),r.push(n[h],n[f],n[l],n[d])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Na(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):Nf(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var o=n[e.charAt(i++)],s=i<e.length,a=s?n[e.charAt(i)]:0;++i;var u=i<e.length,c=u?n[e.charAt(i)]:64;++i;var h=i<e.length,f=h?n[e.charAt(i)]:64;if(++i,o==null||a==null||c==null||f==null)throw Error();var l=o<<2|a>>4;if(r.push(l),c!==64){var d=a<<4&240|c>>2;if(r.push(d),f!==64){var p=c<<6&192|f;r.push(p)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},Rf=function(e){var t=Na(e);return Cf.encodeByteArray(t,!0)},Ca=function(e){return Rf(e).replace(/\./g,"")};function Ra(e){return qe(void 0,e)}function qe(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:var n=t;return new Date(n.getTime());case Object:e===void 0&&(e={});break;case Array:e=[];break;default:return t}for(var r in t)!t.hasOwnProperty(r)||!Of(r)||(e[r]=qe(e[r],t[r]));return e}function Of(e){return e!=="__proto__"}var Oa=function(){function e(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(n,r){t.resolve=n,t.reject=r})}return e.prototype.wrapCallback=function(t){var n=this;return function(r,i){r?n.reject(r):n.resolve(i),typeof t=="function"&&(n.promise.catch(function(){}),t.length===1?t(r):t(r,i))}},e}();function xa(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n={alg:"none",type:"JWT"},r=t||"demo-project",i=e.iat||0,o=e.sub||e.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var s=Cn({iss:"https://securetoken.google.com/"+r,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},e),a="";return[Ca(JSON.stringify(n)),Ca(JSON.stringify(s)),a].join(".")}function Jt(){return typeof navigator!="undefined"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ka(){return typeof window!="undefined"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Jt())}function Yi(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch(e){return!1}}function Pa(){return typeof self=="object"&&self.self===self}function La(){var e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function Ma(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Fa(){return Jt().indexOf("Electron/")>=0}function Va(){var e=Jt();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function Ua(){return Jt().indexOf("MSAppHost/")>=0}function ja(){return!Yi()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var xf="FirebaseError",kf=function(e){R(t,e);function t(n,r,i){var o=e.call(this,r)||this;return o.code=n,o.customData=i,o.name=xf,Object.setPrototypeOf(o,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,Ar.prototype.create),o}return t}(Error),Ar=function(){function e(t,n,r){this.service=t,this.serviceName=n,this.errors=r}return e.prototype.create=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=n[0]||{},o=this.service+"/"+t,s=this.errors[t],a=s?Pf(s,i):"Error",u=this.serviceName+": "+a+" ("+o+").",c=new kf(o,u,i);return c},e}();function Pf(e,t){return e.replace(Lf,function(n,r){var i=t[r];return i!=null?String(i):"<"+r+"?>"})}var Lf=/\{\$([^}]+)}/g;function Xi(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var Tg=function(){function e(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(t,n){n||(n=0);var r=this.W_;if(typeof t=="string")for(var i=0;i<16;i++)r[i]=t.charCodeAt(n)<<24|t.charCodeAt(n+1)<<16|t.charCodeAt(n+2)<<8|t.charCodeAt(n+3),n+=4;else for(var i=0;i<16;i++)r[i]=t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3],n+=4;for(var i=16;i<80;i++){var o=r[i-3]^r[i-8]^r[i-14]^r[i-16];r[i]=(o<<1|o>>>31)&4294967295}for(var s=this.chain_[0],a=this.chain_[1],u=this.chain_[2],c=this.chain_[3],h=this.chain_[4],f,l,i=0;i<80;i++){i<40?i<20?(f=c^a&(u^c),l=1518500249):(f=a^u^c,l=1859775393):i<60?(f=a&u|c&(a|u),l=2400959708):(f=a^u^c,l=3395469782);var o=(s<<5|s>>>27)+f+h+l+r[i]&4294967295;h=c,c=u,u=(a<<30|a>>>2)&4294967295,a=s,s=o}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+a&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295},e.prototype.update=function(t,n){if(t!=null){n===void 0&&(n=t.length);for(var r=n-this.blockSize,i=0,o=this.buf_,s=this.inbuf_;i<n;){if(s===0)for(;i<=r;)this.compress_(t,i),i+=this.blockSize;if(typeof t=="string"){for(;i<n;)if(o[s]=t.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(o),s=0;break}}else for(;i<n;)if(o[s]=t[i],++s,++i,s===this.blockSize){this.compress_(o),s=0;break}}this.inbuf_=s,this.total_+=n}},e.prototype.digest=function(){var t=[],n=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var r=this.blockSize-1;r>=56;r--)this.buf_[r]=n&255,n/=256;this.compress_(this.buf_);for(var i=0,r=0;r<5;r++)for(var o=24;o>=0;o-=8)t[i]=this.chain_[r]>>o&255,++i;return t},e}();function qa(e,t){var n=new Mf(e,t);return n.subscribe.bind(n)}var Mf=function(){function e(t,n){var r=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(function(){t(r)}).catch(function(i){r.error(i)})}return e.prototype.next=function(t){this.forEachObserver(function(n){n.next(t)})},e.prototype.error=function(t){this.forEachObserver(function(n){n.error(t)}),this.close(t)},e.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},e.prototype.subscribe=function(t,n,r){var i=this,o;if(t===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");Ff(t,["next","error","complete"])?o=t:o={next:t,error:n,complete:r},o.next===void 0&&(o.next=$i),o.error===void 0&&(o.error=$i),o.complete===void 0&&(o.complete=$i);var s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?o.error(i.finalError):o.complete()}catch(a){}}),this.observers.push(o),s},e.prototype.unsubscribeOne=function(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))},e.prototype.forEachObserver=function(t){if(!this.finalized)for(var n=0;n<this.observers.length;n++)this.sendOne(n,t)},e.prototype.sendOne=function(t,n){var r=this;this.task.then(function(){if(r.observers!==void 0&&r.observers[t]!==void 0)try{n(r.observers[t])}catch(i){typeof console!="undefined"&&console.error&&console.error(i)}})},e.prototype.close=function(t){var n=this;this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(function(){n.observers=void 0,n.onNoObservers=void 0}))},e}();function Ff(e,t){if(typeof e!="object"||e===null)return!1;for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&typeof e[i]=="function")return!0}return!1}function $i(){}var Sg=4*60*60*1e3;function W(e){return e&&e._delegate?e._delegate:e}var Be=function(){function e(t,n,r){this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return e.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},e.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},e.prototype.setServiceProps=function(t){return this.serviceProps=t,this},e.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},e}();var ge="[DEFAULT]";var Vf=function(){function e(t,n){this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return e.prototype.get=function(t){var n=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(n)){var r=new Oa;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{var i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch(o){}}return this.instancesDeferred.get(n).promise},e.prototype.getImmediate=function(t){var n,r=this.normalizeInstanceIdentifier(t==null?void 0:t.identifier),i=(n=t==null?void 0:t.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(o){if(i)return null;throw o}else{if(i)return null;throw Error("Service "+this.name+" is not available")}},e.prototype.getComponent=function(){return this.component},e.prototype.setComponent=function(t){var n,r;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,!!this.shouldAutoInitialize()){if(jf(t))try{this.getOrInitializeService({instanceIdentifier:ge})}catch(f){}try{for(var i=Sr(this.instancesDeferred.entries()),o=i.next();!o.done;o=i.next()){var s=Rn(o.value,2),a=s[0],u=s[1],c=this.normalizeInstanceIdentifier(a);try{var h=this.getOrInitializeService({instanceIdentifier:c});u.resolve(h)}catch(f){}}}catch(f){n={error:f}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}},e.prototype.clearInstance=function(t){t===void 0&&(t=ge),this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)},e.prototype.delete=function(){return m(this,void 0,void 0,function(){var t;return g(this,function(n){switch(n.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(z(z([],Rn(t.filter(function(r){return"INTERNAL"in r}).map(function(r){return r.INTERNAL.delete()}))),Rn(t.filter(function(r){return"_delete"in r}).map(function(r){return r._delete()}))))];case 1:return n.sent(),[2]}})})},e.prototype.isComponentSet=function(){return this.component!=null},e.prototype.isInitialized=function(t){return t===void 0&&(t=ge),this.instances.has(t)},e.prototype.getOptions=function(t){return t===void 0&&(t=ge),this.instancesOptions.get(t)||{}},e.prototype.initialize=function(t){var n,r;t===void 0&&(t={});var i=t.options,o=i===void 0?{}:i,s=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(s))throw Error(this.name+"("+s+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var a=this.getOrInitializeService({instanceIdentifier:s,options:o});try{for(var u=Sr(this.instancesDeferred.entries()),c=u.next();!c.done;c=u.next()){var h=Rn(c.value,2),f=h[0],l=h[1],d=this.normalizeInstanceIdentifier(f);s===d&&l.resolve(a)}}catch(p){n={error:p}}finally{try{c&&!c.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}return a},e.prototype.onInit=function(t,n){var r,i=this.normalizeInstanceIdentifier(n),o=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;o.add(t),this.onInitCallbacks.set(i,o);var s=this.instances.get(i);return s&&t(s,i),function(){o.delete(t)}},e.prototype.invokeOnInitCallbacks=function(t,n){var r,i,o=this.onInitCallbacks.get(n);if(!!o)try{for(var s=Sr(o),a=s.next();!a.done;a=s.next()){var u=a.value;try{u(t,n)}catch(c){}}}catch(c){r={error:c}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},e.prototype.getOrInitializeService=function(t){var n=t.instanceIdentifier,r=t.options,i=r===void 0?{}:r,o=this.instances.get(n);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:Uf(n),options:i}),this.instances.set(n,o),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(o,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,o)}catch(s){}return o||null},e.prototype.normalizeInstanceIdentifier=function(t){return t===void 0&&(t=ge),this.component?this.component.multipleInstances?t:ge:t},e.prototype.shouldAutoInitialize=function(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"},e}();function Uf(e){return e===ge?void 0:e}function jf(e){return e.instantiationMode==="EAGER"}var Ba=function(){function e(t){this.name=t,this.providers=new Map}return e.prototype.addComponent=function(t){var n=this.getProvider(t.name);if(n.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);n.setComponent(t)},e.prototype.addOrOverwriteComponent=function(t){var n=this.getProvider(t.name);n.isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},e.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var n=new Vf(t,this);return this.providers.set(t,n),n},e.prototype.getProviders=function(){return Array.from(this.providers.values())},e}();function Mt(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var me,Ji=[],V;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(V||(V={}));var Ka={debug:V.DEBUG,verbose:V.VERBOSE,info:V.INFO,warn:V.WARN,error:V.ERROR,silent:V.SILENT},qf=V.INFO,Bf=(me={},me[V.DEBUG]="log",me[V.VERBOSE]="log",me[V.INFO]="info",me[V.WARN]="warn",me[V.ERROR]="error",me),Kf=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=new Date().toISOString(),o=Bf[t];if(o)console[o].apply(console,Mt(["["+i+"]  "+e.name+":"],n));else throw new Error("Attempted to log a message with an invalid logType (value: "+t+")")}},Dr=function(){function e(t){this.name=t,this._logLevel=qf,this._logHandler=Kf,this._userLogHandler=null,Ji.push(this)}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in V))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(t){this._logLevel=typeof t=="string"?Ka[t]:t},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Mt([this,V.DEBUG],t)),this._logHandler.apply(this,Mt([this,V.DEBUG],t))},e.prototype.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Mt([this,V.VERBOSE],t)),this._logHandler.apply(this,Mt([this,V.VERBOSE],t))},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Mt([this,V.INFO],t)),this._logHandler.apply(this,Mt([this,V.INFO],t))},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Mt([this,V.WARN],t)),this._logHandler.apply(this,Mt([this,V.WARN],t))},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Mt([this,V.ERROR],t)),this._logHandler.apply(this,Mt([this,V.ERROR],t))},e}();function za(e){Ji.forEach(function(t){t.setLogLevel(e)})}function Ga(e,t){for(var n=function(s){var a=null;t&&t.level&&(a=Ka[t.level]),e===null?s.userLogHandler=null:s.userLogHandler=function(u,c){for(var h=[],f=2;f<arguments.length;f++)h[f-2]=arguments[f];var l=h.map(function(d){if(d==null)return null;if(typeof d=="string")return d;if(typeof d=="number"||typeof d=="boolean")return d.toString();if(d instanceof Error)return d.message;try{return JSON.stringify(d)}catch(p){return null}}).filter(function(d){return d}).join(" ");c>=(a??u.logLevel)&&e({level:V[c].toLowerCase(),message:l,args:h,type:u.name})}},r=0,i=Ji;r<i.length;r++){var o=i[r];n(o)}}var Zt,zf=(Zt={},Zt["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",Zt["bad-app-name"]="Illegal App name: '{$appName}",Zt["duplicate-app"]="Firebase App named '{$appName}' already exists",Zt["app-deleted"]="Firebase App named '{$appName}' already deleted",Zt["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",Zt["invalid-log-argument"]="First argument to `onLog` must be null or a function.",Zt),Ke=new Ar("app","Firebase",zf),Ha="@firebase/app",Gf="0.6.30",Hf="@firebase/analytics",Qf="@firebase/app-check",Wf="@firebase/auth",Yf="@firebase/database",Xf="@firebase/functions",$f="@firebase/installations",Jf="@firebase/messaging",Zf="@firebase/performance",td="@firebase/remote-config",ed="@firebase/storage",nd="@firebase/firestore",rd="firebase-wrapper";var lt,Nr="[DEFAULT]",id=(lt={},lt[Ha]="fire-core",lt[Hf]="fire-analytics",lt[Qf]="fire-app-check",lt[Wf]="fire-auth",lt[Yf]="fire-rtdb",lt[Xf]="fire-fn",lt[$f]="fire-iid",lt[Jf]="fire-fcm",lt[Zf]="fire-perf",lt[td]="fire-rc",lt[ed]="fire-gcs",lt[nd]="fire-fst",lt["fire-js"]="fire-js",lt[rd]="fire-js-all",lt);var ze=new Dr("@firebase/app");var Cr=function(){function e(t,n,r){var i=this;this.firebase_=r,this.isDeleted_=!1,this.name_=n.name,this.automaticDataCollectionEnabled_=n.automaticDataCollectionEnabled||!1,this.options_=Ra(t),this.container=new Ba(n.name),this._addComponent(new Be("app",function(){return i},"PUBLIC")),this.firebase_.INTERNAL.components.forEach(function(o){return i._addComponent(o)})}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),e.prototype.delete=function(){var t=this;return new Promise(function(n){t.checkDestroyed_(),n()}).then(function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map(function(n){return n.delete()}))}).then(function(){t.isDeleted_=!0})},e.prototype._getService=function(t,n){var r;n===void 0&&(n=Nr),this.checkDestroyed_();var i=this.container.getProvider(t);return!i.isInitialized()&&((r=i.getComponent())===null||r===void 0?void 0:r.instantiationMode)==="EXPLICIT"&&i.initialize(),i.getImmediate({identifier:n})},e.prototype._removeServiceInstance=function(t,n){n===void 0&&(n=Nr),this.container.getProvider(t).clearInstance(n)},e.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(n){ze.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,n)}},e.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},e.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw Ke.create("app-deleted",{appName:this.name_})},e}();Cr.prototype.name&&Cr.prototype.options||Cr.prototype.delete||console.log("dc");var od="8.10.0";function sd(e){var t={},n=new Map,r={__esModule:!0,initializeApp:s,app:o,registerVersion:c,setLogLevel:za,onLog:h,apps:null,SDK_VERSION:od,INTERNAL:{registerComponent:u,removeApp:i,components:n,useAsService:f}};r.default=r,Object.defineProperty(r,"apps",{get:a});function i(l){delete t[l]}function o(l){if(l=l||Nr,!Xi(t,l))throw Ke.create("no-app",{appName:l});return t[l]}o.App=e;function s(l,d){if(d===void 0&&(d={}),typeof d!="object"||d===null){var p=d;d={name:p}}var v=d;v.name===void 0&&(v.name=Nr);var w=v.name;if(typeof w!="string"||!w)throw Ke.create("bad-app-name",{appName:String(w)});if(Xi(t,w))throw Ke.create("duplicate-app",{appName:w});var E=new e(l,v,r);return t[w]=E,E}function a(){return Object.keys(t).map(function(l){return t[l]})}function u(l){var d=l.name;if(n.has(d))return ze.debug("There were multiple attempts to register component "+d+"."),l.type==="PUBLIC"?r[d]:null;if(n.set(d,l),l.type==="PUBLIC"){var p=function(A){if(A===void 0&&(A=o()),typeof A[d]!="function")throw Ke.create("invalid-app-argument",{appName:d});return A[d]()};l.serviceProps!==void 0&&qe(p,l.serviceProps),r[d]=p,e.prototype[d]=function(){for(var A=[],D=0;D<arguments.length;D++)A[D]=arguments[D];var k=this._getService.bind(this,d);return k.apply(this,l.multipleInstances?A:[])}}for(var v=0,w=Object.keys(t);v<w.length;v++){var E=w[v];t[E]._addComponent(l)}return l.type==="PUBLIC"?r[d]:null}function c(l,d,p){var v,w=(v=id[l])!==null&&v!==void 0?v:l;p&&(w+="-"+p);var E=w.match(/\s|\//),A=d.match(/\s|\//);if(E||A){var D=['Unable to register library "'+w+'" with version "'+d+'":'];E&&D.push('library name "'+w+'" contains illegal characters (whitespace or "/")'),E&&A&&D.push("and"),A&&D.push('version name "'+d+'" contains illegal characters (whitespace or "/")'),ze.warn(D.join(" "));return}u(new Be(w+"-version",function(){return{library:w,version:d}},"VERSION"))}function h(l,d){if(l!==null&&typeof l!="function")throw Ke.create("invalid-log-argument");Ga(l,d)}function f(l,d){if(d==="serverAuth")return null;var p=d;return p}return r}function Qa(){var e=sd(Cr);e.INTERNAL=Cn(Cn({},e.INTERNAL),{createFirebaseNamespace:Qa,extendNamespace:t,createSubscribe:qa,ErrorFactory:Ar,deepExtend:qe});function t(n){qe(e,n)}return e}var Zi=Qa();var ad=function(){function e(t){this.container=t}return e.prototype.getPlatformInfoString=function(){var t=this.container.getProviders();return t.map(function(n){if(ud(n)){var r=n.getImmediate();return r.library+"/"+r.version}else return null}).filter(function(n){return n}).join(" ")},e}();function ud(e){var t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}function cd(e,t){e.INTERNAL.registerComponent(new Be("platform-logger",function(n){return new ad(n)},"PRIVATE")),e.registerVersion(Ha,Gf,t),e.registerVersion("fire-js","")}Pa()&&self.firebase!==void 0&&(ze.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `),to=self.firebase.SDK_VERSION,to&&to.indexOf("LITE")>=0&&ze.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `));var to,hd=Zi.initializeApp;Zi.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Yi()&&ze.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/@rollup/plugin-node-resolve
      `),hd.apply(void 0,e)};var Wa=Zi;cd(Wa);var jt=Wa;var ld="firebase",Ya="8.10.0";jt.registerVersion(ld,Ya,"app");jt.SDK_VERSION=Ya;var eo=function(e,t){return eo=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},eo(e,t)};function fd(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");eo(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function Xa(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var dd=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},S,no=no||{},x=dd||self;function Rr(){}function ro(e){var t=typeof e;return t=t!="object"?t:e?Array.isArray(e)?"array":t:"null",t=="array"||t=="object"&&typeof e.length=="number"}function On(e){var t=typeof e;return t=="object"&&e!=null||t=="function"}function pd(e){return Object.prototype.hasOwnProperty.call(e,io)&&e[io]||(e[io]=++vd)}var io="closure_uid_"+(1e9*Math.random()>>>0),vd=0;function yd(e,t,n){return e.call.apply(e.bind,arguments)}function gd(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),e.apply(t,i)}}return function(){return e.apply(t,arguments)}}function it(e,t,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?it=yd:it=gd,it.apply(null,arguments)}function Or(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),e.apply(this,r)}}function ot(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(r,i,o){for(var s=Array(arguments.length-2),a=2;a<arguments.length;a++)s[a-2]=arguments[a];return t.prototype[i].apply(r,s)}}function te(){this.s=this.s,this.o=this.o}var md=0,wd={};te.prototype.s=!1;te.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),md!=0)){var e=pd(this);delete wd[e]}};te.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var $a=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if(typeof e=="string")return typeof t!="string"||t.length!=1?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},Ja=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=typeof e=="string"?e.split(""):e,o=0;o<r;o++)o in i&&t.call(n,i[o],o,e)};function bd(e){t:{for(var t=lp,n=e.length,r=typeof e=="string"?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break t}t=-1}return 0>t?null:typeof e=="string"?e.charAt(t):e[t]}function Za(e){return Array.prototype.concat.apply([],arguments)}function oo(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function xr(e){return/^[\s\xa0]*$/.test(e)}var tu=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function mt(e,t){return e.indexOf(t)!=-1}function so(e,t){return e<t?-1:e>t?1:0}var wt;t:{if(ao=x.navigator,ao&&(uo=ao.userAgent,uo)){wt=uo;break t}wt=""}var ao,uo;function co(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function eu(e){var t={};for(var n in e)t[n]=e[n];return t}var nu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ru(e,t){for(var n,r,i=1;i<arguments.length;i++){r=arguments[i];for(n in r)e[n]=r[n];for(var o=0;o<nu.length;o++)n=nu[o],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function ho(e){return ho[" "](e),e}ho[" "]=Rr;function _d(e){var t=Td;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}var Ed=mt(wt,"Opera"),Ge=mt(wt,"Trident")||mt(wt,"MSIE"),iu=mt(wt,"Edge"),lo=iu||Ge,ou=mt(wt,"Gecko")&&!(mt(wt.toLowerCase(),"webkit")&&!mt(wt,"Edge"))&&!(mt(wt,"Trident")||mt(wt,"MSIE"))&&!mt(wt,"Edge"),Id=mt(wt.toLowerCase(),"webkit")&&!mt(wt,"Edge");function su(){var e=x.document;return e?e.documentMode:void 0}var kr;t:{if(Pr="",Lr=function(){var e=wt;if(ou)return/rv:([^\);]+)(\)|;)/.exec(e);if(iu)return/Edge\/([\d\.]+)/.exec(e);if(Ge)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e);if(Id)return/WebKit\/(\S+)/.exec(e);if(Ed)return/(?:Version)[ \/]?(\S+)/.exec(e)}(),Lr&&(Pr=Lr?Lr[1]:""),Ge&&(Mr=su(),Mr!=null&&Mr>parseFloat(Pr))){kr=String(Mr);break t}kr=Pr}var Pr,Lr,Mr,Td={};function Sd(){return _d(function(){for(var e=0,t=tu(String(kr)).split("."),n=tu("9").split("."),r=Math.max(t.length,n.length),i=0;e==0&&i<r;i++){var o=t[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],o[0].length==0&&s[0].length==0)break;e=so(o[1].length==0?0:parseInt(o[1],10),s[1].length==0?0:parseInt(s[1],10))||so(o[2].length==0,s[2].length==0)||so(o[2],s[2]),o=o[3],s=s[3]}while(e==0)}return 0<=e})}var fo;x.document&&Ge?(po=su(),fo=po||parseInt(kr,10)||void 0):fo=void 0;var po,Ad=fo,Dd=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{x.addEventListener("test",Rr,t),x.removeEventListener("test",Rr,t)}catch(n){}return e}();function ft(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}ft.prototype.h=function(){this.defaultPrevented=!0};function xn(e,t){if(ft.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(ou){t:{try{ho(t.nodeName);var i=!0;break t}catch(o){}i=!1}i||(t=null)}}else n=="mouseover"?t=e.fromElement:n=="mouseout"&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=e.clientX!==void 0?e.clientX:e.pageX,this.clientY=e.clientY!==void 0?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=typeof e.pointerType=="string"?e.pointerType:Nd[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&xn.Z.h.call(this)}}ot(xn,ft);var Nd={2:"touch",3:"pen",4:"mouse"};xn.prototype.h=function(){xn.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var kn="closure_listenable_"+(1e6*Math.random()|0),Cd=0;function Rd(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++Cd,this.ca=this.fa=!1}function Fr(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function Vr(e){this.src=e,this.g={},this.h=0}Vr.prototype.add=function(e,t,n,r,i){var o=e.toString();e=this.g[o],e||(e=this.g[o]=[],this.h++);var s=yo(e,t,r,i);return-1<s?(t=e[s],n||(t.fa=!1)):(t=new Rd(t,this.src,o,!!r,i),t.fa=n,e.push(t)),t};function vo(e,t){var n=t.type;if(n in e.g){var r=e.g[n],i=$a(r,t),o;(o=0<=i)&&Array.prototype.splice.call(r,i,1),o&&(Fr(t),e.g[n].length==0&&(delete e.g[n],e.h--))}}function yo(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.ca&&o.listener==t&&o.capture==!!n&&o.ia==r)return i}return-1}var go="closure_lm_"+(1e6*Math.random()|0),mo={};function au(e,t,n,r,i){if(r&&r.once)return cu(e,t,n,r,i);if(Array.isArray(t)){for(var o=0;o<t.length;o++)au(e,t[o],n,r,i);return null}return n=Eo(n),e&&e[kn]?e.N(t,n,On(r)?!!r.capture:!!r,i):uu(e,t,n,!1,r,i)}function uu(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var s=On(i)?!!i.capture:!!i,a=bo(e);if(a||(e[go]=a=new Vr(e)),n=a.add(t,n,r,s,o),n.proxy)return n;if(r=Od(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Dd||(i=s),i===void 0&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(lu(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Od(){function e(n){return t.call(e.src,e.listener,n)}var t=xd;return e}function cu(e,t,n,r,i){if(Array.isArray(t)){for(var o=0;o<t.length;o++)cu(e,t[o],n,r,i);return null}return n=Eo(n),e&&e[kn]?e.O(t,n,On(r)?!!r.capture:!!r,i):uu(e,t,n,!0,r,i)}function hu(e,t,n,r,i){if(Array.isArray(t))for(var o=0;o<t.length;o++)hu(e,t[o],n,r,i);else r=On(r)?!!r.capture:!!r,n=Eo(n),e&&e[kn]?(e=e.i,t=String(t).toString(),t in e.g&&(o=e.g[t],n=yo(o,n,r,i),-1<n&&(Fr(o[n]),Array.prototype.splice.call(o,n,1),o.length==0&&(delete e.g[t],e.h--)))):e&&(e=bo(e))&&(t=e.g[t.toString()],e=-1,t&&(e=yo(t,n,r,i)),(n=-1<e?t[e]:null)&&wo(n))}function wo(e){if(typeof e!="number"&&e&&!e.ca){var t=e.src;if(t&&t[kn])vo(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(lu(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=bo(t))?(vo(n,e),n.h==0&&(n.src=null,t[go]=null)):Fr(e)}}}function lu(e){return e in mo?mo[e]:mo[e]="on"+e}function xd(e,t){if(e.ca)e=!0;else{t=new xn(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&wo(e),e=n.call(r,t)}return e}function bo(e){return e=e[go],e instanceof Vr?e:null}var _o="__closure_events_fn_"+(1e9*Math.random()>>>0);function Eo(e){return typeof e=="function"?e:(e[_o]||(e[_o]=function(t){return e.handleEvent(t)}),e[_o])}function et(){te.call(this),this.i=new Vr(this),this.P=this,this.I=null}ot(et,te);et.prototype[kn]=!0;et.prototype.removeEventListener=function(e,t,n,r){hu(this,e,t,n,r)};function st(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,typeof t=="string")t=new ft(t,e);else if(t instanceof ft)t.target=t.target||e;else{var i=t;t=new ft(r,e),ru(t,i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=t.g=n[o];i=Ur(s,r,!0,t)&&i}if(s=t.g=e,i=Ur(s,r,!0,t)&&i,i=Ur(s,r,!1,t)&&i,n)for(o=0;o<n.length;o++)s=t.g=n[o],i=Ur(s,r,!1,t)&&i}et.prototype.M=function(){if(et.Z.M.call(this),this.i){var e=this.i,t;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Fr(n[r]);delete e.g[t],e.h--}}this.I=null};et.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)};et.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};function Ur(e,t,n,r){if(t=e.i.g[String(t)],!t)return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var s=t[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,u=s.ia||s.src;s.fa&&vo(e.i,s),i=a.call(u,r)!==!1&&i}}return i&&!r.defaultPrevented}var Io=x.JSON.stringify;function kd(){var e=du,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Pd=function(){function e(){this.h=this.g=null}return e.prototype.add=function(t,n){var r=fu.get();r.set(t,n),this.h?this.h.next=r:this.g=r,this.h=r},e}(),fu=new(function(){function e(t,n){this.i=t,this.j=n,this.h=0,this.g=null}return e.prototype.get=function(){var t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t},e}())(function(){return new Ld},function(e){return e.reset()}),Ld=function(){function e(){this.next=this.g=this.h=null}return e.prototype.set=function(t,n){this.h=t,this.g=n,this.next=null},e.prototype.reset=function(){this.next=this.g=this.h=null},e}();function Md(e){x.setTimeout(function(){throw e},0)}function To(e,t){So||Fd(),Ao||(So(),Ao=!0),du.add(e,t)}var So;function Fd(){var e=x.Promise.resolve(void 0);So=function(){e.then(Vd)}}var Ao=!1,du=new Pd;function Vd(){for(var e;e=kd();){try{e.h.call(e.g)}catch(n){Md(n)}var t=fu;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Ao=!1}function jr(e,t){et.call(this),this.h=e||1,this.g=t||x,this.j=it(this.kb,this),this.l=Date.now()}ot(jr,et);S=jr.prototype;S.da=!1;S.S=null;S.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),st(this,"tick"),this.da&&(Do(this),this.start()))}};S.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Do(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}S.M=function(){jr.Z.M.call(this),Do(this),delete this.g};function No(e,t,n){if(typeof e=="function")n&&(e=it(e,n));else if(e&&typeof e.handleEvent=="function")e=it(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:x.setTimeout(e,t||0)}function pu(e){e.g=No(function(){e.g=null,e.i&&(e.i=!1,pu(e))},e.j);var t=e.h;e.h=null,e.m.apply(null,t)}var Ud=function(e){fd(t,e);function t(n,r){var i=e.call(this)||this;return i.m=n,i.j=r,i.h=null,i.i=!1,i.g=null,i}return t.prototype.l=function(n){this.h=arguments,this.g?this.i=!0:pu(this)},t.prototype.M=function(){e.prototype.M.call(this),this.g&&(x.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},t}(te);function Pn(e){te.call(this),this.h=e,this.g={}}ot(Pn,te);var vu=[];function yu(e,t,n,r){Array.isArray(n)||(n&&(vu[0]=n.toString()),n=vu);for(var i=0;i<n.length;i++){var o=au(t,n[i],r||e.handleEvent,!1,e.h||e);if(!o)break;e.g[o.key]=o}}function gu(e){co(e.g,function(t,n){this.g.hasOwnProperty(n)&&wo(t)},e),e.g={}}Pn.prototype.M=function(){Pn.Z.M.call(this),gu(this)};Pn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function qr(){this.g=!0}qr.prototype.Aa=function(){this.g=!1};function jd(e,t,n,r,i,o){e.info(function(){if(e.g)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var f=h.split("_");s=2<=f.length&&f[1]=="type"?s+(h+"="+c+"&"):s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+`
`+n+`
`+s})}function qd(e,t,n,r,i,o,s){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+`
`+n+`
`+o+" "+s})}function He(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+Kd(e,n)+(r?" "+r:"")})}function Bd(e,t){e.info(function(){return"TIMEOUT: "+t})}qr.prototype.info=function(){};function Kd(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if(o!="noop"&&o!="stop"&&o!="close")for(var s=1;s<i.length;s++)i[s]=""}}}}return Io(n)}catch(a){return t}}var we={},mu=null;function Br(){return mu=mu||new et}we.Ma="serverreachability";function wu(e){ft.call(this,we.Ma,e)}ot(wu,ft);function Ln(e){var t=Br();st(t,new wu(t,e))}we.STAT_EVENT="statevent";function bu(e,t){ft.call(this,we.STAT_EVENT,e),this.stat=t}ot(bu,ft);function bt(e){var t=Br();st(t,new bu(t,e))}we.Na="timingevent";function _u(e,t){ft.call(this,we.Na,e),this.size=t}ot(_u,ft);function Mn(e,t){if(typeof e!="function")throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){e()},t)}var Kr={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Eu={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Co(){}Co.prototype.h=null;function Iu(e){return e.h||(e.h=e.i())}function Tu(){}var Fn={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function Ro(){ft.call(this,"d")}ot(Ro,ft);function Oo(){ft.call(this,"c")}ot(Oo,ft);var xo;function zr(){}ot(zr,Co);zr.prototype.g=function(){return new XMLHttpRequest};zr.prototype.i=function(){return{}};xo=new zr;function Vn(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new Pn(this),this.P=zd,e=lo?125:void 0,this.W=new jr(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Su}function Su(){this.i=null,this.g="",this.h=!1}var zd=45e3,ko={},Gr={};S=Vn.prototype;S.setTimeout=function(e){this.P=e};function Po(e,t,n){e.K=1,e.v=Xr(Ht(t)),e.s=n,e.U=!0,Au(e,null)}function Au(e,t){e.F=Date.now(),Un(e),e.A=Ht(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),Lu(n.h,"t",r),e.C=0,n=e.l.H,e.h=new Su,e.g=ic(e.l,n?t:null,!e.s),0<e.O&&(e.L=new Ud(it(e.Ia,e,e.g),e.O)),yu(e.V,e.g,"readystatechange",e.gb),t=e.H?eu(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Ln(1),jd(e.j,e.u,e.A,e.m,e.X,e.s)}S.gb=function(e){e=e.target;var t=this.L;t&&Qt(e)==3?t.l():this.Ia(e)};S.Ia=function(e){try{if(e==this.g)t:{var t=Qt(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>t)&&(t!=3||lo||this.g&&(this.h.h||this.g.ga()||Qu(this.g)))){this.I||t!=4||n==7||(n==8||0>=r?Ln(3):Ln(2)),Hr(this);var i=this.g.ba();this.N=i;e:if(Du(this)){var o=Qu(this.g);e="";var s=o.length,a=Qt(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){be(this),jn(this);var u="";break e}this.h.i=new x.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,e+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=e,this.C=0,u=this.h.g}else u=this.g.ga();if(this.i=i==200,qd(this.j,this.u,this.A,this.m,this.X,t,i),this.i){if(this.$&&!this.J){e:{if(this.g){var c,h=this.g;if((c=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!xr(c)){var f=c;break e}}f=null}if(i=f)He(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Lo(this,i);else{this.i=!1,this.o=3,bt(12),be(this),jn(this);break t}}this.U?(Nu(this,t,u),lo&&this.i&&t==3&&(yu(this.V,this.W,"tick",this.fb),this.W.start())):(He(this.j,this.m,u,null),Lo(this,u)),t==4&&be(this),this.i&&!this.I&&(t==4?tc(this.l,this):(this.i=!1,Un(this)))}else i==400&&0<u.indexOf("Unknown SID")?(this.o=3,bt(12)):(this.o=0,bt(13)),be(this),jn(this)}}}catch(l){}finally{}};function Du(e){return e.g?e.u=="GET"&&e.K!=2&&e.l.Ba:!1}function Nu(e,t,n){for(var r=!0,i;!e.I&&e.C<n.length;)if(i=Gd(e,n),i==Gr){t==4&&(e.o=4,bt(14),r=!1),He(e.j,e.m,null,"[Incomplete Response]");break}else if(i==ko){e.o=4,bt(15),He(e.j,e.m,n,"[Invalid Chunk]"),r=!1;break}else He(e.j,e.m,i,null),Lo(e,i);Du(e)&&i!=Gr&&i!=ko&&(e.h.g="",e.C=0),t!=4||n.length!=0||e.h.h||(e.o=1,bt(16),r=!1),e.i=e.i&&r,r?0<n.length&&!e.aa&&(e.aa=!0,t=e.l,t.g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ho(t),t.L=!0,bt(11))):(He(e.j,e.m,n,"[Invalid Chunked Response]"),be(e),jn(e))}S.fb=function(){if(this.g){var e=Qt(this.g),t=this.g.ga();this.C<t.length&&(Hr(this),Nu(this,e,t),this.i&&e!=4&&Un(this))}};function Gd(e,t){var n=e.C,r=t.indexOf(`
`,n);return r==-1?Gr:(n=Number(t.substring(n,r)),isNaN(n)?ko:(r+=1,r+n>t.length?Gr:(t=t.substr(r,n),e.C=r+n,t)))}S.cancel=function(){this.I=!0,be(this)};function Un(e){e.Y=Date.now()+e.P,Cu(e,e.P)}function Cu(e,t){if(e.B!=null)throw Error("WatchDog timer not null");e.B=Mn(it(e.eb,e),t)}function Hr(e){e.B&&(x.clearTimeout(e.B),e.B=null)}S.eb=function(){this.B=null;var e=Date.now();0<=e-this.Y?(Bd(this.j,this.A),this.K!=2&&(Ln(3),bt(17)),be(this),this.o=2,jn(this)):Cu(this,this.Y-e)};function jn(e){e.l.G==0||e.I||tc(e.l,e)}function be(e){Hr(e);var t=e.L;t&&typeof t.na=="function"&&t.na(),e.L=null,Do(e.W),gu(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Lo(e,t){try{var n=e.l;if(n.G!=0&&(n.g==e||Vo(n.i,e))){if(n.I=e.N,!e.J&&Vo(n.i,e)&&n.G==3){try{var r=n.Ca.g.parse(t)}catch(w){r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0)t:if(!n.u){if(n.g)if(n.g.F+3e3<e.F)ni(n),ti(n);else break t;Go(n),bt(18)}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&n.A==0&&!n.v&&(n.v=Mn(it(n.ab,n),6e3));if(1>=Vu(n.i)&&n.ka){try{n.ka()}catch(w){}n.ka=void 0}}else Ie(n,11)}else if((e.J||n.g==e)&&ni(n),!xr(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){var o=i[t];if(n.U=o[0],o=o[1],n.G==2)if(o[0]=="c"){n.J=o[1],n.la=o[2];var s=o[3];s!=null&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];a!=null&&(n.za=a,n.h.info("SVER="+n.za));var u=o[5];u!=null&&typeof u=="number"&&0<u&&(r=1.5*u,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=e.g;if(c){var h=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var f=r.i;!f.g&&(mt(h,"spdy")||mt(h,"quic")||mt(h,"h2"))&&(f.j=f.l,f.g=new Set,f.h&&(Uo(f,f.h),f.h=null))}if(r.D){var l=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;l&&(r.sa=l,G(r.F,r.D,l))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms")),r=n;var d=e;if(r.oa=rc(r,r.H?r.la:null,r.W),d.J){Uu(r.i,d);var p=d,v=r.K;v&&p.setTimeout(v),p.B&&(Hr(p),Un(p)),r.g=d}else Ju(r);0<n.l.length&&ei(n)}else o[0]!="stop"&&o[0]!="close"||Ie(n,7);else n.G==3&&(o[0]=="stop"||o[0]=="close"?o[0]=="stop"?Ie(n,7):Ko(n):o[0]!="noop"&&n.j&&n.j.wa(o),n.A=0)}}Ln(4)}catch(w){}}function Hd(e){if(e.R&&typeof e.R=="function")return e.R();if(typeof e=="string")return e.split("");if(ro(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}t=[],n=0;for(r in e)t[n++]=e[r];return t}function Mo(e,t){if(e.forEach&&typeof e.forEach=="function")e.forEach(t,void 0);else if(ro(e)||typeof e=="string")Ja(e,t,void 0);else{if(e.T&&typeof e.T=="function")var n=e.T();else if(e.R&&typeof e.R=="function")n=void 0;else if(ro(e)||typeof e=="string"){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;r=Hd(e),i=r.length;for(var o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}}function Qe(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Qe)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}S=Qe.prototype;S.R=function(){Fo(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e};S.T=function(){return Fo(this),this.g.concat()};function Fo(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];_e(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)r=e.g[t],_e(i,r)||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}S.get=function(e,t){return _e(this.h,e)?this.h[e]:t};S.set=function(e,t){_e(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t};S.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);e.call(t,o,i,this)}};function _e(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var Ru=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Qd(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var o=e[n].substring(0,r);i=e[n].substring(r+1)}else o=e[n];t(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Ee(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Ee){this.g=t!==void 0?t:e.g,Qr(this,e.j),this.s=e.s,Wr(this,e.i),Yr(this,e.m),this.l=e.l,t=e.h;var n=new Kn;n.i=t.i,t.g&&(n.g=new Qe(t.g),n.h=t.h),Ou(this,n),this.o=e.o}else e&&(n=String(e).match(Ru))?(this.g=!!t,Qr(this,n[1]||"",!0),this.s=qn(n[2]||""),Wr(this,n[3]||"",!0),Yr(this,n[4]),this.l=qn(n[5]||"",!0),Ou(this,n[6]||"",!0),this.o=qn(n[7]||"")):(this.g=!!t,this.h=new Kn(null,this.g))}Ee.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Bn(t,xu,!0),":");var n=this.i;return(n||t=="file")&&(e.push("//"),(t=this.s)&&e.push(Bn(t,xu,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.m,n!=null&&e.push(":",String(n))),(n=this.l)&&(this.i&&n.charAt(0)!="/"&&e.push("/"),e.push(Bn(n,n.charAt(0)=="/"?Jd:$d,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Bn(n,tp)),e.join("")};function Ht(e){return new Ee(e)}function Qr(e,t,n){e.j=n?qn(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Wr(e,t,n){e.i=n?qn(t,!0):t}function Yr(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Ou(e,t,n){t instanceof Kn?(e.h=t,ep(e.h,e.g)):(n||(t=Bn(t,Zd)),e.h=new Kn(t,e.g))}function G(e,t,n){e.h.set(t,n)}function Xr(e){return G(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Wd(e){return e instanceof Ee?Ht(e):new Ee(e,void 0)}function Yd(e,t,n,r){var i=new Ee(null,void 0);return e&&Qr(i,e),t&&Wr(i,t),n&&Yr(i,n),r&&(i.l=r),i}function qn(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Bn(e,t,n){return typeof e=="string"?(e=encodeURI(e).replace(t,Xd),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Xd(e){return e=e.charCodeAt(0),"%"+(e>>4&15).toString(16)+(e&15).toString(16)}var xu=/[#\/\?@]/g,$d=/[#\?:]/g,Jd=/[#\?]/g,Zd=/[#\?@]/g,tp=/#/g;function Kn(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ee(e){e.g||(e.g=new Qe,e.h=0,e.i&&Qd(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}S=Kn.prototype;S.add=function(e,t){ee(this),this.i=null,e=We(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this};function ku(e,t){ee(e),t=We(e,t),_e(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,e=e.g,_e(e.h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&Fo(e)))}function Pu(e,t){return ee(e),t=We(e,t),_e(e.g.h,t)}S.forEach=function(e,t){ee(this),this.g.forEach(function(n,r){Ja(n,function(i){e.call(t,i,r,this)},this)},this)};S.T=function(){ee(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],o=0;o<i.length;o++)n.push(t[r]);return n};S.R=function(e){ee(this);var t=[];if(typeof e=="string")Pu(this,e)&&(t=Za(t,this.g.get(We(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=Za(t,e[n])}return t};S.set=function(e,t){return ee(this),this.i=null,e=We(this,e),Pu(this,e)&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this};S.get=function(e,t){return e?(e=this.R(e),0<e.length?String(e[0]):t):t};function Lu(e,t,n){ku(e,t),0<n.length&&(e.i=null,e.g.set(We(e,t),oo(n)),e.h+=n.length)}S.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;r[o]!==""&&(s+="="+encodeURIComponent(String(r[o]))),e.push(s)}}return this.i=e.join("&")};function We(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function ep(e,t){t&&!e.j&&(ee(e),e.i=null,e.g.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(ku(this,r),Lu(this,i,n))},e)),e.j=t}var np=function(){function e(t,n){this.h=t,this.g=n}return e}();function Mu(e){this.l=e||rp,x.PerformanceNavigationTiming?(e=x.performance.getEntriesByType("navigation"),e=0<e.length&&(e[0].nextHopProtocol=="hq"||e[0].nextHopProtocol=="h2")):e=!!(x.g&&x.g.Ea&&x.g.Ea()&&x.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var rp=10;function Fu(e){return e.h?!0:e.g?e.g.size>=e.j:!1}function Vu(e){return e.h?1:e.g?e.g.size:0}function Vo(e,t){return e.h?e.h==t:e.g?e.g.has(t):!1}function Uo(e,t){e.g?e.g.add(t):e.h=t}function Uu(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}Mu.prototype.cancel=function(){var e,t;if(this.i=ju(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){try{for(var n=Xa(this.g.values()),r=n.next();!r.done;r=n.next()){var i=r.value;i.cancel()}}catch(o){e={error:o}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.g.clear()}};function ju(e){var t,n;if(e.h!=null)return e.i.concat(e.h.D);if(e.g!=null&&e.g.size!==0){var r=e.i;try{for(var i=Xa(e.g.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.D)}}catch(a){t={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}return oo(e.i)}function jo(){}jo.prototype.stringify=function(e){return x.JSON.stringify(e,void 0)};jo.prototype.parse=function(e){return x.JSON.parse(e,void 0)};function ip(){this.g=new jo}function op(e,t,n){var r=n||"";try{Mo(e,function(i,o){var s=i;On(i)&&(s=Io(i)),t.push(r+o+"="+encodeURIComponent(s))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function sp(e,t){var n=new qr;if(x.Image){var r=new Image;r.onload=Or($r,n,r,"TestLoadImage: loaded",!0,t),r.onerror=Or($r,n,r,"TestLoadImage: error",!1,t),r.onabort=Or($r,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=Or($r,n,r,"TestLoadImage: timeout",!1,t),x.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function $r(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(o){}}function zn(e){this.l=e.$b||null,this.j=e.ib||!1}ot(zn,Co);zn.prototype.g=function(){return new Jr(this.l,this.j)};zn.prototype.i=function(e){return function(){return e}}({});function Jr(e,t){et.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=qo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ot(Jr,et);var qo=0;S=Jr.prototype;S.open=function(e,t){if(this.readyState!=qo)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Hn(this)};S.send=function(e){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||x).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))};S.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Gn(this)),this.readyState=qo};S.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Hn(this)),this.g&&(this.readyState=3,Hn(this),this.g)))if(this.responseType==="arraybuffer")e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(typeof x.ReadableStream!="undefined"&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;qu(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))};function qu(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}S.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Gn(this):Hn(this),this.readyState==3&&qu(this)}};S.Ua=function(e){this.g&&(this.response=this.responseText=e,Gn(this))};S.Ta=function(e){this.g&&(this.response=e,Gn(this))};S.ha=function(){this.g&&Gn(this)};function Gn(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Hn(e)}S.setRequestHeader=function(e,t){this.v.append(e,t)};S.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""};S.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join(`\r
`)};function Hn(e){e.onreadystatechange&&e.onreadystatechange.call(e)}Object.defineProperty(Jr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(e){this.m=e?"include":"same-origin"}});var ap=x.JSON.parse;function Y(e){et.call(this),this.headers=new Qe,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Bu,this.K=this.L=!1}ot(Y,et);var Bu="",up=/^https?$/i,cp=["POST","PUT"];S=Y.prototype;S.ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():xo.g(),this.C=this.u?Iu(this.u):Iu(xo),this.g.onreadystatechange=it(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(o){Ku(this,o);return}e=n||"";var i=new Qe(this.headers);r&&Mo(r,function(o,s){i.set(s,o)}),r=bd(i.T()),n=x.FormData&&e instanceof x.FormData,!(0<=$a(cp,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(o,s){this.g.setRequestHeader(s,o)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Hu(this),0<this.B&&((this.K=hp(this.g))?(this.g.timeout=this.B,this.g.ontimeout=it(this.pa,this)):this.A=No(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(o){Ku(this,o)}};function hp(e){return Ge&&Sd()&&typeof e.timeout=="number"&&e.ontimeout!==void 0}function lp(e){return e.toLowerCase()=="content-type"}S.pa=function(){typeof no!="undefined"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,st(this,"timeout"),this.abort(8))};function Ku(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,zu(e),Zr(e)}function zu(e){e.D||(e.D=!0,st(e,"complete"),st(e,"error"))}S.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,st(this,"complete"),st(this,"abort"),Zr(this))};S.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Zr(this,!0)),Y.Z.M.call(this)};S.Fa=function(){this.s||(this.F||this.v||this.l?Gu(this):this.cb())};S.cb=function(){Gu(this)};function Gu(e){if(e.h&&typeof no!="undefined"&&(!e.C[1]||Qt(e)!=4||e.ba()!=2)){if(e.v&&Qt(e)==4)No(e.Fa,0,e);else if(st(e,"readystatechange"),Qt(e)==4){e.h=!1;try{var t=e.ba();t:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var n=!0;break t;default:n=!1}var r;if(!(r=n)){var i;if(i=t===0){var o=String(e.H).match(Ru)[1]||null;if(!o&&x.self&&x.self.location){var s=x.self.location.protocol;o=s.substr(0,s.length-1)}i=!up.test(o?o.toLowerCase():"")}r=i}if(r)st(e,"complete"),st(e,"success");else{e.m=6;try{var a=2<Qt(e)?e.g.statusText:""}catch(u){a=""}e.j=a+" ["+e.ba()+"]",zu(e)}}finally{Zr(e)}}}}function Zr(e,t){if(e.g){Hu(e);var n=e.g,r=e.C[0]?Rr:null;e.g=null,e.C=null,t||st(e,"ready");try{n.onreadystatechange=r}catch(i){}}}function Hu(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(x.clearTimeout(e.A),e.A=null)}function Qt(e){return e.g?e.g.readyState:0}S.ba=function(){try{return 2<Qt(this)?this.g.status:-1}catch(e){return-1}};S.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}};S.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&t.indexOf(e)==0&&(t=t.substring(e.length)),ap(t)}};function Qu(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Bu:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}S.Da=function(){return this.m};S.La=function(){return typeof this.j=="string"?this.j:String(this.j)};function fp(e){var t="";return co(e,function(n,r){t+=r,t+=":",t+=n,t+=`\r
`}),t}function Bo(e,t,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=fp(n),typeof e=="string"?n!=null&&encodeURIComponent(String(n)):G(e,t,n))}function Qn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Wu(e){this.za=0,this.l=[],this.h=new qr,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Qn("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Qn("baseRetryDelayMs",5e3,e),this.$a=Qn("retryDelaySeedMs",1e4,e),this.Ya=Qn("forwardChannelMaxRetries",2,e),this.ra=Qn("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new Mu(e&&e.concurrentRequestLimit),this.Ca=new ip,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||e.Xb!==!1}S=Wu.prototype;S.ma=8;S.G=1;function Ko(e){if(Yu(e),e.G==3){var t=e.V++,n=Ht(e.F);G(n,"SID",e.J),G(n,"RID",t),G(n,"TYPE","terminate"),Wn(e,n),t=new Vn(e,e.h,t,void 0),t.K=2,t.v=Xr(Ht(n)),n=!1,x.navigator&&x.navigator.sendBeacon&&(n=x.navigator.sendBeacon(t.v.toString(),"")),!n&&x.Image&&(new Image().src=t.v,n=!0),n||(t.g=ic(t.l,null),t.g.ea(t.v)),t.F=Date.now(),Un(t)}nc(e)}S.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(t){}};function ti(e){e.g&&(Ho(e),e.g.cancel(),e.g=null)}function Yu(e){ti(e),e.u&&(x.clearTimeout(e.u),e.u=null),ni(e),e.i.cancel(),e.m&&(typeof e.m=="number"&&x.clearTimeout(e.m),e.m=null)}function zo(e,t){e.l.push(new np(e.Za++,t)),e.G==3&&ei(e)}function ei(e){Fu(e.i)||e.m||(e.m=!0,To(e.Ha,e),e.C=0)}function dp(e,t){return Vu(e.i)>=e.i.j-(e.m?1:0)?!1:e.m?(e.l=t.D.concat(e.l),!0):e.G==1||e.G==2||e.C>=(e.Xa?0:e.Ya)?!1:(e.m=Mn(it(e.Ha,e,t),ec(e,e.C)),e.C++,!0)}S.Ha=function(e){if(this.m)if(this.m=null,this.G==1){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;var t=new Vn(this,this.h,e,void 0),n=this.s;if(this.P&&(n?(n=eu(n),ru(n,this.P)):n=this.P),this.o===null&&(t.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){e:{var o=this.l[i];if("__data__"in o.g&&(o=o.g.__data__,typeof o=="string")){o=o.length;break e}o=void 0}if(o===void 0)break;if(r+=o,4096<r){r=i;break t}if(r===4096||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=$u(this,t,r),i=Ht(this.F),G(i,"RID",e),G(i,"CVER",22),this.D&&G(i,"X-HTTP-Session-Id",this.D),Wn(this,i),this.o&&n&&Bo(i,this.o,n),Uo(this.i,t),this.Ra&&G(i,"TYPE","init"),this.ja?(G(i,"$req",r),G(i,"SID","null"),t.$=!0,Po(t,i,null)):Po(t,i,r),this.G=2}}else this.G==3&&(e?Xu(this,e):this.l.length==0||Fu(this.i)||Xu(this))};function Xu(e,t){var n;t?n=t.m:n=e.V++;var r=Ht(e.F);G(r,"SID",e.J),G(r,"RID",n),G(r,"AID",e.U),Wn(e,r),e.o&&e.s&&Bo(r,e.o,e.s),n=new Vn(e,e.h,n,e.C+1),e.o===null&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=$u(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),Uo(e.i,n),Po(n,r,t)}function Wn(e,t){e.j&&Mo({},function(n,r){G(t,r,n)})}function $u(e,t,n){n=Math.min(e.l.length,n);var r=e.j?it(e.j.Oa,e.j,e):null;t:for(var i=e.l,o=-1;;){var s=["count="+n];o==-1?0<n?(o=i[0].h,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].h,h=i[u].g;if(c-=o,0>c)o=Math.max(0,i[u].h-100),a=!1;else try{op(h,s,"req"+c+"_")}catch(f){r&&r(h)}}if(a){r=s.join("&");break t}}return e=e.l.splice(0,n),t.D=e,r}function Ju(e){e.g||e.u||(e.Y=1,To(e.Ga,e),e.A=0)}function Go(e){return e.g||e.u||3<=e.A?!1:(e.Y++,e.u=Mn(it(e.Ga,e),ec(e,e.A)),e.A++,!0)}S.Ga=function(){if(this.u=null,Zu(this),this.$&&!(this.L||this.g==null||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=Mn(it(this.bb,this),e)}};S.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,bt(10),ti(this),Zu(this))};function Ho(e){e.B!=null&&(x.clearTimeout(e.B),e.B=null)}function Zu(e){e.g=new Vn(e,e.h,"rpc",e.Y),e.o===null&&(e.g.H=e.s),e.g.O=0;var t=Ht(e.oa);G(t,"RID","rpc"),G(t,"SID",e.J),G(t,"CI",e.N?"0":"1"),G(t,"AID",e.U),Wn(e,t),G(t,"TYPE","xmlhttp"),e.o&&e.s&&Bo(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=Xr(Ht(t)),n.s=null,n.U=!0,Au(n,e)}S.ab=function(){this.v!=null&&(this.v=null,ti(this),Go(this),bt(19))};function ni(e){e.v!=null&&(x.clearTimeout(e.v),e.v=null)}function tc(e,t){var n=null;if(e.g==t){ni(e),Ho(e),e.g=null;var r=2}else if(Vo(e.i,t))n=t.D,Uu(e.i,t),r=1;else return;if(e.I=t.N,e.G!=0){if(t.i)if(r==1){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;r=Br(),st(r,new _u(r,n,t,i)),ei(e)}else Ju(e);else if(i=t.o,i==3||i==0&&0<e.I||!(r==1&&dp(e,t)||r==2&&Go(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:Ie(e,5);break;case 4:Ie(e,10);break;case 3:Ie(e,6);break;default:Ie(e,2)}}}function ec(e,t){var n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function Ie(e,t){if(e.h.info("Error code "+t),t==2){var n=null;e.j&&(n=null);var r=it(e.jb,e);n||(n=new Ee("//www.google.com/images/cleardot.gif"),x.location&&x.location.protocol=="http"||Qr(n,"https"),Xr(n)),sp(n.toString(),r)}else bt(2);e.G=0,e.j&&e.j.va(t),nc(e),Yu(e)}S.jb=function(e){e?(this.h.info("Successfully pinged google.com"),bt(2)):(this.h.info("Failed to ping google.com"),bt(1))};function nc(e){e.G=0,e.I=-1,e.j&&((ju(e.i).length!=0||e.l.length!=0)&&(e.i.i.length=0,oo(e.l),e.l.length=0),e.j.ua())}function rc(e,t,n){var r=Wd(n);if(r.i!="")t&&Wr(r,t+"."+r.i),Yr(r,r.m);else{var i=x.location;r=Yd(i.protocol,t?t+"."+i.hostname:i.hostname,+i.port,n)}return e.aa&&co(e.aa,function(o,s){G(r,s,o)}),t=e.D,n=e.sa,t&&n&&G(r,t,n),G(r,"VER",e.ma),Wn(e,r),r}function ic(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return t=n&&e.Ba&&!e.qa?new Y(new zn({ib:!0})):new Y(e.qa),t.L=e.H,t}function oc(){}S=oc.prototype;S.xa=function(){};S.wa=function(){};S.va=function(){};S.ua=function(){};S.Oa=function(){};function ri(){if(Ge&&!(10<=Number(Ad)))throw Error("Environmental error: no available transport.")}ri.prototype.g=function(e,t){return new At(e,t)};function At(e,t){et.call(this),this.g=new Wu(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!xr(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!xr(t)&&(this.g.D=t,e=this.h,e!==null&&t in e&&(e=this.h,t in e&&delete e[t])),this.j=new Ye(this)}ot(At,et);At.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),To(it(e.hb,e,t))),bt(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=rc(e,null,e.W),ei(e)};At.prototype.close=function(){Ko(this.g)};At.prototype.u=function(e){if(typeof e=="string"){var t={};t.__data__=e,zo(this.g,t)}else this.v?(t={},t.__data__=Io(e),zo(this.g,t)):zo(this.g,e)};At.prototype.M=function(){this.g.j=null,delete this.j,Ko(this.g),delete this.g,At.Z.M.call(this)};function sc(e){Ro.call(this);var t=e.__sm__;if(t){t:{for(var n in t){e=n;break t}e=void 0}(this.i=e)&&(e=this.i,t=t!==null&&e in t?t[e]:void 0),this.data=t}else this.data=e}ot(sc,Ro);function ac(){Oo.call(this),this.status=1}ot(ac,Oo);function Ye(e){this.g=e}ot(Ye,oc);Ye.prototype.xa=function(){st(this.g,"a")};Ye.prototype.wa=function(e){st(this.g,new sc(e))};Ye.prototype.va=function(e){st(this.g,new ac(e))};Ye.prototype.ua=function(){st(this.g,"b")};ri.prototype.createWebChannel=ri.prototype.g;At.prototype.send=At.prototype.u;At.prototype.open=At.prototype.m;At.prototype.close=At.prototype.close;Kr.NO_ERROR=0;Kr.TIMEOUT=8;Kr.HTTP_ERROR=6;Eu.COMPLETE="complete";Tu.EventType=Fn;Fn.OPEN="a";Fn.CLOSE="b";Fn.ERROR="c";Fn.MESSAGE="d";et.prototype.listen=et.prototype.N;Y.prototype.listenOnce=Y.prototype.O;Y.prototype.getLastError=Y.prototype.La;Y.prototype.getLastErrorCode=Y.prototype.Da;Y.prototype.getStatus=Y.prototype.ba;Y.prototype.getResponseJson=Y.prototype.Qa;Y.prototype.getResponseText=Y.prototype.ga;Y.prototype.send=Y.prototype.ea;var uc=function(){return new ri},cc=function(){return Br()},ii=Kr,hc=Eu,lc=we,Qo={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},fc=zn,Yn=Tu,dc=Y;var Dt=function(){function e(t,n){var r=this;this.previousValue=t,n&&(n.sequenceNumberHandler=function(i){return r.t(i)},this.i=function(i){return n.writeSequenceNumber(i)})}return e.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},e.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},e}();Dt.o=-1;var y={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},b=function(e){function t(n,r){var i=this;return(i=e.call(this,r)||this).code=n,i.message=r,i.name="FirebaseError",i.toString=function(){return i.name+": [code="+i.code+"]: "+i.message},i}return R(t,e),t}(Error),Ft=new Dr("@firebase/firestore");function Wo(){return Ft.logLevel}function I(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Ft.logLevel<=V.DEBUG){var r=t.map(Yo);Ft.debug.apply(Ft,z(["Firestore (8.10.0): "+e],r))}}function X(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Ft.logLevel<=V.ERROR){var r=t.map(Yo);Ft.error.apply(Ft,z(["Firestore (8.10.0): "+e],r))}}function oi(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Ft.logLevel<=V.WARN){var r=t.map(Yo);Ft.warn.apply(Ft,z(["Firestore (8.10.0): "+e],r))}}function Yo(e){if(typeof e=="string")return e;try{return t=e,JSON.stringify(t)}catch(n){return e}var t}function N(e){e===void 0&&(e="Unexpected state");var t="FIRESTORE (8.10.0) INTERNAL ASSERTION FAILED: "+e;throw X(t),new Error(t)}function O(e,t){e||N()}function T(e,t){return e}function pp(e){var t=typeof self!="undefined"&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}var pc=function(){function e(){}return e.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length,r="";r.length<20;)for(var i=pp(40),o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=t.charAt(i[o]%t.length));return r},e}();function L(e,t){return e<t?-1:e>t?1:0}function Xe(e,t,n){return e.length===t.length&&e.every(function(r,i){return n(r,t[i])})}function vc(e){return e+"\0"}var _t=function(){function e(t,n){if(this.seconds=t,this.nanoseconds=n,n<0)throw new b(y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new b(y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new b(y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new b(y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return e.now=function(){return e.fromMillis(Date.now())},e.fromDate=function(t){return e.fromMillis(t.getTime())},e.fromMillis=function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))},e.prototype.toDate=function(){return new Date(this.toMillis())},e.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},e.prototype._compareTo=function(t){return this.seconds===t.seconds?L(this.nanoseconds,t.nanoseconds):L(this.seconds,t.seconds)},e.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},e.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},e.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},e.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},e}(),P=function(){function e(t){this.timestamp=t}return e.fromTimestamp=function(t){return new e(t)},e.min=function(){return new e(new _t(0,0))},e.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},e.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},e.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},e.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},e.prototype.toTimestamp=function(){return this.timestamp},e}();function yc(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Te(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function gc(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var mc=function(){function e(t,n,r){n===void 0?n=0:n>t.length&&N(),r===void 0?r=t.length-n:r>t.length-n&&N(),this.segments=t,this.offset=n,this.len=r}return Object.defineProperty(e.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return e.comparator(this,t)===0},e.prototype.child=function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach(function(r){n.push(r)}):n.push(t),this.construct(n)},e.prototype.limit=function(){return this.offset+this.length},e.prototype.popFirst=function(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)},e.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},e.prototype.firstSegment=function(){return this.segments[this.offset]},e.prototype.lastSegment=function(){return this.get(this.length-1)},e.prototype.get=function(t){return this.segments[this.offset+t]},e.prototype.isEmpty=function(){return this.length===0},e.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0},e.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0},e.prototype.forEach=function(t){for(var n=this.offset,r=this.limit();n<r;n++)t(this.segments[n])},e.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},e.comparator=function(t,n){for(var r=Math.min(t.length,n.length),i=0;i<r;i++){var o=t.get(i),s=n.get(i);if(o<s)return-1;if(o>s)return 1}return t.length<n.length?-1:t.length>n.length?1:0},e}(),U=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.construct=function(n,r,i){return new t(n,r,i)},t.prototype.canonicalString=function(){return this.toArray().join("/")},t.prototype.toString=function(){return this.canonicalString()},t.fromString=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];for(var i=[],o=0,s=n;o<s.length;o++){var a=s[o];if(a.indexOf("//")>=0)throw new b(y.INVALID_ARGUMENT,"Invalid segment ("+a+"). Paths must not contain // in them.");i.push.apply(i,a.split("/").filter(function(u){return u.length>0}))}return new t(i)},t.emptyPath=function(){return new t([])},t}(mc),vp=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Vt=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.construct=function(n,r,i){return new t(n,r,i)},t.isValidIdentifier=function(n){return vp.test(n)},t.prototype.canonicalString=function(){return this.toArray().map(function(n){return n=n.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t.isValidIdentifier(n)||(n="`"+n+"`"),n}).join(".")},t.prototype.toString=function(){return this.canonicalString()},t.prototype.isKeyField=function(){return this.length===1&&this.get(0)==="__name__"},t.keyField=function(){return new t(["__name__"])},t.fromServerFormat=function(n){for(var r=[],i="",o=0,s=function(){if(i.length===0)throw new b(y.INVALID_ARGUMENT,"Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");r.push(i),i=""},a=!1;o<n.length;){var u=n[o];if(u==="\\"){if(o+1===n.length)throw new b(y.INVALID_ARGUMENT,"Path has trailing escape character: "+n);var c=n[o+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new b(y.INVALID_ARGUMENT,"Path has invalid escape sequence: "+n);i+=c,o+=2}else u==="`"?(a=!a,o++):u!=="."||a?(i+=u,o++):(s(),o++)}if(s(),a)throw new b(y.INVALID_ARGUMENT,"Unterminated ` in path: "+n);return new t(r)},t.emptyPath=function(){return new t([])},t}(mc),$e=function(){function e(t){this.fields=t,t.sort(Vt.comparator)}return e.prototype.covers=function(t){for(var n=0,r=this.fields;n<r.length;n++)if(r[n].isPrefixOf(t))return!0;return!1},e.prototype.isEqual=function(t){return Xe(this.fields,t.fields,function(n,r){return n.isEqual(r)})},e}(),Et=function(){function e(t){this.binaryString=t}return e.fromBase64String=function(t){return new e(atob(t))},e.fromUint8Array=function(t){return new e(function(n){for(var r="",i=0;i<n.length;++i)r+=String.fromCharCode(n[i]);return r}(t))},e.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},e.prototype.toUint8Array=function(){return function(t){for(var n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(this.binaryString)},e.prototype.approximateByteSize=function(){return 2*this.binaryString.length},e.prototype.compareTo=function(t){return L(this.binaryString,t.binaryString)},e.prototype.isEqual=function(t){return this.binaryString===t.binaryString},e}();Et.EMPTY_BYTE_STRING=new Et("");var yp=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ne(e){if(O(!!e),typeof e=="string"){var t=0,n=yp.exec(e);if(O(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:$(e.seconds),nanos:$(e.nanos)}}function $(e){return typeof e=="number"?e:typeof e=="string"?Number(e):0}function Je(e){return typeof e=="string"?Et.fromBase64String(e):Et.fromUint8Array(e)}function Xo(e){var t,n;return((n=(((t=e==null?void 0:e.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function wc(e){var t=e.mapValue.fields.__previous_value__;return Xo(t)?wc(t):t}function Xn(e){var t=ne(e.mapValue.fields.__local_write_time__.timestampValue);return new _t(t.seconds,t.nanos)}function Se(e){return e==null}function si(e){return e===0&&1/e==-1/0}function bc(e){return typeof e=="number"&&Number.isInteger(e)&&!si(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var C=function(){function e(t){this.path=t}return e.fromPath=function(t){return new e(U.fromString(t))},e.fromName=function(t){return new e(U.fromString(t).popFirst(5))},e.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},e.prototype.isEqual=function(t){return t!==null&&U.comparator(this.path,t.path)===0},e.prototype.toString=function(){return this.path.toString()},e.comparator=function(t,n){return U.comparator(t.path,n.path)},e.isDocumentKey=function(t){return t.length%2==0},e.fromSegments=function(t){return new e(new U(t.slice()))},e}();function Ae(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Xo(e)?4:10:N()}function qt(e,t){var n=Ae(e);if(n!==Ae(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Xn(e).isEqual(Xn(t));case 3:return function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;var o=ne(r.timestampValue),s=ne(i.timestampValue);return o.seconds===s.seconds&&o.nanos===s.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(r,i){return Je(r.bytesValue).isEqual(Je(i.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(r,i){return $(r.geoPointValue.latitude)===$(i.geoPointValue.latitude)&&$(r.geoPointValue.longitude)===$(i.geoPointValue.longitude)}(e,t);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return $(r.integerValue)===$(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){var o=$(r.doubleValue),s=$(i.doubleValue);return o===s?si(o)===si(s):isNaN(o)&&isNaN(s)}return!1}(e,t);case 9:return Xe(e.arrayValue.values||[],t.arrayValue.values||[],qt);case 10:return function(r,i){var o=r.mapValue.fields||{},s=i.mapValue.fields||{};if(yc(o)!==yc(s))return!1;for(var a in o)if(o.hasOwnProperty(a)&&(s[a]===void 0||!qt(o[a],s[a])))return!1;return!0}(e,t);default:return N()}}function $n(e,t){return(e.values||[]).find(function(n){return qt(n,t)})!==void 0}function Ze(e,t){var n=Ae(e),r=Ae(t);if(n!==r)return L(n,r);switch(n){case 0:return 0;case 1:return L(e.booleanValue,t.booleanValue);case 2:return function(i,o){var s=$(i.integerValue||i.doubleValue),a=$(o.integerValue||o.doubleValue);return s<a?-1:s>a?1:s===a?0:isNaN(s)?isNaN(a)?0:-1:1}(e,t);case 3:return _c(e.timestampValue,t.timestampValue);case 4:return _c(Xn(e),Xn(t));case 5:return L(e.stringValue,t.stringValue);case 6:return function(i,o){var s=Je(i),a=Je(o);return s.compareTo(a)}(e.bytesValue,t.bytesValue);case 7:return function(i,o){for(var s=i.split("/"),a=o.split("/"),u=0;u<s.length&&u<a.length;u++){var c=L(s[u],a[u]);if(c!==0)return c}return L(s.length,a.length)}(e.referenceValue,t.referenceValue);case 8:return function(i,o){var s=L($(i.latitude),$(o.latitude));return s!==0?s:L($(i.longitude),$(o.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(i,o){for(var s=i.values||[],a=o.values||[],u=0;u<s.length&&u<a.length;++u){var c=Ze(s[u],a[u]);if(c)return c}return L(s.length,a.length)}(e.arrayValue,t.arrayValue);case 10:return function(i,o){var s=i.fields||{},a=Object.keys(s),u=o.fields||{},c=Object.keys(u);a.sort(),c.sort();for(var h=0;h<a.length&&h<c.length;++h){var f=L(a[h],c[h]);if(f!==0)return f;var l=Ze(s[a[h]],u[c[h]]);if(l!==0)return l}return L(a.length,c.length)}(e.mapValue,t.mapValue);default:throw N()}}function _c(e,t){if(typeof e=="string"&&typeof t=="string"&&e.length===t.length)return L(e,t);var n=ne(e),r=ne(t),i=L(n.seconds,r.seconds);return i!==0?i:L(n.nanos,r.nanos)}function $o(e){return Jo(e)}function Jo(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(r){var i=ne(r);return"time("+i.seconds+","+i.nanos+")"}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Je(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,C.fromName(n).toString()):"geoPointValue"in e?"geo("+(t=e.geoPointValue).latitude+","+t.longitude+")":"arrayValue"in e?function(r){for(var i="[",o=!0,s=0,a=r.values||[];s<a.length;s++)o?o=!1:i+=",",i+=Jo(a[s]);return i+"]"}(e.arrayValue):"mapValue"in e?function(r){for(var i="{",o=!0,s=0,a=Object.keys(r.fields||{}).sort();s<a.length;s++){var u=a[s];o?o=!1:i+=",",i+=u+":"+Jo(r.fields[u])}return i+"}"}(e.mapValue):N();var t,n}function ai(e,t){return{referenceValue:"projects/"+e.projectId+"/databases/"+e.database+"/documents/"+t.path.canonicalString()}}function Zo(e){return!!e&&"integerValue"in e}function ts(e){return!!e&&"arrayValue"in e}function Ec(e){return!!e&&"nullValue"in e}function Ic(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ui(e){return!!e&&"mapValue"in e}function Jn(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&typeof e.timestampValue=="object")return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return Te(e.mapValue.fields,function(i,o){return t.mapValue.fields[i]=Jn(o)}),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Jn(e.arrayValue.values[r]);return n}return Object.assign({},e)}var Nt=function(){function e(t){this.value=t}return e.empty=function(){return new e({mapValue:{}})},e.prototype.field=function(t){if(t.isEmpty())return this.value;for(var n=this.value,r=0;r<t.length-1;++r)if(!ui(n=(n.mapValue.fields||{})[t.get(r)]))return null;return(n=(n.mapValue.fields||{})[t.lastSegment()])||null},e.prototype.set=function(t,n){this.getFieldsMap(t.popLast())[t.lastSegment()]=Jn(n)},e.prototype.setAll=function(t){var n=this,r=Vt.emptyPath(),i={},o=[];t.forEach(function(a,u){if(!r.isImmediateParentOf(u)){var c=n.getFieldsMap(r);n.applyChanges(c,i,o),i={},o=[],r=u.popLast()}a?i[u.lastSegment()]=Jn(a):o.push(u.lastSegment())});var s=this.getFieldsMap(r);this.applyChanges(s,i,o)},e.prototype.delete=function(t){var n=this.field(t.popLast());ui(n)&&n.mapValue.fields&&delete n.mapValue.fields[t.lastSegment()]},e.prototype.isEqual=function(t){return qt(this.value,t.value)},e.prototype.getFieldsMap=function(t){var n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(var r=0;r<t.length;++r){var i=n.mapValue.fields[t.get(r)];ui(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[t.get(r)]=i),n=i}return n.mapValue.fields},e.prototype.applyChanges=function(t,n,r){Te(n,function(a,u){return t[a]=u});for(var i=0,o=r;i<o.length;i++){var s=o[i];delete t[s]}},e.prototype.clone=function(){return new e(Jn(this.value))},e}();function Tc(e){var t=[];return Te(e.fields,function(n,r){var i=new Vt([n]);if(ui(r)){var o=Tc(r.mapValue).fields;if(o.length===0)t.push(i);else for(var s=0,a=o;s<a.length;s++){var u=a[s];t.push(i.child(u))}}else t.push(i)}),new $e(t)}var at=function(){function e(t,n,r,i,o){this.key=t,this.documentType=n,this.version=r,this.data=i,this.documentState=o}return e.newInvalidDocument=function(t){return new e(t,0,P.min(),Nt.empty(),0)},e.newFoundDocument=function(t,n,r){return new e(t,1,n,r,0)},e.newNoDocument=function(t,n){return new e(t,2,n,Nt.empty(),0)},e.newUnknownDocument=function(t,n){return new e(t,3,n,Nt.empty(),2)},e.prototype.convertToFoundDocument=function(t,n){return this.version=t,this.documentType=1,this.data=n,this.documentState=0,this},e.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Nt.empty(),this.documentState=0,this},e.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Nt.empty(),this.documentState=2,this},e.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},e.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(e.prototype,"hasLocalMutations",{get:function(){return this.documentState===1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCommittedMutations",{get:function(){return this.documentState===2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isValidDocument=function(){return this.documentType!==0},e.prototype.isFoundDocument=function(){return this.documentType===1},e.prototype.isNoDocument=function(){return this.documentType===2},e.prototype.isUnknownDocument=function(){return this.documentType===3},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},e.prototype.clone=function(){return new e(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},e}(),gp=function(e,t,n,r,i,o,s){t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o=null),s===void 0&&(s=null),this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Sc(e,t,n,r,i,o,s){return t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o=null),s===void 0&&(s=null),new gp(e,t,n,r,i,o,s)}function Zn(e){var t=T(e);if(t.h===null){var n=t.path.canonicalString();t.collectionGroup!==null&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map(function(r){return function(i){return i.field.canonicalString()+i.op.toString()+$o(i.value)}(r)}).join(","),n+="|ob:",n+=t.orderBy.map(function(r){return function(i){return i.field.canonicalString()+i.dir}(r)}).join(","),Se(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=li(t.startAt)),t.endAt&&(n+="|ub:",n+=li(t.endAt)),t.h=n}return t.h}function ci(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!Sp(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(i=e.filters[r],o=t.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!qt(i.value,o.value))return!1;var i,o;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Nc(e.startAt,t.startAt)&&Nc(e.endAt,t.endAt)}function hi(e){return C.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}var Ct=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).field=n,o.op=r,o.value=i,o}return R(t,e),t.create=function(n,r,i){return n.isKeyField()?r==="in"||r==="not-in"?this.l(n,r,i):new mp(n,r,i):r==="array-contains"?new _p(n,i):r==="in"?new Ep(n,i):r==="not-in"?new Ip(n,i):r==="array-contains-any"?new Tp(n,i):new t(n,r,i)},t.l=function(n,r,i){return r==="in"?new wp(n,i):new bp(n,i)},t.prototype.matches=function(n){var r=n.data.field(this.field);return this.op==="!="?r!==null&&this.m(Ze(r,this.value)):r!==null&&Ae(this.value)===Ae(r)&&this.m(Ze(r,this.value))},t.prototype.m=function(n){switch(this.op){case"<":return n<0;case"<=":return n<=0;case"==":return n===0;case"!=":return n!==0;case">":return n>0;case">=":return n>=0;default:return N()}},t.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},t}(function(){}),mp=function(e){function t(n,r,i){var o=this;return(o=e.call(this,n,r,i)||this).key=C.fromName(i.referenceValue),o}return R(t,e),t.prototype.matches=function(n){var r=C.comparator(n.key,this.key);return this.m(r)},t}(Ct),wp=function(e){function t(n,r){var i=this;return(i=e.call(this,n,"in",r)||this).keys=Ac("in",r),i}return R(t,e),t.prototype.matches=function(n){return this.keys.some(function(r){return r.isEqual(n.key)})},t}(Ct),bp=function(e){function t(n,r){var i=this;return(i=e.call(this,n,"not-in",r)||this).keys=Ac("not-in",r),i}return R(t,e),t.prototype.matches=function(n){return!this.keys.some(function(r){return r.isEqual(n.key)})},t}(Ct);function Ac(e,t){var n;return(((n=t.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(function(r){return C.fromName(r.referenceValue)})}var _p=function(e){function t(n,r){return e.call(this,n,"array-contains",r)||this}return R(t,e),t.prototype.matches=function(n){var r=n.data.field(this.field);return ts(r)&&$n(r.arrayValue,this.value)},t}(Ct),Ep=function(e){function t(n,r){return e.call(this,n,"in",r)||this}return R(t,e),t.prototype.matches=function(n){var r=n.data.field(this.field);return r!==null&&$n(this.value.arrayValue,r)},t}(Ct),Ip=function(e){function t(n,r){return e.call(this,n,"not-in",r)||this}return R(t,e),t.prototype.matches=function(n){if($n(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var r=n.data.field(this.field);return r!==null&&!$n(this.value.arrayValue,r)},t}(Ct),Tp=function(e){function t(n,r){return e.call(this,n,"array-contains-any",r)||this}return R(t,e),t.prototype.matches=function(n){var r=this,i=n.data.field(this.field);return!(!ts(i)||!i.arrayValue.values)&&i.arrayValue.values.some(function(o){return $n(r.value.arrayValue,o)})},t}(Ct),tr=function(e,t){this.position=e,this.before=t};function li(e){return(e.before?"b":"a")+":"+e.position.map(function(t){return $o(t)}).join(",")}var tn=function(e,t){t===void 0&&(t="asc"),this.field=e,this.dir=t};function Sp(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function Dc(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var o=t[i],s=e.position[i];if(r=o.field.isKeyField()?C.comparator(C.fromName(s.referenceValue),n.key):Ze(s,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return e.before?r<=0:r<0}function Nc(e,t){if(e===null)return t===null;if(t===null||e.before!==t.before||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!qt(e.position[n],t.position[n]))return!1;return!0}var Wt=function(e,t,n,r,i,o,s,a){t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o="F"),s===void 0&&(s=null),a===void 0&&(a=null),this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt};function Cc(e,t,n,r,i,o,s,a){return new Wt(e,t,n,r,i,o,s,a)}function en(e){return new Wt(e)}function fi(e){return!Se(e.limit)&&e.limitType==="F"}function di(e){return!Se(e.limit)&&e.limitType==="L"}function es(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function ns(e){for(var t=0,n=e.filters;t<n.length;t++){var r=n[t];if(r.g())return r.field}return null}function rs(e){return e.collectionGroup!==null}function nn(e){var t=T(e);if(t.p===null){t.p=[];var n=ns(t),r=es(t);if(n!==null&&r===null)n.isKeyField()||t.p.push(new tn(n)),t.p.push(new tn(Vt.keyField(),"asc"));else{for(var i=!1,o=0,s=t.explicitOrderBy;o<s.length;o++){var a=s[o];t.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.p.push(new tn(Vt.keyField(),u))}}}return t.p}function Pt(e){var t=T(e);if(!t.T)if(t.limitType==="F")t.T=Sc(t.path,t.collectionGroup,nn(t),t.filters,t.limit,t.startAt,t.endAt);else{for(var n=[],r=0,i=nn(t);r<i.length;r++){var o=i[r],s=o.dir==="desc"?"asc":"desc";n.push(new tn(o.field,s))}var a=t.endAt?new tr(t.endAt.position,!t.endAt.before):null,u=t.startAt?new tr(t.startAt.position,!t.startAt.before):null;t.T=Sc(t.path,t.collectionGroup,n,t.filters,t.limit,a,u)}return t.T}function Rc(e,t,n){return new Wt(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function er(e,t){return ci(Pt(e),Pt(t))&&e.limitType===t.limitType}function Oc(e){return Zn(Pt(e))+"|lt:"+e.limitType}function is(e){return"Query(target="+function(t){var n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=", filters: ["+t.filters.map(function(r){return(i=r).field.canonicalString()+" "+i.op+" "+$o(i.value);var i}).join(", ")+"]"),Se(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=", orderBy: ["+t.orderBy.map(function(r){return function(i){return i.field.canonicalString()+" ("+i.dir+")"}(r)}).join(", ")+"]"),t.startAt&&(n+=", startAt: "+li(t.startAt)),t.endAt&&(n+=", endAt: "+li(t.endAt)),"Target("+n+")"}(Pt(e))+"; limitType="+e.limitType+")"}function nr(e,t){return t.isFoundDocument()&&function(n,r){var i=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):C.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)}(e,t)&&function(n,r){for(var i=0,o=n.explicitOrderBy;i<o.length;i++){var s=o[i];if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1}return!0}(e,t)&&function(n,r){for(var i=0,o=n.filters;i<o.length;i++)if(!o[i].matches(r))return!1;return!0}(e,t)&&function(n,r){return!(n.startAt&&!Dc(n.startAt,nn(n),r))&&(!n.endAt||!Dc(n.endAt,nn(n),r))}(e,t)}function xc(e){return function(t,n){for(var r=!1,i=0,o=nn(e);i<o.length;i++){var s=o[i],a=Ap(s,t,n);if(a!==0)return a;r=r||s.field.isKeyField()}return 0}}function Ap(e,t,n){var r=e.field.isKeyField()?C.comparator(t.key,n.key):function(i,o,s){var a=o.data.field(i),u=s.data.field(i);return a!==null&&u!==null?Ze(a,u):N()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return N()}}function kc(e,t){if(e.I){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:si(t)?"-0":t}}function Pc(e){return{integerValue:""+e}}function Lc(e,t){return bc(t)?Pc(t):kc(e,t)}var pi=function(){this._=void 0};function Dp(e,t,n){return e instanceof rn?function(r,i){var o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&(o.fields.__previous_value__=i),{mapValue:o}}(n,t):e instanceof De?Fc(e,t):e instanceof Ne?Vc(e,t):function(r,i){var o=Mc(r,i),s=Uc(o)+Uc(r.A);return Zo(o)&&Zo(r.A)?Pc(s):kc(r.R,s)}(e,t)}function Np(e,t,n){return e instanceof De?Fc(e,t):e instanceof Ne?Vc(e,t):n}function Mc(e,t){return e instanceof on?Zo(n=t)||function(r){return!!r&&"doubleValue"in r}(n)?t:{integerValue:0}:null;var n}var rn=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t}(pi),De=function(e){function t(n){var r=this;return(r=e.call(this)||this).elements=n,r}return R(t,e),t}(pi);function Fc(e,t){for(var n=jc(t),r=function(s){n.some(function(a){return qt(a,s)})||n.push(s)},i=0,o=e.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Ne=function(e){function t(n){var r=this;return(r=e.call(this)||this).elements=n,r}return R(t,e),t}(pi);function Vc(e,t){for(var n=jc(t),r=function(s){n=n.filter(function(a){return!qt(a,s)})},i=0,o=e.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var on=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).R=n,i.A=r,i}return R(t,e),t}(pi);function Uc(e){return $(e.integerValue||e.doubleValue)}function jc(e){return ts(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var rr=function(e,t){this.field=e,this.transform=t},Cp=function(e,t){this.version=e,this.transformResults=t},dt=function(){function e(t,n){this.updateTime=t,this.exists=n}return e.none=function(){return new e},e.exists=function(t){return new e(void 0,t)},e.updateTime=function(t){return new e(t)},Object.defineProperty(e.prototype,"isNone",{get:function(){return this.updateTime===void 0&&this.exists===void 0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},e}();function vi(e,t){return e.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(e.updateTime):e.exists===void 0||e.exists===t.isFoundDocument()}var yi=function(){};function Rp(e,t,n){e instanceof ir?function(r,i,o){var s=r.value.clone(),a=zc(r.fieldTransforms,i,o.transformResults);s.setAll(a),i.convertToFoundDocument(o.version,s).setHasCommittedMutations()}(e,t,n):e instanceof re?function(r,i,o){if(vi(r.precondition,i)){var s=zc(r.fieldTransforms,i,o.transformResults),a=i.data;a.setAll(Kc(r)),a.setAll(s),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}else i.convertToUnknownDocument(o.version)}(e,t,n):function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,t,n)}function os(e,t,n){e instanceof ir?function(r,i,o){if(vi(r.precondition,i)){var s=r.value.clone(),a=Gc(r.fieldTransforms,o,i);s.setAll(a),i.convertToFoundDocument(Bc(i),s).setHasLocalMutations()}}(e,t,n):e instanceof re?function(r,i,o){if(vi(r.precondition,i)){var s=Gc(r.fieldTransforms,o,i),a=i.data;a.setAll(Kc(r)),a.setAll(s),i.convertToFoundDocument(Bc(i),a).setHasLocalMutations()}}(e,t,n):function(r,i){vi(r.precondition,i)&&i.convertToNoDocument(P.min())}(e,t)}function Op(e,t){for(var n=null,r=0,i=e.fieldTransforms;r<i.length;r++){var o=i[r],s=t.data.field(o.field),a=Mc(o.transform,s||null);a!=null&&(n==null&&(n=Nt.empty()),n.set(o.field,a))}return n||null}function qc(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&Xe(n,r,function(i,o){return function(s,a){return s.field.isEqual(a.field)&&function(u,c){return u instanceof De&&c instanceof De||u instanceof Ne&&c instanceof Ne?Xe(u.elements,c.elements,qt):u instanceof on&&c instanceof on?qt(u.A,c.A):u instanceof rn&&c instanceof rn}(s.transform,a.transform)}(i,o)})}(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function Bc(e){return e.isFoundDocument()?e.version:P.min()}var ir=function(e){function t(n,r,i,o){o===void 0&&(o=[]);var s=this;return(s=e.call(this)||this).key=n,s.value=r,s.precondition=i,s.fieldTransforms=o,s.type=0,s}return R(t,e),t}(yi),re=function(e){function t(n,r,i,o,s){s===void 0&&(s=[]);var a=this;return(a=e.call(this)||this).key=n,a.data=r,a.fieldMask=i,a.precondition=o,a.fieldTransforms=s,a.type=1,a}return R(t,e),t}(yi);function Kc(e){var t=new Map;return e.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}}),t}function zc(e,t,n){var r=new Map;O(e.length===n.length);for(var i=0;i<n.length;i++){var o=e[i],s=o.transform,a=t.data.field(o.field);r.set(o.field,Np(s,a,n[i]))}return r}function Gc(e,t,n){for(var r=new Map,i=0,o=e;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,Dp(a,u,t))}return r}var J,F,or=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).key=n,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return R(t,e),t}(yi),ss=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).key=n,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return R(t,e),t}(yi),xp=function(e){this.count=e};function Hc(e){switch(e){case y.OK:return N();case y.CANCELLED:case y.UNKNOWN:case y.DEADLINE_EXCEEDED:case y.RESOURCE_EXHAUSTED:case y.INTERNAL:case y.UNAVAILABLE:case y.UNAUTHENTICATED:return!1;case y.INVALID_ARGUMENT:case y.NOT_FOUND:case y.ALREADY_EXISTS:case y.PERMISSION_DENIED:case y.FAILED_PRECONDITION:case y.ABORTED:case y.OUT_OF_RANGE:case y.UNIMPLEMENTED:case y.DATA_LOSS:return!0;default:return N()}}function Qc(e){if(e===void 0)return X("GRPC error has no .code"),y.UNKNOWN;switch(e){case J.OK:return y.OK;case J.CANCELLED:return y.CANCELLED;case J.UNKNOWN:return y.UNKNOWN;case J.DEADLINE_EXCEEDED:return y.DEADLINE_EXCEEDED;case J.RESOURCE_EXHAUSTED:return y.RESOURCE_EXHAUSTED;case J.INTERNAL:return y.INTERNAL;case J.UNAVAILABLE:return y.UNAVAILABLE;case J.UNAUTHENTICATED:return y.UNAUTHENTICATED;case J.INVALID_ARGUMENT:return y.INVALID_ARGUMENT;case J.NOT_FOUND:return y.NOT_FOUND;case J.ALREADY_EXISTS:return y.ALREADY_EXISTS;case J.PERMISSION_DENIED:return y.PERMISSION_DENIED;case J.FAILED_PRECONDITION:return y.FAILED_PRECONDITION;case J.ABORTED:return y.ABORTED;case J.OUT_OF_RANGE:return y.OUT_OF_RANGE;case J.UNIMPLEMENTED:return y.UNIMPLEMENTED;case J.DATA_LOSS:return y.DATA_LOSS;default:return N()}}(F=J||(J={}))[F.OK=0]="OK",F[F.CANCELLED=1]="CANCELLED",F[F.UNKNOWN=2]="UNKNOWN",F[F.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",F[F.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",F[F.NOT_FOUND=5]="NOT_FOUND",F[F.ALREADY_EXISTS=6]="ALREADY_EXISTS",F[F.PERMISSION_DENIED=7]="PERMISSION_DENIED",F[F.UNAUTHENTICATED=16]="UNAUTHENTICATED",F[F.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",F[F.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",F[F.ABORTED=10]="ABORTED",F[F.OUT_OF_RANGE=11]="OUT_OF_RANGE",F[F.UNIMPLEMENTED=12]="UNIMPLEMENTED",F[F.INTERNAL=13]="INTERNAL",F[F.UNAVAILABLE=14]="UNAVAILABLE",F[F.DATA_LOSS=15]="DATA_LOSS";var pt=function(){function e(t,n){this.comparator=t,this.root=n||ie.EMPTY}return e.prototype.insert=function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,ie.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ie.BLACK,null,null))},e.prototype.get=function(t){for(var n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null},e.prototype.indexOf=function(t){for(var n=0,r=this.root;!r.isEmpty();){var i=this.comparator(t,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1},e.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(e.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),e.prototype.minKey=function(){return this.root.minKey()},e.prototype.maxKey=function(){return this.root.maxKey()},e.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},e.prototype.forEach=function(t){this.inorderTraversal(function(n,r){return t(n,r),!1})},e.prototype.toString=function(){var t=[];return this.inorderTraversal(function(n,r){return t.push(n+":"+r),!1}),"{"+t.join(", ")+"}"},e.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},e.prototype.getIterator=function(){return new gi(this.root,null,this.comparator,!1)},e.prototype.getIteratorFrom=function(t){return new gi(this.root,t,this.comparator,!1)},e.prototype.getReverseIterator=function(){return new gi(this.root,null,this.comparator,!0)},e.prototype.getReverseIteratorFrom=function(t){return new gi(this.root,t,this.comparator,!0)},e}(),gi=function(){function e(t,n,r,i){this.isReverse=i,this.nodeStack=[];for(var o=1;!t.isEmpty();)if(o=n?r(t.key,n):1,i&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return e.prototype.getNext=function(){var t=this.nodeStack.pop(),n={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return n},e.prototype.hasNext=function(){return this.nodeStack.length>0},e.prototype.peek=function(){if(this.nodeStack.length===0)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},e}(),ie=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=r??e.RED,this.left=i??e.EMPTY,this.right=o??e.EMPTY,this.size=this.left.size+1+this.right.size}return e.prototype.copy=function(t,n,r,i,o){return new e(t??this.key,n??this.value,r??this.color,i??this.left,o??this.right)},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},e.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},e.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},e.prototype.minKey=function(){return this.min().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(t,n,r){var i=this,o=r(t,i.key);return(i=o<0?i.copy(null,null,null,i.left.insert(t,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(t,n,r))).fixUp()},e.prototype.removeMin=function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},e.prototype.remove=function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(t,i.key)===0){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()},e.prototype.isRed=function(){return this.color},e.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},e.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},e.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},e.prototype.rotateLeft=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)},e.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},e.prototype.check=function(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw N();var t=this.left.check();if(t!==this.right.check())throw N();return t+(this.isRed()?0:1)},e}();ie.EMPTY=null,ie.RED=!0,ie.BLACK=!1,ie.EMPTY=new(function(){function e(){this.size=0}return Object.defineProperty(e.prototype,"key",{get:function(){throw N()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){throw N()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){throw N()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){throw N()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){throw N()},enumerable:!1,configurable:!0}),e.prototype.copy=function(t,n,r,i,o){return this},e.prototype.insert=function(t,n,r){return new ie(t,n)},e.prototype.remove=function(t,n){return this},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(t){return!1},e.prototype.reverseTraversal=function(t){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.isRed=function(){return!1},e.prototype.checkMaxDepth=function(){return!0},e.prototype.check=function(){return 0},e}());var tt=function(){function e(t){this.comparator=t,this.data=new pt(this.comparator)}return e.prototype.has=function(t){return this.data.get(t)!==null},e.prototype.first=function(){return this.data.minKey()},e.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(e.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),e.prototype.indexOf=function(t){return this.data.indexOf(t)},e.prototype.forEach=function(t){this.data.inorderTraversal(function(n,r){return t(n),!1})},e.prototype.forEachInRange=function(t,n){for(var r=this.data.getIteratorFrom(t[0]);r.hasNext();){var i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;n(i.key)}},e.prototype.forEachWhile=function(t,n){var r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return},e.prototype.firstAfterOrEqual=function(t){var n=this.data.getIteratorFrom(t);return n.hasNext()?n.getNext().key:null},e.prototype.getIterator=function(){return new Wc(this.data.getIterator())},e.prototype.getIteratorFrom=function(t){return new Wc(this.data.getIteratorFrom(t))},e.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},e.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},e.prototype.isEmpty=function(){return this.data.isEmpty()},e.prototype.unionWith=function(t){var n=this;return n.size<t.size&&(n=t,t=this),t.forEach(function(r){n=n.add(r)}),n},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0},e.prototype.toArray=function(){var t=[];return this.forEach(function(n){t.push(n)}),t},e.prototype.toString=function(){var t=[];return this.forEach(function(n){return t.push(n)}),"SortedSet("+t.toString()+")"},e.prototype.copy=function(t){var n=new e(this.comparator);return n.data=t,n},e}(),Wc=function(){function e(t){this.iter=t}return e.prototype.getNext=function(){return this.iter.getNext().key},e.prototype.hasNext=function(){return this.iter.hasNext()},e}(),kp=new pt(C.comparator);function Lt(){return kp}var Pp=new pt(C.comparator);function as(){return Pp}var Lp=new pt(C.comparator);function Yc(){return Lp}var Mp=new tt(C.comparator);function B(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=Mp,r=0,i=e;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Fp=new tt(L);function mi(){return Fp}var us=function(){function e(t,n,r,i,o){this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}return e.createSynthesizedRemoteEventForCurrentChange=function(t,n){var r=new Map;return r.set(t,cs.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(P.min(),r,mi(),Lt(),B())},e}(),cs=function(){function e(t,n,r,i,o){this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}return e.createSynthesizedTargetChangeForCurrentChange=function(t,n){return new e(Et.EMPTY_BYTE_STRING,n,B(),B(),B())},e}(),wi=function(e,t,n,r){this.v=e,this.removedTargetIds=t,this.key=n,this.P=r},Xc=function(e,t){this.targetId=e,this.V=t},$c=function(e,t,n,r){n===void 0&&(n=Et.EMPTY_BYTE_STRING),r===void 0&&(r=null),this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r},Jc=function(){function e(){this.S=0,this.D=th(),this.C=Et.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(e.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"F",{get:function(){return this.S!==0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),e.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},e.prototype.M=function(){var t=B(),n=B(),r=B();return this.D.forEach(function(i,o){switch(o){case 0:t=t.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:N()}}),new cs(this.C,this.N,t,n,r)},e.prototype.L=function(){this.k=!1,this.D=th()},e.prototype.B=function(t,n){this.k=!0,this.D=this.D.insert(t,n)},e.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},e.prototype.U=function(){this.S+=1},e.prototype.K=function(){this.S-=1},e.prototype.j=function(){this.k=!0,this.N=!0},e}(),Vp=function(){function e(t){this.W=t,this.G=new Map,this.H=Lt(),this.J=Zc(),this.Y=new tt(L)}return e.prototype.X=function(t){for(var n=0,r=t.v;n<r.length;n++){var i=r[n];t.P&&t.P.isFoundDocument()?this.Z(i,t.P):this.tt(i,t.key,t.P)}for(var o=0,s=t.removedTargetIds;o<s.length;o++)i=s[o],this.tt(i,t.key,t.P)},e.prototype.et=function(t){var n=this;this.forEachTarget(t,function(r){var i=n.nt(r);switch(t.state){case 0:n.st(r)&&i.O(t.resumeToken);break;case 1:i.K(),i.F||i.L(),i.O(t.resumeToken);break;case 2:i.K(),i.F||n.removeTarget(r);break;case 3:n.st(r)&&(i.j(),i.O(t.resumeToken));break;case 4:n.st(r)&&(n.it(r),i.O(t.resumeToken));break;default:N()}})},e.prototype.forEachTarget=function(t,n){var r=this;t.targetIds.length>0?t.targetIds.forEach(n):this.G.forEach(function(i,o){r.st(o)&&n(o)})},e.prototype.rt=function(t){var n=t.targetId,r=t.V.count,i=this.ot(n);if(i){var o=i.target;if(hi(o))if(r===0){var s=new C(o.path);this.tt(n,s,at.newNoDocument(s,P.min()))}else O(r===1);else this.ct(n)!==r&&(this.it(n),this.Y=this.Y.add(n))}},e.prototype.ut=function(t){var n=this,r=new Map;this.G.forEach(function(s,a){var u=n.ot(a);if(u){if(s.current&&hi(u.target)){var c=new C(u.target.path);n.H.get(c)!==null||n.at(a,c)||n.tt(a,c,at.newNoDocument(c,t))}s.$&&(r.set(a,s.M()),s.L())}});var i=B();this.J.forEach(function(s,a){var u=!0;a.forEachWhile(function(c){var h=n.ot(c);return!h||h.purpose===2||(u=!1,!1)}),u&&(i=i.add(s))});var o=new us(t,r,this.Y,this.H,i);return this.H=Lt(),this.J=Zc(),this.Y=new tt(L),o},e.prototype.Z=function(t,n){if(this.st(t)){var r=this.at(t,n.key)?2:0;this.nt(t).B(n.key,r),this.H=this.H.insert(n.key,n),this.J=this.J.insert(n.key,this.ht(n.key).add(t))}},e.prototype.tt=function(t,n,r){if(this.st(t)){var i=this.nt(t);this.at(t,n)?i.B(n,1):i.q(n),this.J=this.J.insert(n,this.ht(n).delete(t)),r&&(this.H=this.H.insert(n,r))}},e.prototype.removeTarget=function(t){this.G.delete(t)},e.prototype.ct=function(t){var n=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+n.addedDocuments.size-n.removedDocuments.size},e.prototype.U=function(t){this.nt(t).U()},e.prototype.nt=function(t){var n=this.G.get(t);return n||(n=new Jc,this.G.set(t,n)),n},e.prototype.ht=function(t){var n=this.J.get(t);return n||(n=new tt(L),this.J=this.J.insert(t,n)),n},e.prototype.st=function(t){var n=this.ot(t)!==null;return n||I("WatchChangeAggregator","Detected inactive target",t),n},e.prototype.ot=function(t){var n=this.G.get(t);return n&&n.F?null:this.W.lt(t)},e.prototype.it=function(t){var n=this;this.G.set(t,new Jc),this.W.getRemoteKeysForTarget(t).forEach(function(r){n.tt(t,r,null)})},e.prototype.at=function(t,n){return this.W.getRemoteKeysForTarget(t).has(n)},e}();function Zc(){return new pt(C.comparator)}function th(){return new pt(C.comparator)}var Up={asc:"ASCENDING",desc:"DESCENDING"},jp={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},qp=function(e,t){this.databaseId=e,this.I=t};function sr(e,t){return e.I?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}}function eh(e,t){return e.I?t.toBase64():t.toUint8Array()}function Bp(e,t){return sr(e,t.toTimestamp())}function ut(e){return O(!!e),P.fromTimestamp(function(t){var n=ne(t);return new _t(n.seconds,n.nanos)}(e))}function hs(e,t){return function(n){return new U(["projects",n.projectId,"databases",n.database])}(e).child("documents").child(t).canonicalString()}function nh(e){var t=U.fromString(e);return O(ph(t)),t}function ar(e,t){return hs(e.databaseId,t.path)}function Bt(e,t){var n=nh(t);if(n.get(1)!==e.databaseId.projectId)throw new b(y.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new b(y.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new C(ih(n))}function ls(e,t){return hs(e.databaseId,t)}function rh(e){var t=nh(e);return t.length===4?U.emptyPath():ih(t)}function ur(e){return new U(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ih(e){return O(e.length>4&&e.get(4)==="documents"),e.popFirst(5)}function oh(e,t,n){return{name:ar(e,t),fields:n.value.mapValue.fields}}function sh(e,t,n){var r=Bt(e,t.name),i=ut(t.updateTime),o=new Nt({mapValue:{fields:t.fields}}),s=at.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function bi(e,t){var n;if(t instanceof ir)n={update:oh(e,t.key,t.value)};else if(t instanceof or)n={delete:ar(e,t.key)};else if(t instanceof re)n={update:oh(e,t.key,t.data),updateMask:Qp(t.fieldMask)};else{if(!(t instanceof ss))return N();n={verify:ar(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map(function(r){return function(i,o){var s=o.transform;if(s instanceof rn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof De)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof Ne)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof on)return{fieldPath:o.field.canonicalString(),increment:s.A};throw N()}(0,r)})),t.precondition.isNone||(n.currentDocument=function(r,i){return i.updateTime!==void 0?{updateTime:Bp(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:N()}(e,t.precondition)),n}function ah(e,t){var n=t.currentDocument?function(c){return c.updateTime!==void 0?dt.updateTime(ut(c.updateTime)):c.exists!==void 0?dt.exists(c.exists):dt.none()}(t.currentDocument):dt.none(),r=t.updateTransforms?t.updateTransforms.map(function(c){return function(h,f){var l=null;if("setToServerValue"in f)O(f.setToServerValue==="REQUEST_TIME"),l=new rn;else if("appendMissingElements"in f){var d=f.appendMissingElements.values||[];l=new De(d)}else if("removeAllFromArray"in f){var p=f.removeAllFromArray.values||[];l=new Ne(p)}else"increment"in f?l=new on(h,f.increment):N();var v=Vt.fromServerFormat(f.fieldPath);return new rr(v,l)}(e,c)}):[];if(t.update){t.update.name;var i=Bt(e,t.update.name),o=new Nt({mapValue:{fields:t.update.fields}});if(t.updateMask){var s=function(c){var h=c.fieldPaths||[];return new $e(h.map(function(f){return Vt.fromServerFormat(f)}))}(t.updateMask);return new re(i,o,s,n,r)}return new ir(i,o,n,r)}if(t.delete){var a=Bt(e,t.delete);return new or(a,n)}if(t.verify){var u=Bt(e,t.verify);return new ss(u,n)}return N()}function uh(e,t){return{documents:[ls(e,t.path)]}}function ch(e,t){var n={structuredQuery:{}},r=t.path;t.collectionGroup!==null?(n.parent=ls(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=ls(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(a){if(a.length!==0){var u=a.map(function(c){return function(h){if(h.op==="=="){if(Ic(h.value))return{unaryFilter:{field:sn(h.field),op:"IS_NAN"}};if(Ec(h.value))return{unaryFilter:{field:sn(h.field),op:"IS_NULL"}}}else if(h.op==="!="){if(Ic(h.value))return{unaryFilter:{field:sn(h.field),op:"IS_NOT_NAN"}};if(Ec(h.value))return{unaryFilter:{field:sn(h.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:sn(h.field),op:zp(h.op),value:h.value}}}(c)});return u.length===1?u[0]:{compositeFilter:{op:"AND",filters:u}}}}(t.filters);i&&(n.structuredQuery.where=i);var o=function(a){if(a.length!==0)return a.map(function(u){return function(c){return{field:sn(c.field),direction:Kp(c.dir)}}(u)})}(t.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(a,u){return a.I||Se(u)?u:{value:u}}(e,t.limit);return s!==null&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt=fh(t.startAt)),t.endAt&&(n.structuredQuery.endAt=fh(t.endAt)),n}function hh(e){var t=rh(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){O(r===1);var o=n.from[0];o.allDescendants?i=o.collectionId:t=t.child(o.collectionId)}var s=[];n.where&&(s=lh(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(f){return function(l){return new tn(an(l.field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(l.direction))}(f)}));var u=null;n.limit&&(u=function(f){var l;return Se(l=typeof f=="object"?f.value:f)?null:l}(n.limit));var c=null;n.startAt&&(c=dh(n.startAt));var h=null;return n.endAt&&(h=dh(n.endAt)),Cc(t,i,a,s,u,"F",c,h)}function lh(e){return e?e.unaryFilter!==void 0?[Hp(e)]:e.fieldFilter!==void 0?[Gp(e)]:e.compositeFilter!==void 0?e.compositeFilter.filters.map(function(t){return lh(t)}).reduce(function(t,n){return t.concat(n)}):N():[]}function fh(e){return{before:e.before,values:e.position}}function dh(e){var t=!!e.before,n=e.values||[];return new tr(n,t)}function Kp(e){return Up[e]}function zp(e){return jp[e]}function sn(e){return{fieldPath:e.canonicalString()}}function an(e){return Vt.fromServerFormat(e.fieldPath)}function Gp(e){return Ct.create(an(e.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return N()}}(e.fieldFilter.op),e.fieldFilter.value)}function Hp(e){switch(e.unaryFilter.op){case"IS_NAN":var t=an(e.unaryFilter.field);return Ct.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=an(e.unaryFilter.field);return Ct.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=an(e.unaryFilter.field);return Ct.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=an(e.unaryFilter.field);return Ct.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return N()}}function Qp(e){var t=[];return e.fields.forEach(function(n){return t.push(n.canonicalString())}),{fieldPaths:t}}function ph(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"}function Ut(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=vh(t)),t=Wp(e.get(n),t);return vh(t)}function Wp(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var o=e.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function vh(e){return e+""}function Yt(e){var t=e.length;if(O(t>=2),t===2)return O(e.charAt(0)===""&&e.charAt(1)===""),U.emptyPath();for(var n=t-2,r=[],i="",o=0;o<t;){var s=e.indexOf("",o);switch((s<0||s>n)&&N(),e.charAt(s+1)){case"":var a=e.substring(o,s),u=void 0;i.length===0?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=e.substring(o,s),i+="\0";break;case"":i+=e.substring(o,s+1);break;default:N()}o=s+2}return new U(r)}var Yp=function(e,t){this.seconds=e,this.nanoseconds=t},Rt=function(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n};Rt.store="owner",Rt.key="owner";var oe=function(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n};oe.store="mutationQueues",oe.keyPath="userId";var K=function(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};K.store="mutations",K.keyPath="batchId",K.userMutationsIndex="userMutationsIndex",K.userMutationsKeyPath=["userId","batchId"];var vt=function(){function e(){}return e.prefixForUser=function(t){return[t]},e.prefixForPath=function(t,n){return[t,Ut(n)]},e.key=function(t,n,r){return[t,Ut(n),r]},e}();vt.store="documentMutations",vt.PLACEHOLDER=new vt;var Xp=function(e,t){this.path=e,this.readTime=t},$p=function(e,t){this.path=e,this.version=t},Q=function(e,t,n,r,i,o){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Q.store="remoteDocuments",Q.readTimeIndex="readTimeIndex",Q.readTimeIndexPath="readTime",Q.collectionReadTimeIndex="collectionReadTimeIndex",Q.collectionReadTimeIndexPath=["parentPath","readTime"];var Kt=function(e){this.byteSize=e};Kt.store="remoteDocumentGlobal",Kt.key="remoteDocumentGlobalKey";var Tt=function(e,t,n,r,i,o,s){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Tt.store="targets",Tt.keyPath="targetId",Tt.queryTargetsIndexName="queryTargetsIndex",Tt.queryTargetsKeyPath=["canonicalId","targetId"];var ct=function(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n};ct.store="targetDocuments",ct.keyPath=["targetId","path"],ct.documentTargetsIndex="documentTargetsIndex",ct.documentTargetsKeyPath=["path","targetId"];var Ot=function(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Ot.key="targetGlobalKey",Ot.store="targetGlobal";var Ce=function(e,t){this.collectionId=e,this.parent=t};Ce.store="collectionParents",Ce.keyPath=["collectionId","parent"];var Xt=function(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r};Xt.store="clientMetadata",Xt.keyPath="clientId";var un=function(e,t,n){this.bundleId=e,this.createTime=t,this.version=n};un.store="bundles",un.keyPath="bundleId";var cn=function(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n};cn.store="namedQueries",cn.keyPath="name";var Jp=z(z([],z(z([],z(z([],z(z([],[oe.store,K.store,vt.store,Q.store,Tt.store,Rt.store,Ot.store,ct.store]),[Xt.store])),[Kt.store])),[Ce.store])),[un.store,cn.store]),yh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",gh=function(){function e(){this.onCommittedListeners=[]}return e.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},e.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},e}(),yt=function(){var e=this;this.promise=new Promise(function(t,n){e.resolve=t,e.reject=n})},_=function(){function e(t){var n=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(r){n.isDone=!0,n.result=r,n.nextCallback&&n.nextCallback(r)},function(r){n.isDone=!0,n.error=r,n.catchCallback&&n.catchCallback(r)})}return e.prototype.catch=function(t){return this.next(void 0,t)},e.prototype.next=function(t,n){var r=this;return this.callbackAttached&&N(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e(function(i,o){r.nextCallback=function(s){r.wrapSuccess(t,s).next(i,o)},r.catchCallback=function(s){r.wrapFailure(n,s).next(i,o)}})},e.prototype.toPromise=function(){var t=this;return new Promise(function(n,r){t.next(n,r)})},e.prototype.wrapUserFunction=function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(r){return e.reject(r)}},e.prototype.wrapSuccess=function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.resolve(n)},e.prototype.wrapFailure=function(t,n){return t?this.wrapUserFunction(function(){return t(n)}):e.reject(n)},e.resolve=function(t){return new e(function(n,r){n(t)})},e.reject=function(t){return new e(function(n,r){r(t)})},e.waitFor=function(t){return new e(function(n,r){var i=0,o=0,s=!1;t.forEach(function(a){++i,a.next(function(){++o,s&&o===i&&n()},function(u){return r(u)})}),s=!0,o===i&&n()})},e.or=function(t){for(var n=e.resolve(!1),r=function(s){n=n.next(function(a){return a?e.resolve(a):s()})},i=0,o=t;i<o.length;i++)r(o[i]);return n},e.forEach=function(t,n){var r=this,i=[];return t.forEach(function(o,s){i.push(n.call(r,o,s))}),this.waitFor(i)},e}(),mh=function(){function e(t,n){var r=this;this.action=t,this.transaction=n,this.aborted=!1,this.ft=new yt,this.transaction.oncomplete=function(){r.ft.resolve()},this.transaction.onabort=function(){n.error?r.ft.reject(new cr(t,n.error)):r.ft.resolve()},this.transaction.onerror=function(i){var o=fs(i.target.error);r.ft.reject(new cr(t,o))}}return e.open=function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(o){throw new cr(n,o)}},Object.defineProperty(e.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),e.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(I("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},e.prototype.store=function(t){var n=this.transaction.objectStore(t);return new tv(n)},e}(),hn=function(){function e(t,n,r){this.name=t,this.version=n,this.wt=r,e._t(Jt())===12.2&&X("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(t){return I("SimpleDb","Removing database:",t),Oe(window.indexedDB.deleteDatabase(t)).toPromise()},e.yt=function(){if(typeof indexedDB=="undefined")return!1;if(e.gt())return!0;var t=Jt(),n=e._t(t),r=0<n&&n<10,i=e.Et(t),o=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||o)},e.gt=function(){var t;return typeof process!="undefined"&&((t=process.env)===null||t===void 0?void 0:t.Tt)==="YES"},e.It=function(t,n){return t.store(n)},e._t=function(t){var n=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)},e.Et=function(t){var n=t.match(/Android ([\d.]+)/i),r=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(r)},e.prototype.At=function(t){return m(this,void 0,void 0,function(){var n,r=this;return g(this,function(i){switch(i.label){case 0:return this.db?[3,2]:(I("SimpleDb","Opening database:",this.name),n=this,[4,new Promise(function(o,s){var a=indexedDB.open(r.name,r.version);a.onsuccess=function(u){var c=u.target.result;o(c)},a.onblocked=function(){s(new cr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=function(u){var c=u.target.error;c.name==="VersionError"?s(new b(y.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):s(new cr(t,c))},a.onupgradeneeded=function(u){I("SimpleDb",'Database "'+r.name+'" requires upgrade from version:',u.oldVersion);var c=u.target.result;r.wt.Rt(c,a.transaction,u.oldVersion,r.version).next(function(){I("SimpleDb","Database upgrade to version "+r.version+" complete")})}})]);case 1:n.db=i.sent(),i.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(o){return r.bt(o)}),this.db)]}})})},e.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(n){return t(n)})},e.prototype.runTransaction=function(t,n,r,i){return m(this,void 0,void 0,function(){var o,s,a,u,c;return g(this,function(h){switch(h.label){case 0:o=n==="readonly",s=0,a=function(){var f,l,d,p,v;return g(this,function(w){switch(w.label){case 0:++s,w.label=1;case 1:return w.trys.push([1,4,,5]),[4,u.At(t)];case 2:return u.db=w.sent(),f=mh.open(u.db,t,o?"readonly":"readwrite",r),l=i(f).catch(function(E){return f.abort(E),_.reject(E)}).toPromise(),d={},l.catch(function(){}),[4,f.dt];case 3:return[2,(d.value=(w.sent(),l),d)];case 4:return p=w.sent(),v=p.name!=="FirebaseError"&&s<3,I("SimpleDb","Transaction failed with error:",p.message,"Retrying:",v),u.close(),v?[3,5]:[2,{value:Promise.reject(p)}];case 5:return[2]}})},u=this,h.label=1;case 1:return[5,a()];case 2:if(typeof(c=h.sent())=="object")return[2,c.value];h.label=3;case 3:return[3,1];case 4:return[2]}})})},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),Zp=function(){function e(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(e.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),e.prototype.done=function(){this.Vt=!0},e.prototype.Ct=function(t){this.St=t},e.prototype.delete=function(){return Oe(this.Pt.delete())},e}(),cr=function(e){function t(n,r){var i=this;return(i=e.call(this,y.UNAVAILABLE,"IndexedDB transaction '"+n+"' failed: "+r)||this).name="IndexedDbTransactionError",i}return R(t,e),t}(b);function Re(e){return e.name==="IndexedDbTransactionError"}var tv=function(){function e(t){this.store=t}return e.prototype.put=function(t,n){var r;return n!==void 0?(I("SimpleDb","PUT",this.store.name,t,n),r=this.store.put(n,t)):(I("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),Oe(r)},e.prototype.add=function(t){return I("SimpleDb","ADD",this.store.name,t,t),Oe(this.store.add(t))},e.prototype.get=function(t){var n=this;return Oe(this.store.get(t)).next(function(r){return r===void 0&&(r=null),I("SimpleDb","GET",n.store.name,t,r),r})},e.prototype.delete=function(t){return I("SimpleDb","DELETE",this.store.name,t),Oe(this.store.delete(t))},e.prototype.count=function(){return I("SimpleDb","COUNT",this.store.name),Oe(this.store.count())},e.prototype.Nt=function(t,n){var r=this.cursor(this.options(t,n)),i=[];return this.xt(r,function(o,s){i.push(s)}).next(function(){return i})},e.prototype.kt=function(t,n){I("SimpleDb","DELETE ALL",this.store.name);var r=this.options(t,n);r.Ft=!1;var i=this.cursor(r);return this.xt(i,function(o,s,a){return a.delete()})},e.prototype.$t=function(t,n){var r;n?r=t:(r={},n=t);var i=this.cursor(r);return this.xt(i,n)},e.prototype.Ot=function(t){var n=this.cursor({});return new _(function(r,i){n.onerror=function(o){var s=fs(o.target.error);i(s)},n.onsuccess=function(o){var s=o.target.result;s?t(s.primaryKey,s.value).next(function(a){a?s.continue():r()}):r()}})},e.prototype.xt=function(t,n){var r=[];return new _(function(i,o){t.onerror=function(s){o(s.target.error)},t.onsuccess=function(s){var a=s.target.result;if(a){var u=new Zp(a),c=n(a.primaryKey,a.value,u);if(c instanceof _){var h=c.catch(function(f){return u.done(),_.reject(f)});r.push(h)}u.isDone?i():u.Dt===null?a.continue():a.continue(u.Dt)}else i()}}).next(function(){return _.waitFor(r)})},e.prototype.options=function(t,n){var r;return t!==void 0&&(typeof t=="string"?r=t:n=t),{index:r,range:n}},e.prototype.cursor=function(t){var n="next";if(t.reverse&&(n="prev"),t.index){var r=this.store.index(t.index);return t.Ft?r.openKeyCursor(t.range,n):r.openCursor(t.range,n)}return this.store.openCursor(t.range,n)},e}();function Oe(e){return new _(function(t,n){e.onsuccess=function(r){var i=r.target.result;t(i)},e.onerror=function(r){var i=fs(r.target.error);n(i)}})}var wh=!1;function fs(e){var t=hn._t(Jt());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new b("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return wh||(wh=!0,setTimeout(function(){throw r},0)),r}}return e}var bh=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).Mt=n,i.currentSequenceNumber=r,i}return R(t,e),t}(gh);function St(e,t){var n=T(e);return hn.It(n.Mt,t)}var ds=function(){function e(t,n,r,i){this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return e.prototype.applyToRemoteDocument=function(t,n){for(var r=n.mutationResults,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t.key)&&Rp(o,t,r[i])}},e.prototype.applyToLocalView=function(t){for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t.key)&&os(s,t,this.localWriteTime);for(var i=0,o=this.mutations;i<o.length;i++){var s;(s=o[i]).key.isEqual(t.key)&&os(s,t,this.localWriteTime)}},e.prototype.applyToLocalDocumentSet=function(t){var n=this;this.mutations.forEach(function(r){var i=t.get(r.key),o=i;n.applyToLocalView(o),i.isValidDocument()||o.convertToNoDocument(P.min())})},e.prototype.keys=function(){return this.mutations.reduce(function(t,n){return t.add(n.key)},B())},e.prototype.isEqual=function(t){return this.batchId===t.batchId&&Xe(this.mutations,t.mutations,function(n,r){return qc(n,r)})&&Xe(this.baseMutations,t.baseMutations,function(n,r){return qc(n,r)})},e}(),ev=function(){function e(t,n,r,i){this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return e.from=function(t,n,r){O(t.mutations.length===r.length);for(var i=Yc(),o=t.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new e(t,n,r,i)},e}(),_i=function(){function e(t,n,r,i,o,s,a){o===void 0&&(o=P.min()),s===void 0&&(s=P.min()),a===void 0&&(a=Et.EMPTY_BYTE_STRING),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a}return e.prototype.withSequenceNumber=function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},e.prototype.withResumeToken=function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)},e.prototype.withLastLimboFreeSnapshotVersion=function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},e}(),_h=function(e){this.Lt=e};function ps(e,t){if(t.document)return sh(e.Lt,t.document,!!t.hasCommittedMutations);if(t.noDocument){var n=C.fromSegments(t.noDocument.path),r=fn(t.noDocument.readTime),i=at.newNoDocument(n,r);return t.hasCommittedMutations?i.setHasCommittedMutations():i}if(t.unknownDocument){var o=C.fromSegments(t.unknownDocument.path);return r=fn(t.unknownDocument.version),at.newUnknownDocument(o,r)}return N()}function Eh(e,t,n){var r=vs(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){var o=function(f,l){return{name:ar(f,l.key),fields:l.data.value.mapValue.fields,updateTime:sr(f,l.version.toTimestamp())}}(e.Lt,t),s=t.hasCommittedMutations;return new Q(null,null,o,s,r,i)}if(t.isNoDocument()){var a=t.key.path.toArray(),u=ln(t.version);return s=t.hasCommittedMutations,new Q(null,new Xp(a,u),null,s,r,i)}if(t.isUnknownDocument()){var c=t.key.path.toArray(),h=ln(t.version);return new Q(new $p(c,h),null,null,!0,r,i)}return N()}function vs(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Ih(e){var t=new _t(e[0],e[1]);return P.fromTimestamp(t)}function ln(e){var t=e.toTimestamp();return new Yp(t.seconds,t.nanoseconds)}function fn(e){var t=new _t(e.seconds,e.nanoseconds);return P.fromTimestamp(t)}function dn(e,t){for(var n=(t.baseMutations||[]).map(function(u){return ah(e.Lt,u)}),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&t.mutations[r+1].transform!==void 0){var o=t.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var s=t.mutations.map(function(u){return ah(e.Lt,u)}),a=_t.fromMillis(t.localWriteTimeMs);return new ds(t.batchId,a,n,s)}function hr(e){var t,n,r=fn(e.readTime),i=e.lastLimboFreeSnapshotVersion!==void 0?fn(e.lastLimboFreeSnapshotVersion):P.min();return e.query.documents!==void 0?(O((n=e.query).documents.length===1),t=Pt(en(rh(n.documents[0])))):t=function(o){return Pt(hh(o))}(e.query),new _i(t,e.targetId,0,e.lastListenSequenceNumber,r,i,Et.fromBase64String(e.resumeToken))}function Th(e,t){var n,r=ln(t.snapshotVersion),i=ln(t.lastLimboFreeSnapshotVersion);n=hi(t.target)?uh(e.Lt,t.target):ch(e.Lt,t.target);var o=t.resumeToken.toBase64();return new Tt(t.targetId,Zn(t.target),r,o,t.sequenceNumber,i,n)}function ys(e){var t=hh({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType==="LAST"?Rc(t,t.limit,"L"):t}var nv=function(){function e(){}return e.prototype.getBundleMetadata=function(t,n){return Sh(t).get(n).next(function(r){if(r)return{id:(i=r).bundleId,createTime:fn(i.createTime),version:i.version};var i})},e.prototype.saveBundleMetadata=function(t,n){return Sh(t).put({bundleId:(r=n).id,createTime:ln(ut(r.createTime)),version:r.version});var r},e.prototype.getNamedQuery=function(t,n){return Ah(t).get(n).next(function(r){if(r)return{name:(i=r).name,query:ys(i.bundledQuery),readTime:fn(i.readTime)};var i})},e.prototype.saveNamedQuery=function(t,n){return Ah(t).put(function(r){return{name:r.name,readTime:ln(ut(r.readTime)),bundledQuery:r.bundledQuery}}(n))},e}();function Sh(e){return St(e,un.store)}function Ah(e){return St(e,cn.store)}var rv=function(){function e(){this.Bt=new gs}return e.prototype.addToCollectionParentIndex=function(t,n){return this.Bt.add(n),_.resolve()},e.prototype.getCollectionParents=function(t,n){return _.resolve(this.Bt.getEntries(n))},e}(),gs=function(){function e(){this.index={}}return e.prototype.add=function(t){var n=t.lastSegment(),r=t.popLast(),i=this.index[n]||new tt(U.comparator),o=!i.has(r);return this.index[n]=i.add(r),o},e.prototype.has=function(t){var n=t.lastSegment(),r=t.popLast(),i=this.index[n];return i&&i.has(r)},e.prototype.getEntries=function(t){return(this.index[t]||new tt(U.comparator)).toArray()},e}(),iv=function(){function e(){this.qt=new gs}return e.prototype.addToCollectionParentIndex=function(t,n){var r=this;if(!this.qt.has(n)){var i=n.lastSegment(),o=n.popLast();t.addOnCommittedListener(function(){r.qt.add(n)});var s={collectionId:i,parent:Ut(o)};return Dh(t).put(s)}return _.resolve()},e.prototype.getCollectionParents=function(t,n){var r=[],i=IDBKeyRange.bound([n,""],[vc(n),""],!1,!0);return Dh(t).Nt(i).next(function(o){for(var s=0,a=o;s<a.length;s++){var u=a[s];if(u.collectionId!==n)break;r.push(Yt(u.parent))}return r})},e}();function Dh(e){return St(e,Ce.store)}var Nh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},zt=function(){function e(t,n,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return e.withCacheSize=function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},e}();function Ch(e,t,n){var r=e.store(K.store),i=e.store(vt.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(p,v,w){return a++,w.delete()});o.push(u.next(function(){O(a===1)}));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],d=vt.key(t,l.key.path,n.batchId);o.push(i.delete(d)),c.push(l.key)}return _.waitFor(o).next(function(){return c})}function Ei(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw N();t=e.noDocument}return JSON.stringify(t).length}zt.DEFAULT_COLLECTION_PERCENTILE=10,zt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,zt.DEFAULT=new zt(41943040,zt.DEFAULT_COLLECTION_PERCENTILE,zt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),zt.DISABLED=new zt(-1,0,0);var ov=function(){function e(t,n,r,i){this.userId=t,this.R=n,this.Ut=r,this.referenceDelegate=i,this.Kt={}}return e.Qt=function(t,n,r,i){return O(t.uid!==""),new e(t.isAuthenticated()?t.uid:"",n,r,i)},e.prototype.checkEmpty=function(t){var n=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return se(t).$t({index:K.userMutationsIndex,range:r},function(i,o,s){n=!1,s.done()}).next(function(){return n})},e.prototype.addMutationBatch=function(t,n,r,i){var o=this,s=pn(t),a=se(t);return a.add({}).next(function(u){O(typeof u=="number");for(var c=new ds(u,n,r,i),h=function(E,A,D){var k=D.baseMutations.map(function(q){return bi(E.Lt,q)}),M=D.mutations.map(function(q){return bi(E.Lt,q)});return new K(A,D.batchId,D.localWriteTime.toMillis(),k,M)}(o.R,o.userId,c),f=[],l=new tt(function(E,A){return L(E.canonicalString(),A.canonicalString())}),d=0,p=i;d<p.length;d++){var v=p[d],w=vt.key(o.userId,v.key.path,u);l=l.add(v.key.path.popLast()),f.push(a.put(h)),f.push(s.put(w,vt.PLACEHOLDER))}return l.forEach(function(E){f.push(o.Ut.addToCollectionParentIndex(t,E))}),t.addOnCommittedListener(function(){o.Kt[u]=c.keys()}),_.waitFor(f).next(function(){return c})})},e.prototype.lookupMutationBatch=function(t,n){var r=this;return se(t).get(n).next(function(i){return i?(O(i.userId===r.userId),dn(r.R,i)):null})},e.prototype.jt=function(t,n){var r=this;return this.Kt[n]?_.resolve(this.Kt[n]):this.lookupMutationBatch(t,n).next(function(i){if(i){var o=i.keys();return r.Kt[n]=o,o}return null})},e.prototype.getNextMutationBatchAfterBatchId=function(t,n){var r=this,i=n+1,o=IDBKeyRange.lowerBound([this.userId,i]),s=null;return se(t).$t({index:K.userMutationsIndex,range:o},function(a,u,c){u.userId===r.userId&&(O(u.batchId>=i),s=dn(r.R,u)),c.done()}).next(function(){return s})},e.prototype.getHighestUnacknowledgedBatchId=function(t){var n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return se(t).$t({index:K.userMutationsIndex,range:n,reverse:!0},function(i,o,s){r=o.batchId,s.done()}).next(function(){return r})},e.prototype.getAllMutationBatches=function(t){var n=this,r=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return se(t).Nt(K.userMutationsIndex,r).next(function(i){return i.map(function(o){return dn(n.R,o)})})},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,i=vt.prefixForPath(this.userId,n.path),o=IDBKeyRange.lowerBound(i),s=[];return pn(t).$t({range:o},function(a,u,c){var h=a[0],f=a[1],l=a[2],d=Yt(f);if(h===r.userId&&n.path.isEqual(d))return se(t).get(l).next(function(p){if(!p)throw N();O(p.userId===r.userId),s.push(dn(r.R,p))});c.done()}).next(function(){return s})},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,n){var r=this,i=new tt(L),o=[];return n.forEach(function(s){var a=vt.prefixForPath(r.userId,s.path),u=IDBKeyRange.lowerBound(a),c=pn(t).$t({range:u},function(h,f,l){var d=h[0],p=h[1],v=h[2],w=Yt(p);d===r.userId&&s.path.isEqual(w)?i=i.add(v):l.done()});o.push(c)}),_.waitFor(o).next(function(){return r.Wt(t,i)})},e.prototype.getAllMutationBatchesAffectingQuery=function(t,n){var r=this,i=n.path,o=i.length+1,s=vt.prefixForPath(this.userId,i),a=IDBKeyRange.lowerBound(s),u=new tt(L);return pn(t).$t({range:a},function(c,h,f){var l=c[0],d=c[1],p=c[2],v=Yt(d);l===r.userId&&i.isPrefixOf(v)?v.length===o&&(u=u.add(p)):f.done()}).next(function(){return r.Wt(t,u)})},e.prototype.Wt=function(t,n){var r=this,i=[],o=[];return n.forEach(function(s){o.push(se(t).get(s).next(function(a){if(a===null)throw N();O(a.userId===r.userId),i.push(dn(r.R,a))}))}),_.waitFor(o).next(function(){return i})},e.prototype.removeMutationBatch=function(t,n){var r=this;return Ch(t.Mt,this.userId,n).next(function(i){return t.addOnCommittedListener(function(){r.Gt(n.batchId)}),_.forEach(i,function(o){return r.referenceDelegate.markPotentiallyOrphaned(t,o)})})},e.prototype.Gt=function(t){delete this.Kt[t]},e.prototype.performConsistencyCheck=function(t){var n=this;return this.checkEmpty(t).next(function(r){if(!r)return _.resolve();var i=IDBKeyRange.lowerBound(vt.prefixForUser(n.userId)),o=[];return pn(t).$t({range:i},function(s,a,u){if(s[0]===n.userId){var c=Yt(s[1]);o.push(c)}else u.done()}).next(function(){O(o.length===0)})})},e.prototype.containsKey=function(t,n){return Rh(t,this.userId,n)},e.prototype.zt=function(t){var n=this;return Oh(t).get(this.userId).next(function(r){return r||new oe(n.userId,-1,"")})},e}();function Rh(e,t,n){var r=vt.prefixForPath(t,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return pn(e).$t({range:o,Ft:!0},function(a,u,c){var h=a[0],f=a[1];a[2],h===t&&f===i&&(s=!0),c.done()}).next(function(){return s})}function se(e){return St(e,K.store)}function pn(e){return St(e,vt.store)}function Oh(e){return St(e,oe.store)}var Ii=function(){function e(t){this.Ht=t}return e.prototype.next=function(){return this.Ht+=2,this.Ht},e.Jt=function(){return new e(0)},e.Yt=function(){return new e(-1)},e}(),sv=function(){function e(t,n){this.referenceDelegate=t,this.R=n}return e.prototype.allocateTargetId=function(t){var n=this;return this.Xt(t).next(function(r){var i=new Ii(r.highestTargetId);return r.highestTargetId=i.next(),n.Zt(t,r).next(function(){return r.highestTargetId})})},e.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(n){return P.fromTimestamp(new _t(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds))})},e.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(n){return n.highestListenSequenceNumber})},e.prototype.setTargetsMetadata=function(t,n,r){var i=this;return this.Xt(t).next(function(o){return o.highestListenSequenceNumber=n,r&&(o.lastRemoteSnapshotVersion=r.toTimestamp()),n>o.highestListenSequenceNumber&&(o.highestListenSequenceNumber=n),i.Zt(t,o)})},e.prototype.addTargetData=function(t,n){var r=this;return this.te(t,n).next(function(){return r.Xt(t).next(function(i){return i.targetCount+=1,r.ee(n,i),r.Zt(t,i)})})},e.prototype.updateTargetData=function(t,n){return this.te(t,n)},e.prototype.removeTargetData=function(t,n){var r=this;return this.removeMatchingKeysForTargetId(t,n.targetId).next(function(){return vn(t).delete(n.targetId)}).next(function(){return r.Xt(t)}).next(function(i){return O(i.targetCount>0),i.targetCount-=1,r.Zt(t,i)})},e.prototype.removeTargets=function(t,n,r){var i=this,o=0,s=[];return vn(t).$t(function(a,u){var c=hr(u);c.sequenceNumber<=n&&r.get(c.targetId)===null&&(o++,s.push(i.removeTargetData(t,c)))}).next(function(){return _.waitFor(s)}).next(function(){return o})},e.prototype.forEachTarget=function(t,n){return vn(t).$t(function(r,i){var o=hr(i);n(o)})},e.prototype.Xt=function(t){return xh(t).get(Ot.key).next(function(n){return O(n!==null),n})},e.prototype.Zt=function(t,n){return xh(t).put(Ot.key,n)},e.prototype.te=function(t,n){return vn(t).put(Th(this.R,n))},e.prototype.ee=function(t,n){var r=!1;return t.targetId>n.highestTargetId&&(n.highestTargetId=t.targetId,r=!0),t.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t.sequenceNumber,r=!0),r},e.prototype.getTargetCount=function(t){return this.Xt(t).next(function(n){return n.targetCount})},e.prototype.getTargetData=function(t,n){var r=Zn(n),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return vn(t).$t({range:i,index:Tt.queryTargetsIndexName},function(s,a,u){var c=hr(a);ci(n,c.target)&&(o=c,u.done())}).next(function(){return o})},e.prototype.addMatchingKeys=function(t,n,r){var i=this,o=[],s=ae(t);return n.forEach(function(a){var u=Ut(a.path);o.push(s.put(new ct(r,u))),o.push(i.referenceDelegate.addReference(t,r,a))}),_.waitFor(o)},e.prototype.removeMatchingKeys=function(t,n,r){var i=this,o=ae(t);return _.forEach(n,function(s){var a=Ut(s.path);return _.waitFor([o.delete([r,a]),i.referenceDelegate.removeReference(t,r,s)])})},e.prototype.removeMatchingKeysForTargetId=function(t,n){var r=ae(t),i=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(i)},e.prototype.getMatchingKeysForTargetId=function(t,n){var r=IDBKeyRange.bound([n],[n+1],!1,!0),i=ae(t),o=B();return i.$t({range:r,Ft:!0},function(s,a,u){var c=Yt(s[1]),h=new C(c);o=o.add(h)}).next(function(){return o})},e.prototype.containsKey=function(t,n){var r=Ut(n.path),i=IDBKeyRange.bound([r],[vc(r)],!1,!0),o=0;return ae(t).$t({index:ct.documentTargetsIndex,Ft:!0,range:i},function(s,a,u){var c=s[0];s[1],c!==0&&(o++,u.done())}).next(function(){return o>0})},e.prototype.lt=function(t,n){return vn(t).get(n).next(function(r){return r?hr(r):null})},e}();function vn(e){return St(e,Tt.store)}function xh(e){return St(e,Ot.store)}function ae(e){return St(e,ct.store)}function xe(e){return m(this,void 0,void 0,function(){return g(this,function(t){if(e.code!==y.FAILED_PRECONDITION||e.message!==yh)throw e;return I("LocalStore","Unexpectedly lost primary lease"),[2]})})}function kh(e,t){var n=e[0],r=e[1],i=t[0],o=t[1],s=L(n,i);return s===0?L(r,o):s}var av=function(){function e(t){this.ne=t,this.buffer=new tt(kh),this.se=0}return e.prototype.ie=function(){return++this.se},e.prototype.re=function(t){var n=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(n);else{var r=this.buffer.last();kh(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}},Object.defineProperty(e.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),e}(),uv=function(){function e(t,n){this.garbageCollector=t,this.asyncQueue=n,this.oe=!1,this.ce=null}return e.prototype.start=function(t){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.ue(t)},e.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(e.prototype,"started",{get:function(){return this.ce!==null},enumerable:!1,configurable:!0}),e.prototype.ue=function(t){var n=this,r=this.oe?3e5:6e4;I("LruGarbageCollector","Garbage collection scheduled in "+r+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",r,function(){return m(n,void 0,void 0,function(){var i;return g(this,function(o){switch(o.label){case 0:this.ce=null,this.oe=!0,o.label=1;case 1:return o.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return o.sent(),[3,7];case 3:return Re(i=o.sent())?(I("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",i),[3,6]):[3,4];case 4:return[4,xe(i)];case 5:o.sent(),o.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return o.sent(),[2]}})})})},e}(),cv=function(){function e(t,n){this.ae=t,this.params=n}return e.prototype.calculateTargetCount=function(t,n){return this.ae.he(t).next(function(r){return Math.floor(n/100*r)})},e.prototype.nthSequenceNumber=function(t,n){var r=this;if(n===0)return _.resolve(Dt.o);var i=new av(n);return this.ae.forEachTarget(t,function(o){return i.re(o.sequenceNumber)}).next(function(){return r.ae.le(t,function(o){return i.re(o)})}).next(function(){return i.maxValue})},e.prototype.removeTargets=function(t,n,r){return this.ae.removeTargets(t,n,r)},e.prototype.removeOrphanedDocuments=function(t,n){return this.ae.removeOrphanedDocuments(t,n)},e.prototype.collect=function(t,n){var r=this;return this.params.cacheSizeCollectionThreshold===-1?(I("LruGarbageCollector","Garbage collection skipped; disabled"),_.resolve(Nh)):this.getCacheSize(t).next(function(i){return i<r.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector","Garbage collection skipped; Cache size "+i+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),Nh):r.fe(t,n)})},e.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},e.prototype.fe=function(t,n){var r,i,o,s,a,u,c,h=this,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(l){return l>h.params.maximumSequenceNumbersToCollect?(I("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.maximumSequenceNumbersToCollect+" from "+l),i=h.params.maximumSequenceNumbersToCollect):i=l,s=Date.now(),h.nthSequenceNumber(t,i)}).next(function(l){return r=l,a=Date.now(),h.removeTargets(t,r,n)}).next(function(l){return o=l,u=Date.now(),h.removeOrphanedDocuments(t,r)}).next(function(l){return c=Date.now(),Wo()<=V.DEBUG&&I("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in `+(s-f)+`ms
	Determined least recently used `+i+" in "+(a-s)+`ms
	Removed `+o+" targets in "+(u-a)+`ms
	Removed `+l+" documents in "+(c-u)+`ms
Total Duration: `+(c-f)+"ms"),_.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:l})})},e}(),hv=function(){function e(t,n){this.db=t,this.garbageCollector=function(r,i){return new cv(r,i)}(this,n)}return e.prototype.he=function(t){var n=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(r){return n.next(function(i){return r+i})})},e.prototype.de=function(t){var n=0;return this.le(t,function(r){n++}).next(function(){return n})},e.prototype.forEachTarget=function(t,n){return this.db.getTargetCache().forEachTarget(t,n)},e.prototype.le=function(t,n){return this.we(t,function(r,i){return n(i)})},e.prototype.addReference=function(t,n,r){return Ti(t,r)},e.prototype.removeReference=function(t,n,r){return Ti(t,r)},e.prototype.removeTargets=function(t,n,r){return this.db.getTargetCache().removeTargets(t,n,r)},e.prototype.markPotentiallyOrphaned=function(t,n){return Ti(t,n)},e.prototype._e=function(t,n){return function(r,i){var o=!1;return Oh(r).Ot(function(s){return Rh(r,s,i).next(function(a){return a&&(o=!0),_.resolve(!a)})}).next(function(){return o})}(t,n)},e.prototype.removeOrphanedDocuments=function(t,n){var r=this,i=this.db.getRemoteDocumentCache().newChangeBuffer(),o=[],s=0;return this.we(t,function(a,u){if(u<=n){var c=r._e(t,a).next(function(h){if(!h)return s++,i.getEntry(t,a).next(function(){return i.removeEntry(a),ae(t).delete([0,Ut(a.path)])})});o.push(c)}}).next(function(){return _.waitFor(o)}).next(function(){return i.apply(t)}).next(function(){return s})},e.prototype.removeTarget=function(t,n){var r=n.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,r)},e.prototype.updateLimboDocument=function(t,n){return Ti(t,n)},e.prototype.we=function(t,n){var r,i=ae(t),o=Dt.o;return i.$t({index:ct.documentTargetsIndex},function(s,a){var u=s[0];s[1];var c=a.path,h=a.sequenceNumber;u===0?(o!==Dt.o&&n(new C(Yt(r)),o),o=h,r=c):o=Dt.o}).next(function(){o!==Dt.o&&n(new C(Yt(r)),o)})},e.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},e}();function Ti(e,t){return ae(e).put(function(n,r){return new ct(0,Ut(n.path),r)}(t,e.currentSequenceNumber))}var yn=function(){function e(t,n){this.mapKeyFn=t,this.equalsFn=n,this.inner={}}return e.prototype.get=function(t){var n=this.mapKeyFn(t),r=this.inner[n];if(r!==void 0)for(var i=0,o=r;i<o.length;i++){var s=o[i],a=s[0],u=s[1];if(this.equalsFn(a,t))return u}},e.prototype.has=function(t){return this.get(t)!==void 0},e.prototype.set=function(t,n){var r=this.mapKeyFn(t),i=this.inner[r];if(i!==void 0){for(var o=0;o<i.length;o++)if(this.equalsFn(i[o][0],t))return void(i[o]=[t,n]);i.push([t,n])}else this.inner[r]=[[t,n]]},e.prototype.delete=function(t){var n=this.mapKeyFn(t),r=this.inner[n];if(r===void 0)return!1;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[n]:r.splice(i,1),!0;return!1},e.prototype.forEach=function(t){Te(this.inner,function(n,r){for(var i=0,o=r;i<o.length;i++){var s=o[i],a=s[0],u=s[1];t(a,u)}})},e.prototype.isEmpty=function(){return gc(this.inner)},e}(),Ph=function(){function e(){this.changes=new yn(function(t){return t.toString()},function(t,n){return t.isEqual(n)}),this.changesApplied=!1}return e.prototype.getReadTime=function(t){var n=this.changes.get(t);return n?n.readTime:P.min()},e.prototype.addEntry=function(t,n){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:n})},e.prototype.removeEntry=function(t,n){n===void 0&&(n=null),this.assertNotApplied(),this.changes.set(t,{document:at.newInvalidDocument(t),readTime:n})},e.prototype.getEntry=function(t,n){this.assertNotApplied();var r=this.changes.get(n);return r!==void 0?_.resolve(r.document):this.getFromCache(t,n)},e.prototype.getEntries=function(t,n){return this.getAllFromCache(t,n)},e.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},e.prototype.assertNotApplied=function(){},e}(),lv=function(){function e(t,n){this.R=t,this.Ut=n}return e.prototype.addEntry=function(t,n,r){return ue(t).put(Si(n),r)},e.prototype.removeEntry=function(t,n){var r=ue(t),i=Si(n);return r.delete(i)},e.prototype.updateMetadata=function(t,n){var r=this;return this.getMetadata(t).next(function(i){return i.byteSize+=n,r.me(t,i)})},e.prototype.getEntry=function(t,n){var r=this;return ue(t).get(Si(n)).next(function(i){return r.ye(n,i)})},e.prototype.ge=function(t,n){var r=this;return ue(t).get(Si(n)).next(function(i){return{document:r.ye(n,i),size:Ei(i)}})},e.prototype.getEntries=function(t,n){var r=this,i=Lt();return this.pe(t,n,function(o,s){var a=r.ye(o,s);i=i.insert(o,a)}).next(function(){return i})},e.prototype.Ee=function(t,n){var r=this,i=Lt(),o=new pt(C.comparator);return this.pe(t,n,function(s,a){var u=r.ye(s,a);i=i.insert(s,u),o=o.insert(s,Ei(a))}).next(function(){return{documents:i,Te:o}})},e.prototype.pe=function(t,n,r){if(n.isEmpty())return _.resolve();var i=IDBKeyRange.bound(n.first().path.toArray(),n.last().path.toArray()),o=n.getIterator(),s=o.getNext();return ue(t).$t({range:i},function(a,u,c){for(var h=C.fromSegments(a);s&&C.comparator(s,h)<0;)r(s,null),s=o.getNext();s&&s.isEqual(h)&&(r(s,u),s=o.hasNext()?o.getNext():null),s?c.Ct(s.path.toArray()):c.done()}).next(function(){for(;s;)r(s,null),s=o.hasNext()?o.getNext():null})},e.prototype.getDocumentsMatchingQuery=function(t,n,r){var i=this,o=Lt(),s=n.path.length+1,a={};if(r.isEqual(P.min())){var u=n.path.toArray();a.range=IDBKeyRange.lowerBound(u)}else{var c=n.path.toArray(),h=vs(r);a.range=IDBKeyRange.lowerBound([c,h],!0),a.index=Q.collectionReadTimeIndex}return ue(t).$t(a,function(f,l,d){if(f.length===s){var p=ps(i.R,l);n.path.isPrefixOf(p.key.path)?nr(n,p)&&(o=o.insert(p.key,p)):d.done()}}).next(function(){return o})},e.prototype.newChangeBuffer=function(t){return new fv(this,!!t&&t.trackRemovals)},e.prototype.getSize=function(t){return this.getMetadata(t).next(function(n){return n.byteSize})},e.prototype.getMetadata=function(t){return Lh(t).get(Kt.key).next(function(n){return O(!!n),n})},e.prototype.me=function(t,n){return Lh(t).put(Kt.key,n)},e.prototype.ye=function(t,n){if(n){var r=ps(this.R,n);if(!r.isNoDocument()||!r.version.isEqual(P.min()))return r}return at.newInvalidDocument(t)},e}(),fv=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).Ie=n,i.trackRemovals=r,i.Ae=new yn(function(o){return o.toString()},function(o,s){return o.isEqual(s)}),i}return R(t,e),t.prototype.applyChanges=function(n){var r=this,i=[],o=0,s=new tt(function(a,u){return L(a.canonicalString(),u.canonicalString())});return this.changes.forEach(function(a,u){var c=r.Ae.get(a);if(u.document.isValidDocument()){var h=Eh(r.Ie.R,u.document,r.getReadTime(a));s=s.add(a.path.popLast());var f=Ei(h);o+=f-c,i.push(r.Ie.addEntry(n,a,h))}else if(o-=c,r.trackRemovals){var l=Eh(r.Ie.R,at.newNoDocument(a,P.min()),r.getReadTime(a));i.push(r.Ie.addEntry(n,a,l))}else i.push(r.Ie.removeEntry(n,a))}),s.forEach(function(a){i.push(r.Ie.Ut.addToCollectionParentIndex(n,a))}),i.push(this.Ie.updateMetadata(n,o)),_.waitFor(i)},t.prototype.getFromCache=function(n,r){var i=this;return this.Ie.ge(n,r).next(function(o){return i.Ae.set(r,o.size),o.document})},t.prototype.getAllFromCache=function(n,r){var i=this;return this.Ie.Ee(n,r).next(function(o){var s=o.documents;return o.Te.forEach(function(a,u){i.Ae.set(a,u)}),s})},t}(Ph);function Lh(e){return St(e,Kt.store)}function ue(e){return St(e,Q.store)}function Si(e){return e.path.toArray()}var dv=function(){function e(t){this.R=t}return e.prototype.Rt=function(t,n,r,i){var o=this;O(r<i&&r>=0&&i<=11);var s=new mh("createOrUpgrade",n);r<1&&i>=1&&(function(u){u.createObjectStore(Rt.store)}(t),function(u){u.createObjectStore(oe.store,{keyPath:oe.keyPath}),u.createObjectStore(K.store,{keyPath:K.keyPath,autoIncrement:!0}).createIndex(K.userMutationsIndex,K.userMutationsKeyPath,{unique:!0}),u.createObjectStore(vt.store)}(t),Mh(t),function(u){u.createObjectStore(Q.store)}(t));var a=_.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore(ct.store),u.deleteObjectStore(Tt.store),u.deleteObjectStore(Ot.store)}(t),Mh(t)),a=a.next(function(){return function(u){var c=u.store(Ot.store),h=new Ot(0,0,P.min().toTimestamp(),0);return c.put(Ot.key,h)}(s)})),r<4&&i>=4&&(r!==0&&(a=a.next(function(){return function(u,c){return c.store(K.store).Nt().next(function(h){u.deleteObjectStore(K.store),u.createObjectStore(K.store,{keyPath:K.keyPath,autoIncrement:!0}).createIndex(K.userMutationsIndex,K.userMutationsKeyPath,{unique:!0});var f=c.store(K.store),l=h.map(function(d){return f.put(d)});return _.waitFor(l)})}(t,s)})),a=a.next(function(){(function(u){u.createObjectStore(Xt.store,{keyPath:Xt.keyPath})})(t)})),r<5&&i>=5&&(a=a.next(function(){return o.Re(s)})),r<6&&i>=6&&(a=a.next(function(){return function(u){u.createObjectStore(Kt.store)}(t),o.be(s)})),r<7&&i>=7&&(a=a.next(function(){return o.ve(s)})),r<8&&i>=8&&(a=a.next(function(){return o.Pe(t,s)})),r<9&&i>=9&&(a=a.next(function(){(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(t),function(u){var c=u.objectStore(Q.store);c.createIndex(Q.readTimeIndex,Q.readTimeIndexPath,{unique:!1}),c.createIndex(Q.collectionReadTimeIndex,Q.collectionReadTimeIndexPath,{unique:!1})}(n)})),r<10&&i>=10&&(a=a.next(function(){return o.Ve(s)})),r<11&&i>=11&&(a=a.next(function(){(function(u){u.createObjectStore(un.store,{keyPath:un.keyPath})})(t),function(u){u.createObjectStore(cn.store,{keyPath:cn.keyPath})}(t)})),a},e.prototype.be=function(t){var n=0;return t.store(Q.store).$t(function(r,i){n+=Ei(i)}).next(function(){var r=new Kt(n);return t.store(Kt.store).put(Kt.key,r)})},e.prototype.Re=function(t){var n=this,r=t.store(oe.store),i=t.store(K.store);return r.Nt().next(function(o){return _.forEach(o,function(s){var a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.Nt(K.userMutationsIndex,a).next(function(u){return _.forEach(u,function(c){O(c.userId===s.userId);var h=dn(n.R,c);return Ch(t,s.userId,h).next(function(){})})})})})},e.prototype.ve=function(t){var n=t.store(ct.store),r=t.store(Q.store);return t.store(Ot.store).get(Ot.key).next(function(i){var o=[];return r.$t(function(s,a){var u=new U(s),c=function(h){return[0,Ut(h)]}(u);o.push(n.get(c).next(function(h){return h?_.resolve():function(f){return n.put(new ct(0,Ut(f),i.highestListenSequenceNumber))}(u)}))}).next(function(){return _.waitFor(o)})})},e.prototype.Pe=function(t,n){t.createObjectStore(Ce.store,{keyPath:Ce.keyPath});var r=n.store(Ce.store),i=new gs,o=function(s){if(i.add(s)){var a=s.lastSegment(),u=s.popLast();return r.put({collectionId:a,parent:Ut(u)})}};return n.store(Q.store).$t({Ft:!0},function(s,a){var u=new U(s);return o(u.popLast())}).next(function(){return n.store(vt.store).$t({Ft:!0},function(s,a){s[0];var u=s[1];s[2];var c=Yt(u);return o(c.popLast())})})},e.prototype.Ve=function(t){var n=this,r=t.store(Tt.store);return r.$t(function(i,o){var s=hr(o),a=Th(n.R,s);return r.put(a)})},e}();function Mh(e){e.createObjectStore(ct.store,{keyPath:ct.keyPath}).createIndex(ct.documentTargetsIndex,ct.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(Tt.store,{keyPath:Tt.keyPath}).createIndex(Tt.queryTargetsIndexName,Tt.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(Ot.store)}var ms="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",pv=function(){function e(t,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(f){return Promise.resolve()},!e.yt())throw new b(y.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new hv(this,i),this.Le=n+"main",this.R=new _h(u),this.Be=new hn(this.Le,11,new dv(this.R)),this.qe=new sv(this.referenceDelegate,this.R),this.Ut=new iv,this.Ue=function(f,l){return new lv(f,l)}(this.R,this.Ut),this.Ke=new nv,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,h===!1&&X("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return e.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new b(y.FAILED_PRECONDITION,ms);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(n){return t.qe.getHighestSequenceNumber(n)})}).then(function(n){t.Ne=new Dt(n,t.De)}).then(function(){t.xe=!0}).catch(function(n){return t.Be&&t.Be.close(),Promise.reject(n)})},e.prototype.He=function(t){var n=this;return this.Me=function(r){return m(n,void 0,void 0,function(){return g(this,function(i){return this.started?[2,t(r)]:[2]})})},t(this.isPrimary)},e.prototype.setDatabaseDeletedListener=function(t){var n=this;this.Be.vt(function(r){return m(n,void 0,void 0,function(){return g(this,function(i){switch(i.label){case 0:return r.newVersion===null?[4,t()]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})})},e.prototype.setNetworkEnabled=function(t){var n=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return m(n,void 0,void 0,function(){return g(this,function(r){switch(r.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}})})}))},e.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(n){return Ai(n).put(new Xt(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(n).next(function(r){r||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(n)}).next(function(r){return t.isPrimary&&!r?t.Xe(n).next(function(){return!1}):!!r&&t.Ze(n).next(function(){return!0})})}).catch(function(n){if(Re(n))return I("IndexedDbPersistence","Failed to extend owner lease: ",n),t.isPrimary;if(!t.allowTabSynchronization)throw n;return I("IndexedDbPersistence","Releasing owner lease after error during lease refresh",n),!1}).then(function(n){t.isPrimary!==n&&t.Se.enqueueRetryable(function(){return t.Me(n)}),t.isPrimary=n})},e.prototype.Je=function(t){var n=this;return lr(t).get(Rt.key).next(function(r){return _.resolve(n.tn(r))})},e.prototype.en=function(t){return Ai(t).delete(this.clientId)},e.prototype.nn=function(){return m(this,void 0,void 0,function(){var t,n,r,i,o=this;return g(this,function(s){switch(s.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(a){var u=St(a,Xt.store);return u.Nt().next(function(c){var h=o.rn(c,18e5),f=c.filter(function(l){return h.indexOf(l)===-1});return _.forEach(f,function(l){return u.delete(l.clientId)}).next(function(){return f})})}).catch(function(){return[]})]);case 1:if(t=s.sent(),this.Qe)for(n=0,r=t;n<r.length;n++)i=r[n],this.Qe.removeItem(this.on(i.clientId));s.label=2;case 2:return[2]}})})},e.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},e.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},e.prototype.Ye=function(t){var n=this;return this.Ce?_.resolve(!0):lr(t).get(Rt.key).next(function(r){if(r!==null&&n.sn(r.leaseTimestampMs,5e3)&&!n.cn(r.ownerId)){if(n.tn(r)&&n.networkEnabled)return!0;if(!n.tn(r)){if(!r.allowTabSynchronization)throw new b(y.FAILED_PRECONDITION,ms);return!1}}return!(!n.networkEnabled||!n.inForeground)||Ai(t).Nt().next(function(i){return n.rn(i,5e3).find(function(o){if(n.clientId!==o.clientId){var s=!n.networkEnabled&&o.networkEnabled,a=!n.inForeground&&o.inForeground,u=n.networkEnabled===o.networkEnabled;if(s||a&&u)return!0}return!1})===void 0})}).next(function(r){return n.isPrimary!==r&&I("IndexedDbPersistence","Client "+(r?"is":"is not")+" eligible for a primary lease."),r})},e.prototype.shutdown=function(){return m(this,void 0,void 0,function(){var t=this;return g(this,function(n){switch(n.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[Rt.store,Xt.store],function(r){var i=new bh(r,Dt.o);return t.Xe(i).next(function(){return t.en(i)})})];case 1:return n.sent(),this.Be.close(),this.ln(),[2]}})})},e.prototype.rn=function(t,n){var r=this;return t.filter(function(i){return r.sn(i.updateTimeMs,n)&&!r.cn(i.clientId)})},e.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(n){return Ai(n).Nt().next(function(r){return t.rn(r,18e5).map(function(i){return i.clientId})})})},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.getMutationQueue=function(t){return ov.Qt(t,this.R,this.Ut,this.referenceDelegate)},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getBundleCache=function(){return this.Ke},e.prototype.runTransaction=function(t,n,r){var i=this;I("IndexedDbPersistence","Starting transaction:",t);var o,s=n==="readonly"?"readonly":"readwrite";return this.Be.runTransaction(t,s,Jp,function(a){return o=new bh(a,i.Ne?i.Ne.next():Dt.o),n==="readwrite-primary"?i.Je(o).next(function(u){return!!u||i.Ye(o)}).next(function(u){if(!u)throw X("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new b(y.FAILED_PRECONDITION,yh);return r(o)}).next(function(u){return i.Ze(o).next(function(){return u})}):i.dn(o).next(function(){return r(o)})}).then(function(a){return o.raiseOnCommittedEvent(),a})},e.prototype.dn=function(t){var n=this;return lr(t).get(Rt.key).next(function(r){if(r!==null&&n.sn(r.leaseTimestampMs,5e3)&&!n.cn(r.ownerId)&&!n.tn(r)&&!(n.Ce||n.allowTabSynchronization&&r.allowTabSynchronization))throw new b(y.FAILED_PRECONDITION,ms)})},e.prototype.Ze=function(t){var n=new Rt(this.clientId,this.allowTabSynchronization,Date.now());return lr(t).put(Rt.key,n)},e.yt=function(){return hn.yt()},e.prototype.Xe=function(t){var n=this,r=lr(t);return r.get(Rt.key).next(function(i){return n.tn(i)?(I("IndexedDbPersistence","Releasing primary lease."),r.delete(Rt.key)):_.resolve()})},e.prototype.sn=function(t,n){var r=Date.now();return!(t<r-n||t>r&&(X("Detected an update time that is in the future: "+t+" > "+r),1))},e.prototype.We=function(){var t=this;this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Fe=function(){t.Se.enqueueAndForget(function(){return t.inForeground=t.document.visibilityState==="visible",t.je()})},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground=this.document.visibilityState==="visible")},e.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},e.prototype.Ge=function(){var t,n=this;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.ke=function(){n.un(),ja()&&navigator.appVersion.match("Version/14")&&n.Se.enterRestrictedMode(!0),n.Se.enqueueAndForget(function(){return n.shutdown()})},this.window.addEventListener("pagehide",this.ke))},e.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},e.prototype.cn=function(t){var n;try{var r=((n=this.Qe)===null||n===void 0?void 0:n.getItem(this.on(t)))!==null;return I("IndexedDbPersistence","Client '"+t+"' "+(r?"is":"is not")+" zombied in LocalStorage"),r}catch(i){return X("IndexedDbPersistence","Failed to get zombied client id.",i),!1}},e.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){X("Failed to set zombie client id.",t)}},e.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},e.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},e}();function lr(e){return St(e,Rt.store)}function Ai(e){return St(e,Xt.store)}function ws(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var vv=function(e,t){this.progress=e,this.wn=t},Fh=function(){function e(t,n,r){this.Ue=t,this._n=n,this.Ut=r}return e.prototype.mn=function(t,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,n).next(function(i){return r.yn(t,n,i)})},e.prototype.yn=function(t,n,r){return this.Ue.getEntry(t,n).next(function(i){for(var o=0,s=r;o<s.length;o++)s[o].applyToLocalView(i);return i})},e.prototype.gn=function(t,n){t.forEach(function(r,i){for(var o=0,s=n;o<s.length;o++)s[o].applyToLocalView(i)})},e.prototype.pn=function(t,n){var r=this;return this.Ue.getEntries(t,n).next(function(i){return r.En(t,i).next(function(){return i})})},e.prototype.En=function(t,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,n).next(function(i){return r.gn(n,i)})},e.prototype.getDocumentsMatchingQuery=function(t,n,r){return function(i){return C.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0}(n)?this.Tn(t,n.path):rs(n)?this.In(t,n,r):this.An(t,n,r)},e.prototype.Tn=function(t,n){return this.mn(t,new C(n)).next(function(r){var i=as();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})},e.prototype.In=function(t,n,r){var i=this,o=n.collectionGroup,s=as();return this.Ut.getCollectionParents(t,o).next(function(a){return _.forEach(a,function(u){var c=function(h,f){return new Wt(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,u.child(o));return i.An(t,c,r).next(function(h){h.forEach(function(f,l){s=s.insert(f,l)})})}).next(function(){return s})})},e.prototype.An=function(t,n,r){var i,o,s=this;return this.Ue.getDocumentsMatchingQuery(t,n,r).next(function(a){return i=a,s._n.getAllMutationBatchesAffectingQuery(t,n)}).next(function(a){return o=a,s.Rn(t,o,i).next(function(u){i=u;for(var c=0,h=o;c<h.length;c++)for(var f=h[c],l=0,d=f.mutations;l<d.length;l++){var p=d[l],v=p.key,w=i.get(v);w==null&&(w=at.newInvalidDocument(v),i=i.insert(v,w)),os(p,w,f.localWriteTime),w.isFoundDocument()||(i=i.remove(v))}})}).next(function(){return i.forEach(function(a,u){nr(n,u)||(i=i.remove(a))}),i})},e.prototype.Rn=function(t,n,r){for(var i=B(),o=0,s=n;o<s.length;o++)for(var a=0,u=s[o].mutations;a<u.length;a++){var c=u[a];c instanceof re&&r.get(c.key)===null&&(i=i.add(c.key))}var h=r;return this.Ue.getEntries(t,i).next(function(f){return f.forEach(function(l,d){d.isFoundDocument()&&(h=h.insert(l,d))}),h})},e}(),yv=function(){function e(t,n,r,i){this.targetId=t,this.fromCache=n,this.bn=r,this.vn=i}return e.Pn=function(t,n){for(var r=B(),i=B(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new e(t,n.fromCache,r,i)},e}(),Vh=function(){function e(){}return e.prototype.Vn=function(t){this.Sn=t},e.prototype.getDocumentsMatchingQuery=function(t,n,r,i){var o=this;return function(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())}(n)||r.isEqual(P.min())?this.Dn(t,n):this.Sn.pn(t,i).next(function(s){var a=o.Cn(n,s);return(fi(n)||di(n))&&o.Nn(n.limitType,a,i,r)?o.Dn(t,n):(Wo()<=V.DEBUG&&I("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),is(n)),o.Sn.getDocumentsMatchingQuery(t,n,r).next(function(u){return a.forEach(function(c){u=u.insert(c.key,c)}),u}))})},e.prototype.Cn=function(t,n){var r=new tt(xc(t));return n.forEach(function(i,o){nr(t,o)&&(r=r.add(o))}),r},e.prototype.Nn=function(t,n,r,i){if(r.size!==n.size)return!0;var o=t==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)},e.prototype.Dn=function(t,n){return Wo()<=V.DEBUG&&I("QueryEngine","Using full collection scan to execute query:",is(n)),this.Sn.getDocumentsMatchingQuery(t,n,P.min())},e}(),gv=function(){function e(t,n,r,i){this.persistence=t,this.xn=n,this.R=i,this.kn=new pt(L),this.Fn=new yn(function(o){return Zn(o)},ci),this.$n=P.min(),this._n=t.getMutationQueue(r),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Fh(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return e.prototype.collectGarbage=function(t){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(r){return t.collect(r,n.kn)})},e}();function Uh(e,t,n,r){return new gv(e,t,n,r)}function jh(e,t){return m(this,void 0,void 0,function(){var n,r,i,o;return g(this,function(s){switch(s.label){case 0:return n=T(e),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(a){var u;return n._n.getAllMutationBatches(a).next(function(c){return u=c,r=n.persistence.getMutationQueue(t),i=new Fh(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(a)}).next(function(c){for(var h=[],f=[],l=B(),d=0,p=u;d<p.length;d++){var v=p[d];h.push(v.batchId);for(var w=0,E=v.mutations;w<E.length;w++){var A=E[w];l=l.add(A.key)}}for(var D=0,k=c;D<k.length;D++){var M=k[D];f.push(M.batchId);for(var q=0,rt=M.mutations;q<rt.length;q++){var Hi=rt[q];l=l.add(Hi.key)}}return i.pn(a,l).next(function(Nn){return{Ln:Nn,removedBatchIds:h,addedBatchIds:f}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function mv(e,t){var n=T(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(r){var i=t.batch.keys(),o=n.On.newChangeBuffer({trackRemovals:!0});return function(s,a,u,c){var h=u.batch,f=h.keys(),l=_.resolve();return f.forEach(function(d){l=l.next(function(){return c.getEntry(a,d)}).next(function(p){var v=u.docVersions.get(d);O(v!==null),p.version.compareTo(v)<0&&(h.applyToRemoteDocument(p,u),p.isValidDocument()&&c.addEntry(p,u.commitVersion))})}),l.next(function(){return s._n.removeMutationBatch(a,h)})}(n,r,t,o).next(function(){return o.apply(r)}).next(function(){return n._n.performConsistencyCheck(r)}).next(function(){return n.Mn.pn(r,i)})})}function qh(e){var t=T(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",function(n){return t.qe.getLastRemoteSnapshotVersion(n)})}function wv(e,t){var n=T(e),r=t.snapshotVersion,i=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var s=n.On.newChangeBuffer({trackRemovals:!0});i=n.kn;var a=[];t.targetChanges.forEach(function(h,f){var l=i.get(f);if(l){a.push(n.qe.removeMatchingKeys(o,h.removedDocuments,f).next(function(){return n.qe.addMatchingKeys(o,h.addedDocuments,f)}));var d=h.resumeToken;if(d.approximateByteSize()>0){var p=l.withResumeToken(d,r).withSequenceNumber(o.currentSequenceNumber);i=i.insert(f,p),function(v,w,E){return O(w.resumeToken.approximateByteSize()>0),v.resumeToken.approximateByteSize()===0||w.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8||E.addedDocuments.size+E.modifiedDocuments.size+E.removedDocuments.size>0}(l,p,h)&&a.push(n.qe.updateTargetData(o,p))}}});var u=Lt();if(t.documentUpdates.forEach(function(h,f){t.resolvedLimboDocuments.has(h)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(o,h))}),a.push(Bh(o,s,t.documentUpdates,r,void 0).next(function(h){u=h})),!r.isEqual(P.min())){var c=n.qe.getLastRemoteSnapshotVersion(o).next(function(h){return n.qe.setTargetsMetadata(o,o.currentSequenceNumber,r)});a.push(c)}return _.waitFor(a).next(function(){return s.apply(o)}).next(function(){return n.Mn.En(o,u)}).next(function(){return u})}).then(function(o){return n.kn=i,o})}function Bh(e,t,n,r,i){var o=B();return n.forEach(function(s){return o=o.add(s)}),t.getEntries(e,o).next(function(s){var a=Lt();return n.forEach(function(u,c){var h=s.get(u),f=(i==null?void 0:i.get(u))||r;c.isNoDocument()&&c.version.isEqual(P.min())?(t.removeEntry(u,f),a=a.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(t.addEntry(c,f),a=a.insert(u,c)):I("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),a})}function bv(e,t){var n=T(e);return n.persistence.runTransaction("Get next mutation batch","readonly",function(r){return t===void 0&&(t=-1),n._n.getNextMutationBatchAfterBatchId(r,t)})}function gn(e,t){var n=T(e);return n.persistence.runTransaction("Allocate target","readwrite",function(r){var i;return n.qe.getTargetData(r,t).next(function(o){return o?(i=o,_.resolve(i)):n.qe.allocateTargetId(r).next(function(s){return i=new _i(t,s,0,r.currentSequenceNumber),n.qe.addTargetData(r,i).next(function(){return i})})})}).then(function(r){var i=n.kn.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.kn=n.kn.insert(r.targetId,r),n.Fn.set(t,r.targetId)),r})}function mn(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s;return g(this,function(a){switch(a.label){case 0:r=T(e),i=r.kn.get(t),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(u){return r.persistence.referenceDelegate.removeTarget(u,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!Re(s=a.sent()))throw s;return I("LocalStore","Failed to update sequence numbers for target "+t+": "+s),[3,5];case 5:return r.kn=r.kn.remove(t),r.Fn.delete(i.target),[2]}})})}function Di(e,t,n){var r=T(e),i=P.min(),o=B();return r.persistence.runTransaction("Execute query","readonly",function(s){return function(a,u,c){var h=T(a),f=h.Fn.get(c);return f!==void 0?_.resolve(h.kn.get(f)):h.qe.getTargetData(u,c)}(r,s,Pt(t)).next(function(a){if(a)return i=a.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(s,a.targetId).next(function(u){o=u})}).next(function(){return r.xn.getDocumentsMatchingQuery(s,t,n?i:P.min(),n?o:B())}).next(function(a){return{documents:a,Bn:o}})})}function Kh(e,t){var n=T(e),r=T(n.qe),i=n.kn.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(o){return r.lt(o,t).next(function(s){return s?s.target:null})})}function zh(e){var t=T(e);return t.persistence.runTransaction("Get new document changes","readonly",function(n){return function(r,i,o){var s=T(r),a=Lt(),u=vs(o),c=ue(i),h=IDBKeyRange.lowerBound(u,!0);return c.$t({index:Q.readTimeIndex,range:h},function(f,l){var d=ps(s.R,l);a=a.insert(d.key,d),u=l.readTime}).next(function(){return{wn:a,readTime:Ih(u)}})}(t.On,n,t.$n)}).then(function(n){var r=n.wn,i=n.readTime;return t.$n=i,r})}function _v(e){return m(this,void 0,void 0,function(){var t;return g(this,function(n){return[2,(t=T(e)).persistence.runTransaction("Synchronize last document change read time","readonly",function(r){return function(i){var o=ue(i),s=P.min();return o.$t({index:Q.readTimeIndex,reverse:!0},function(a,u,c){u.readTime&&(s=Ih(u.readTime)),c.done()}).next(function(){return s})}(r)}).then(function(r){t.$n=r})]})})}function Ev(e,t,n,r){return m(this,void 0,void 0,function(){var i,o,s,a,u,c,h,f,l,d;return g(this,function(p){switch(p.label){case 0:for(i=T(e),o=B(),s=Lt(),a=Yc(),u=0,c=n;u<c.length;u++)h=c[u],f=t.qn(h.metadata.name),h.document&&(o=o.add(f)),s=s.insert(f,t.Un(h)),a=a.insert(f,t.Kn(h.metadata.readTime));return l=i.On.newChangeBuffer({trackRemovals:!0}),[4,gn(i,function(v){return Pt(en(U.fromString("__bundle__/docs/"+v)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(v){return Bh(v,l,s,P.min(),a).next(function(w){return l.apply(v),w}).next(function(w){return i.qe.removeMatchingKeysForTargetId(v,d.targetId).next(function(){return i.qe.addMatchingKeys(v,o,d.targetId)}).next(function(){return i.Mn.En(v,w)}).next(function(){return w})})})]}})})}function Iv(e,t,n){return n===void 0&&(n=B()),m(this,void 0,void 0,function(){var r,i;return g(this,function(o){switch(o.label){case 0:return[4,gn(e,Pt(ys(t.bundledQuery)))];case 1:return r=o.sent(),[2,(i=T(e)).persistence.runTransaction("Save named query","readwrite",function(s){var a=ut(t.readTime);if(r.snapshotVersion.compareTo(a)>=0)return i.Ke.saveNamedQuery(s,t);var u=r.withResumeToken(Et.EMPTY_BYTE_STRING,a);return i.kn=i.kn.insert(u.targetId,u),i.qe.updateTargetData(s,u).next(function(){return i.qe.removeMatchingKeysForTargetId(s,r.targetId)}).next(function(){return i.qe.addMatchingKeys(s,n,r.targetId)}).next(function(){return i.Ke.saveNamedQuery(s,t)})})]}})})}var Tv=function(){function e(t){this.R=t,this.Qn=new Map,this.jn=new Map}return e.prototype.getBundleMetadata=function(t,n){return _.resolve(this.Qn.get(n))},e.prototype.saveBundleMetadata=function(t,n){var r;return this.Qn.set(n.id,{id:(r=n).id,version:r.version,createTime:ut(r.createTime)}),_.resolve()},e.prototype.getNamedQuery=function(t,n){return _.resolve(this.jn.get(n))},e.prototype.saveNamedQuery=function(t,n){return this.jn.set(n.name,function(r){return{name:r.name,query:ys(r.bundledQuery),readTime:ut(r.readTime)}}(n)),_.resolve()},e}(),bs=function(){function e(){this.Wn=new tt(nt.Gn),this.zn=new tt(nt.Hn)}return e.prototype.isEmpty=function(){return this.Wn.isEmpty()},e.prototype.addReference=function(t,n){var r=new nt(t,n);this.Wn=this.Wn.add(r),this.zn=this.zn.add(r)},e.prototype.Jn=function(t,n){var r=this;t.forEach(function(i){return r.addReference(i,n)})},e.prototype.removeReference=function(t,n){this.Yn(new nt(t,n))},e.prototype.Xn=function(t,n){var r=this;t.forEach(function(i){return r.removeReference(i,n)})},e.prototype.Zn=function(t){var n=this,r=new C(new U([])),i=new nt(r,t),o=new nt(r,t+1),s=[];return this.zn.forEachInRange([i,o],function(a){n.Yn(a),s.push(a.key)}),s},e.prototype.ts=function(){var t=this;this.Wn.forEach(function(n){return t.Yn(n)})},e.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},e.prototype.es=function(t){var n=new C(new U([])),r=new nt(n,t),i=new nt(n,t+1),o=B();return this.zn.forEachInRange([r,i],function(s){o=o.add(s.key)}),o},e.prototype.containsKey=function(t){var n=new nt(t,0),r=this.Wn.firstAfterOrEqual(n);return r!==null&&t.isEqual(r.key)},e}(),nt=function(){function e(t,n){this.key=t,this.ns=n}return e.Gn=function(t,n){return C.comparator(t.key,n.key)||L(t.ns,n.ns)},e.Hn=function(t,n){return L(t.ns,n.ns)||C.comparator(t.key,n.key)},e}(),Sv=function(){function e(t,n){this.Ut=t,this.referenceDelegate=n,this._n=[],this.ss=1,this.rs=new tt(nt.Gn)}return e.prototype.checkEmpty=function(t){return _.resolve(this._n.length===0)},e.prototype.addMutationBatch=function(t,n,r,i){var o=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var s=new ds(o,n,r,i);this._n.push(s);for(var a=0,u=i;a<u.length;a++){var c=u[a];this.rs=this.rs.add(new nt(c.key,o)),this.Ut.addToCollectionParentIndex(t,c.key.path.popLast())}return _.resolve(s)},e.prototype.lookupMutationBatch=function(t,n){return _.resolve(this.os(n))},e.prototype.getNextMutationBatchAfterBatchId=function(t,n){var r=n+1,i=this.cs(r),o=i<0?0:i;return _.resolve(this._n.length>o?this._n[o]:null)},e.prototype.getHighestUnacknowledgedBatchId=function(){return _.resolve(this._n.length===0?-1:this.ss-1)},e.prototype.getAllMutationBatches=function(t){return _.resolve(this._n.slice())},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,i=new nt(n,0),o=new nt(n,Number.POSITIVE_INFINITY),s=[];return this.rs.forEachInRange([i,o],function(a){var u=r.os(a.ns);s.push(u)}),_.resolve(s)},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,n){var r=this,i=new tt(L);return n.forEach(function(o){var s=new nt(o,0),a=new nt(o,Number.POSITIVE_INFINITY);r.rs.forEachInRange([s,a],function(u){i=i.add(u.ns)})}),_.resolve(this.us(i))},e.prototype.getAllMutationBatchesAffectingQuery=function(t,n){var r=n.path,i=r.length+1,o=r;C.isDocumentKey(o)||(o=o.child(""));var s=new nt(new C(o),0),a=new tt(L);return this.rs.forEachWhile(function(u){var c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.ns)),!0)},s),_.resolve(this.us(a))},e.prototype.us=function(t){var n=this,r=[];return t.forEach(function(i){var o=n.os(i);o!==null&&r.push(o)}),r},e.prototype.removeMutationBatch=function(t,n){var r=this;O(this.hs(n.batchId,"removed")===0),this._n.shift();var i=this.rs;return _.forEach(n.mutations,function(o){var s=new nt(o.key,n.batchId);return i=i.delete(s),r.referenceDelegate.markPotentiallyOrphaned(t,o.key)}).next(function(){r.rs=i})},e.prototype.Gt=function(t){},e.prototype.containsKey=function(t,n){var r=new nt(n,0),i=this.rs.firstAfterOrEqual(r);return _.resolve(n.isEqual(i&&i.key))},e.prototype.performConsistencyCheck=function(t){return this._n.length,_.resolve()},e.prototype.hs=function(t,n){return this.cs(t)},e.prototype.cs=function(t){return this._n.length===0?0:t-this._n[0].batchId},e.prototype.os=function(t){var n=this.cs(t);return n<0||n>=this._n.length?null:this._n[n]},e}(),Av=function(){function e(t,n){this.Ut=t,this.ls=n,this.docs=new pt(C.comparator),this.size=0}return e.prototype.addEntry=function(t,n,r){var i=n.key,o=this.docs.get(i),s=o?o.size:0,a=this.ls(n);return this.docs=this.docs.insert(i,{document:n.clone(),size:a,readTime:r}),this.size+=a-s,this.Ut.addToCollectionParentIndex(t,i.path.popLast())},e.prototype.removeEntry=function(t){var n=this.docs.get(t);n&&(this.docs=this.docs.remove(t),this.size-=n.size)},e.prototype.getEntry=function(t,n){var r=this.docs.get(n);return _.resolve(r?r.document.clone():at.newInvalidDocument(n))},e.prototype.getEntries=function(t,n){var r=this,i=Lt();return n.forEach(function(o){var s=r.docs.get(o);i=i.insert(o,s?s.document.clone():at.newInvalidDocument(o))}),_.resolve(i)},e.prototype.getDocumentsMatchingQuery=function(t,n,r){for(var i=Lt(),o=new C(n.path.child("")),s=this.docs.getIteratorFrom(o);s.hasNext();){var a=s.getNext(),u=a.key,c=a.value,h=c.document,f=c.readTime;if(!n.path.isPrefixOf(u.path))break;f.compareTo(r)<=0||nr(n,h)&&(i=i.insert(h.key,h.clone()))}return _.resolve(i)},e.prototype.fs=function(t,n){return _.forEach(this.docs,function(r){return n(r)})},e.prototype.newChangeBuffer=function(t){return new Dv(this)},e.prototype.getSize=function(t){return _.resolve(this.size)},e}(),Dv=function(e){function t(n){var r=this;return(r=e.call(this)||this).Ie=n,r}return R(t,e),t.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach(function(o,s){s.document.isValidDocument()?i.push(r.Ie.addEntry(n,s.document,r.getReadTime(o))):r.Ie.removeEntry(o)}),_.waitFor(i)},t.prototype.getFromCache=function(n,r){return this.Ie.getEntry(n,r)},t.prototype.getAllFromCache=function(n,r){return this.Ie.getEntries(n,r)},t}(Ph),Nv=function(){function e(t){this.persistence=t,this.ds=new yn(function(n){return Zn(n)},ci),this.lastRemoteSnapshotVersion=P.min(),this.highestTargetId=0,this.ws=0,this._s=new bs,this.targetCount=0,this.ys=Ii.Jt()}return e.prototype.forEachTarget=function(t,n){return this.ds.forEach(function(r,i){return n(i)}),_.resolve()},e.prototype.getLastRemoteSnapshotVersion=function(t){return _.resolve(this.lastRemoteSnapshotVersion)},e.prototype.getHighestSequenceNumber=function(t){return _.resolve(this.ws)},e.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),_.resolve(this.highestTargetId)},e.prototype.setTargetsMetadata=function(t,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.ws&&(this.ws=n),_.resolve()},e.prototype.te=function(t){this.ds.set(t.target,t);var n=t.targetId;n>this.highestTargetId&&(this.ys=new Ii(n),this.highestTargetId=n),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},e.prototype.addTargetData=function(t,n){return this.te(n),this.targetCount+=1,_.resolve()},e.prototype.updateTargetData=function(t,n){return this.te(n),_.resolve()},e.prototype.removeTargetData=function(t,n){return this.ds.delete(n.target),this._s.Zn(n.targetId),this.targetCount-=1,_.resolve()},e.prototype.removeTargets=function(t,n,r){var i=this,o=0,s=[];return this.ds.forEach(function(a,u){u.sequenceNumber<=n&&r.get(u.targetId)===null&&(i.ds.delete(a),s.push(i.removeMatchingKeysForTargetId(t,u.targetId)),o++)}),_.waitFor(s).next(function(){return o})},e.prototype.getTargetCount=function(t){return _.resolve(this.targetCount)},e.prototype.getTargetData=function(t,n){var r=this.ds.get(n)||null;return _.resolve(r)},e.prototype.addMatchingKeys=function(t,n,r){return this._s.Jn(n,r),_.resolve()},e.prototype.removeMatchingKeys=function(t,n,r){this._s.Xn(n,r);var i=this.persistence.referenceDelegate,o=[];return i&&n.forEach(function(s){o.push(i.markPotentiallyOrphaned(t,s))}),_.waitFor(o)},e.prototype.removeMatchingKeysForTargetId=function(t,n){return this._s.Zn(n),_.resolve()},e.prototype.getMatchingKeysForTargetId=function(t,n){var r=this._s.es(n);return _.resolve(r)},e.prototype.containsKey=function(t,n){return _.resolve(this._s.containsKey(n))},e}(),Cv=function(){function e(t,n){var r=this;this.gs={},this.Ne=new Dt(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new Nv(this),this.Ut=new rv,this.Ue=function(i,o){return new Av(i,function(s){return r.referenceDelegate.ps(s)})}(this.Ut),this.R=new _h(n),this.Ke=new Tv(this.R)}return e.prototype.start=function(){return Promise.resolve()},e.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.setDatabaseDeletedListener=function(){},e.prototype.setNetworkEnabled=function(){},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getMutationQueue=function(t){var n=this.gs[t.toKey()];return n||(n=new Sv(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=n),n},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getBundleCache=function(){return this.Ke},e.prototype.runTransaction=function(t,n,r){var i=this;I("MemoryPersistence","Starting transaction:",t);var o=new Rv(this.Ne.next());return this.referenceDelegate.Es(),r(o).next(function(s){return i.referenceDelegate.Ts(o).next(function(){return s})}).toPromise().then(function(s){return o.raiseOnCommittedEvent(),s})},e.prototype.Is=function(t,n){return _.or(Object.values(this.gs).map(function(r){return function(){return r.containsKey(t,n)}}))},e}(),Rv=function(e){function t(n){var r=this;return(r=e.call(this)||this).currentSequenceNumber=n,r}return R(t,e),t}(gh),Ov=function(){function e(t){this.persistence=t,this.As=new bs,this.Rs=null}return e.bs=function(t){return new e(t)},Object.defineProperty(e.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw N()},enumerable:!1,configurable:!0}),e.prototype.addReference=function(t,n,r){return this.As.addReference(r,n),this.vs.delete(r.toString()),_.resolve()},e.prototype.removeReference=function(t,n,r){return this.As.removeReference(r,n),this.vs.add(r.toString()),_.resolve()},e.prototype.markPotentiallyOrphaned=function(t,n){return this.vs.add(n.toString()),_.resolve()},e.prototype.removeTarget=function(t,n){var r=this;this.As.Zn(n.targetId).forEach(function(o){return r.vs.add(o.toString())});var i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,n.targetId).next(function(o){o.forEach(function(s){return r.vs.add(s.toString())})}).next(function(){return i.removeTargetData(t,n)})},e.prototype.Es=function(){this.Rs=new Set},e.prototype.Ts=function(t){var n=this,r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _.forEach(this.vs,function(i){var o=C.fromPath(i);return n.Ps(t,o).next(function(s){s||r.removeEntry(o)})}).next(function(){return n.Rs=null,r.apply(t)})},e.prototype.updateLimboDocument=function(t,n){var r=this;return this.Ps(t,n).next(function(i){i?r.vs.delete(n.toString()):r.vs.add(n.toString())})},e.prototype.ps=function(t){return 0},e.prototype.Ps=function(t,n){var r=this;return _.or([function(){return _.resolve(r.As.containsKey(n))},function(){return r.persistence.getTargetCache().containsKey(t,n)},function(){return r.persistence.Is(t,n)}])},e}(),ht=function(){function e(t){this.uid=t}return e.prototype.isAuthenticated=function(){return this.uid!=null},e.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},e.prototype.isEqual=function(t){return t.uid===this.uid},e}();function Gh(e,t){return"firestore_clients_"+e+"_"+t}function Hh(e,t,n){var r="firestore_mutations_"+e+"_"+n;return t.isAuthenticated()&&(r+="_"+t.uid),r}function _s(e,t){return"firestore_targets_"+e+"_"+t}ht.UNAUTHENTICATED=new ht(null),ht.GOOGLE_CREDENTIALS=new ht("google-credentials-uid"),ht.FIRST_PARTY=new ht("first-party-uid"),ht.MOCK_USER=new ht("mock-user");var Qh=function(){function e(t,n,r,i){this.user=t,this.batchId=n,this.state=r,this.error=i}return e.Vs=function(t,n,r){var i,o=JSON.parse(r),s=typeof o=="object"&&["pending","acknowledged","rejected"].indexOf(o.state)!==-1&&(o.error===void 0||typeof o.error=="object");return s&&o.error&&(s=typeof o.error.message=="string"&&typeof o.error.code=="string")&&(i=new b(o.error.code,o.error.message)),s?new e(t,n,o.state,i):(X("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e}(),Es=function(){function e(t,n,r){this.targetId=t,this.state=n,this.error=r}return e.Vs=function(t,n){var r,i=JSON.parse(n),o=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string")&&(r=new b(i.error.code,i.error.message)),o?new e(t,i.state,r):(X("SharedClientState","Failed to parse target state for ID '"+t+"': "+n),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e}(),Wh=function(){function e(t,n){this.clientId=t,this.activeTargetIds=n}return e.Vs=function(t,n){for(var r=JSON.parse(n),i=typeof r=="object"&&r.activeTargetIds instanceof Array,o=mi(),s=0;i&&s<r.activeTargetIds.length;++s)i=bc(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new e(t,o):(X("SharedClientState","Failed to parse client data for instance '"+t+"': "+n),null)},e}(),xv=function(){function e(t,n){this.clientId=t,this.onlineState=n}return e.Vs=function(t){var n=JSON.parse(t);return typeof n=="object"&&["Unknown","Online","Offline"].indexOf(n.onlineState)!==-1&&typeof n.clientId=="string"?new e(n.clientId,n.onlineState):(X("SharedClientState","Failed to parse online state: "+t),null)},e}(),Is=function(){function e(){this.activeTargetIds=mi()}return e.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},e.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},e.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},e}(),Ts=function(){function e(t,n,r,i,o){this.window=t,this.Se=n,this.persistenceKey=r,this.Ns=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new pt(L),this.started=!1,this.$s=[];var s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=o,this.Os=Gh(this.persistenceKey,this.Ns),this.Ms=function(a){return"firestore_sequence_number_"+a}(this.persistenceKey),this.Fs=this.Fs.insert(this.Ns,new Is),this.Ls=new RegExp("^firestore_clients_"+s+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+s+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+s+"_(\\d+)$"),this.Us=function(a){return"firestore_online_state_"+a}(this.persistenceKey),this.Ks=function(a){return"firestore_bundle_loaded_"+a}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return e.yt=function(t){return!(!t||!t.localStorage)},e.prototype.start=function(){return m(this,void 0,void 0,function(){var t,n,r,i,o,s,a,u,c,h,f,l=this;return g(this,function(d){switch(d.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=d.sent(),n=0,r=t;n<r.length;n++)(i=r[n])!==this.Ns&&(o=this.getItem(Gh(this.persistenceKey,i)))&&(s=Wh.Vs(i,o))&&(this.Fs=this.Fs.insert(s.clientId,s));for(this.Qs(),(a=this.storage.getItem(this.Us))&&(u=this.js(a))&&this.Ws(u),c=0,h=this.$s;c<h.length;c++)f=h[c],this.ks(f);return this.$s=[],this.window.addEventListener("pagehide",function(){return l.shutdown()}),this.started=!0,[2]}})})},e.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},e.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},e.prototype.isActiveQueryTarget=function(t){var n=!1;return this.Fs.forEach(function(r,i){i.activeTargetIds.has(t)&&(n=!0)}),n},e.prototype.addPendingMutation=function(t){this.zs(t,"pending")},e.prototype.updateMutationState=function(t,n,r){this.zs(t,n,r),this.Hs(t)},e.prototype.addLocalQueryTarget=function(t){var n="not-current";if(this.isActiveQueryTarget(t)){var r=this.storage.getItem(_s(this.persistenceKey,t));if(r){var i=Es.Vs(t,r);i&&(n=i.state)}}return this.Js.Ds(t),this.Qs(),n},e.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},e.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){this.removeItem(_s(this.persistenceKey,t))},e.prototype.updateQueryState=function(t,n,r){this.Ys(t,n,r)},e.prototype.handleUserChange=function(t,n,r){var i=this;n.forEach(function(o){i.Hs(o)}),this.currentUser=t,r.forEach(function(o){i.addPendingMutation(o)})},e.prototype.setOnlineState=function(t){this.Xs(t)},e.prototype.notifyBundleLoaded=function(){this.Zs()},e.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},e.prototype.getItem=function(t){var n=this.storage.getItem(t);return I("SharedClientState","READ",t,n),n},e.prototype.setItem=function(t,n){I("SharedClientState","SET",t,n),this.storage.setItem(t,n)},e.prototype.removeItem=function(t){I("SharedClientState","REMOVE",t),this.storage.removeItem(t)},e.prototype.ks=function(t){var n=this,r=t;if(r.storageArea===this.storage){if(I("SharedClientState","EVENT",r.key,r.newValue),r.key===this.Os)return void X("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return m(n,void 0,void 0,function(){var i,o,s,a,u,c;return g(this,function(h){if(this.started){if(r.key!==null){if(this.Ls.test(r.key)){if(r.newValue==null)return i=this.ti(r.key),[2,this.ei(i,null)];if(o=this.ni(r.key,r.newValue))return[2,this.ei(o.clientId,o)]}else if(this.Bs.test(r.key)){if(r.newValue!==null&&(s=this.si(r.key,r.newValue)))return[2,this.ii(s)]}else if(this.qs.test(r.key)){if(r.newValue!==null&&(a=this.ri(r.key,r.newValue)))return[2,this.oi(a)]}else if(r.key===this.Us){if(r.newValue!==null&&(u=this.js(r.newValue)))return[2,this.Ws(u)]}else if(r.key===this.Ms)(c=function(f){var l=Dt.o;if(f!=null)try{var d=JSON.parse(f);O(typeof d=="number"),l=d}catch(p){X("SharedClientState","Failed to read sequence number from WebStorage",p)}return l}(r.newValue))!==Dt.o&&this.sequenceNumberHandler(c);else if(r.key===this.Ks)return[2,this.syncEngine.ci()]}}else this.$s.push(r);return[2]})})})}},Object.defineProperty(e.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),e.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},e.prototype.zs=function(t,n,r){var i=new Qh(this.currentUser,t,n,r),o=Hh(this.persistenceKey,this.currentUser,t);this.setItem(o,i.Ss())},e.prototype.Hs=function(t){var n=Hh(this.persistenceKey,this.currentUser,t);this.removeItem(n)},e.prototype.Xs=function(t){var n={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(n))},e.prototype.Ys=function(t,n,r){var i=_s(this.persistenceKey,t),o=new Es(t,n,r);this.setItem(i,o.Ss())},e.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},e.prototype.ti=function(t){var n=this.Ls.exec(t);return n?n[1]:null},e.prototype.ni=function(t,n){var r=this.ti(t);return Wh.Vs(r,n)},e.prototype.si=function(t,n){var r=this.Bs.exec(t),i=Number(r[1]),o=r[2]!==void 0?r[2]:null;return Qh.Vs(new ht(o),i,n)},e.prototype.ri=function(t,n){var r=this.qs.exec(t),i=Number(r[1]);return Es.Vs(i,n)},e.prototype.js=function(t){return xv.Vs(t)},e.prototype.ii=function(t){return m(this,void 0,void 0,function(){return g(this,function(n){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(I("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},e.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},e.prototype.ei=function(t,n){var r=this,i=n?this.Fs.insert(t,n):this.Fs.remove(t),o=this.Gs(this.Fs),s=this.Gs(i),a=[],u=[];return s.forEach(function(c){o.has(c)||a.push(c)}),o.forEach(function(c){s.has(c)||u.push(c)}),this.syncEngine.hi(a,u).then(function(){r.Fs=i})},e.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},e.prototype.Gs=function(t){var n=mi();return t.forEach(function(r,i){n=n.unionWith(i.activeTargetIds)}),n},e}(),Yh=function(){function e(){this.li=new Is,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return e.prototype.addPendingMutation=function(t){},e.prototype.updateMutationState=function(t,n,r){},e.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},e.prototype.updateQueryState=function(t,n,r){this.fi[t]=n},e.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},e.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){delete this.fi[t]},e.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},e.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.start=function(){return this.li=new Is,Promise.resolve()},e.prototype.handleUserChange=function(t,n,r){},e.prototype.setOnlineState=function(t){},e.prototype.shutdown=function(){},e.prototype.writeSequenceNumber=function(t){},e.prototype.notifyBundleLoaded=function(){},e}(),kv=function(){function e(){}return e.prototype.di=function(t){},e.prototype.shutdown=function(){},e}(),Xh=function(){function e(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return e.prototype.di=function(t){this.gi.push(t)},e.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},e.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},e.prototype._i=function(){I("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,n=this.gi;t<n.length;t++)(0,n[t])(0)},e.prototype.yi=function(){I("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,n=this.gi;t<n.length;t++)(0,n[t])(1)},e.yt=function(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0},e}(),Pv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Lv=function(){function e(t){this.Ei=t.Ei,this.Ti=t.Ti}return e.prototype.Ii=function(t){this.Ai=t},e.prototype.Ri=function(t){this.bi=t},e.prototype.onMessage=function(t){this.vi=t},e.prototype.close=function(){this.Ti()},e.prototype.send=function(t){this.Ei(t)},e.prototype.Pi=function(){this.Ai()},e.prototype.Vi=function(t){this.bi(t)},e.prototype.Si=function(t){this.vi(t)},e}(),Mv=function(e){function t(n){var r=this;return(r=e.call(this,n)||this).forceLongPolling=n.forceLongPolling,r.autoDetectLongPolling=n.autoDetectLongPolling,r.useFetchStreams=n.useFetchStreams,r}return R(t,e),t.prototype.Fi=function(n,r,i,o){return new Promise(function(s,a){var u=new dc;u.listenOnce(hc.COMPLETE,function(){try{switch(u.getLastErrorCode()){case ii.NO_ERROR:var h=u.getResponseJson();I("Connection","XHR received:",JSON.stringify(h)),s(h);break;case ii.TIMEOUT:I("Connection",'RPC "'+n+'" timed out'),a(new b(y.DEADLINE_EXCEEDED,"Request time out"));break;case ii.HTTP_ERROR:var f=u.getStatus();if(I("Connection",'RPC "'+n+'" failed with status:',f,"response text:",u.getResponseText()),f>0){var l=u.getResponseJson().error;if(l&&l.status&&l.message){var d=function(p){var v=p.toLowerCase().replace(/_/g,"-");return Object.values(y).indexOf(v)>=0?v:y.UNKNOWN}(l.status);a(new b(d,l.message))}else a(new b(y.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new b(y.UNAVAILABLE,"Connection failed."));break;default:N()}}finally{I("Connection",'RPC "'+n+'" completed.')}});var c=JSON.stringify(o);u.send(r,"POST",c,i,15)})},t.prototype.Oi=function(n,r){var i=[this.Di,"/","google.firestore.v1.Firestore","/",n,"/channel"],o=uc(),s=cc(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new fc({})),this.ki(a.initMessageHeaders,r),ka()||Ma()||Fa()||Va()||Ua()||La()||(a.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");I("Connection","Creating WebChannel: "+u,a);var c=o.createWebChannel(u,a),h=!1,f=!1,l=new Lv({Ei:function(p){f?I("Connection","Not sending because WebChannel is closed:",p):(h||(I("Connection","Opening WebChannel transport."),c.open(),h=!0),I("Connection","WebChannel sending:",p),c.send(p))},Ti:function(){return c.close()}}),d=function(p,v,w){p.listen(v,function(E){try{w(E)}catch(A){setTimeout(function(){throw A},0)}})};return d(c,Yn.EventType.OPEN,function(){f||I("Connection","WebChannel transport opened.")}),d(c,Yn.EventType.CLOSE,function(){f||(f=!0,I("Connection","WebChannel transport closed"),l.Vi())}),d(c,Yn.EventType.ERROR,function(p){f||(f=!0,oi("Connection","WebChannel transport errored:",p),l.Vi(new b(y.UNAVAILABLE,"The operation could not be completed")))}),d(c,Yn.EventType.MESSAGE,function(p){var v;if(!f){var w=p.data[0];O(!!w);var E=w,A=E.error||((v=E[0])===null||v===void 0?void 0:v.error);if(A){I("Connection","WebChannel received error:",A);var D=A.status,k=function(q){var rt=J[q];if(rt!==void 0)return Qc(rt)}(D),M=A.message;k===void 0&&(k=y.INTERNAL,M="Unknown error status: "+D+" with message "+A.message),f=!0,l.Vi(new b(k,M)),c.close()}else I("Connection","WebChannel received:",w),l.Si(w)}}),d(s,lc.STAT_EVENT,function(p){p.stat===Qo.PROXY?I("Connection","Detected buffering proxy"):p.stat===Qo.NOPROXY&&I("Connection","Detected no buffering proxy")}),setTimeout(function(){l.Pi()},0),l},t}(function(){function e(t){this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.Di=n+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return e.prototype.Ni=function(t,n,r,i){var o=this.xi(t,n);I("RestConnection","Sending: ",o,r);var s={};return this.ki(s,i),this.Fi(t,o,s,r).then(function(a){return I("RestConnection","Received: ",a),a},function(a){throw oi("RestConnection",t+" failed with error: ",a,"url: ",o,"request:",r),a})},e.prototype.$i=function(t,n,r,i){return this.Ni(t,n,r,i)},e.prototype.ki=function(t,n){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n)for(var r in n.authHeaders)n.authHeaders.hasOwnProperty(r)&&(t[r]=n.authHeaders[r])},e.prototype.xi=function(t,n){var r=Pv[t];return this.Di+"/v1/"+n+":"+r},e}());function $h(){return typeof window!="undefined"?window:null}function Ni(){return typeof document!="undefined"?document:null}function Ci(e){return new qp(e,!0)}var Ss=function(){function e(t,n,r,i,o){r===void 0&&(r=1e3),i===void 0&&(i=1.5),o===void 0&&(o=6e4),this.Se=t,this.timerId=n,this.Mi=r,this.Li=i,this.Bi=o,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return e.prototype.reset=function(){this.qi=0},e.prototype.Qi=function(){this.qi=this.Bi},e.prototype.ji=function(t){var n=this;this.cancel();var r=Math.floor(this.qi+this.Wi()),i=Math.max(0,Date.now()-this.Ki),o=Math.max(0,r-i);o>0&&I("ExponentialBackoff","Backing off for "+o+" ms (base delay: "+this.qi+" ms, delay with jitter: "+r+" ms, last attempt: "+i+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,o,function(){return n.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},e.prototype.Gi=function(){this.Ui!==null&&(this.Ui.skipDelay(),this.Ui=null)},e.prototype.cancel=function(){this.Ui!==null&&(this.Ui.cancel(),this.Ui=null)},e.prototype.Wi=function(){return(Math.random()-.5)*this.qi},e}(),Jh=function(){function e(t,n,r,i,o,s){this.Se=t,this.zi=r,this.Hi=i,this.Ji=o,this.listener=s,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Ss(t,n)}return e.prototype.tr=function(){return this.state===1||this.state===2||this.state===4},e.prototype.er=function(){return this.state===2},e.prototype.start=function(){this.state!==3?this.auth():this.nr()},e.prototype.stop=function(){return m(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},e.prototype.sr=function(){this.state=0,this.Zi.reset()},e.prototype.ir=function(){var t=this;this.er()&&this.Xi===null&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},e.prototype.cr=function(t){this.ur(),this.stream.send(t)},e.prototype.rr=function(){return m(this,void 0,void 0,function(){return g(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},e.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},e.prototype.close=function(t,n){return m(this,void 0,void 0,function(){return g(this,function(r){switch(r.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,t!==3?this.Zi.reset():n&&n.code===y.RESOURCE_EXHAUSTED?(X(n.toString()),X("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):n&&n.code===y.UNAUTHENTICATED&&this.Ji.invalidateToken(),this.stream!==null&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(n)];case 1:return r.sent(),[2]}})})},e.prototype.ar=function(){},e.prototype.auth=function(){var t=this;this.state=1;var n=this.hr(this.Yi),r=this.Yi;this.Ji.getToken().then(function(i){t.Yi===r&&t.lr(i)},function(i){n(function(){var o=new b(y.UNKNOWN,"Fetching auth token failed: "+i.message);return t.dr(o)})})},e.prototype.lr=function(t){var n=this,r=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){r(function(){return n.state=2,n.listener.Ii()})}),this.stream.Ri(function(i){r(function(){return n.dr(i)})}),this.stream.onMessage(function(i){r(function(){return n.onMessage(i)})})},e.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return m(t,void 0,void 0,function(){return g(this,function(n){return this.state=0,this.start(),[2]})})})},e.prototype.dr=function(t){return I("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},e.prototype.hr=function(t){var n=this;return function(r){n.Se.enqueueAndForget(function(){return n.Yi===t?r():(I("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},e}(),Fv=function(e){function t(n,r,i,o,s){var a=this;return(a=e.call(this,n,"listen_stream_connection_backoff","listen_stream_idle",r,i,s)||this).R=o,a}return R(t,e),t.prototype.wr=function(n){return this.Hi.Oi("Listen",n)},t.prototype.onMessage=function(n){this.Zi.reset();var r=function(o,s){var a;if("targetChange"in s){s.targetChange;var u=function(w){return w==="NO_CHANGE"?0:w==="ADD"?1:w==="REMOVE"?2:w==="CURRENT"?3:w==="RESET"?4:N()}(s.targetChange.targetChangeType||"NO_CHANGE"),c=s.targetChange.targetIds||[],h=function(w,E){return w.I?(O(E===void 0||typeof E=="string"),Et.fromBase64String(E||"")):(O(E===void 0||E instanceof Uint8Array),Et.fromUint8Array(E||new Uint8Array))}(o,s.targetChange.resumeToken),f=(l=s.targetChange.cause)&&function(w){var E=w.code===void 0?y.UNKNOWN:Qc(w.code);return new b(E,w.message||"")}(l);a=new $c(u,c,h,f||null)}else if("documentChange"in s){s.documentChange,(u=s.documentChange).document,u.document.name,u.document.updateTime,c=Bt(o,u.document.name),h=ut(u.document.updateTime);var l=new Nt({mapValue:{fields:u.document.fields}}),d=(f=at.newFoundDocument(c,h,l),u.targetIds||[]),p=u.removedTargetIds||[];a=new wi(d,p,f.key,f)}else if("documentDelete"in s)s.documentDelete,(u=s.documentDelete).document,c=Bt(o,u.document),h=u.readTime?ut(u.readTime):P.min(),l=at.newNoDocument(c,h),f=u.removedTargetIds||[],a=new wi([],f,l.key,l);else if("documentRemove"in s)s.documentRemove,(u=s.documentRemove).document,c=Bt(o,u.document),h=u.removedTargetIds||[],a=new wi([],h,c,null);else{if(!("filter"in s))return N();s.filter;var v=s.filter;v.targetId,u=v.count||0,c=new xp(u),h=v.targetId,a=new Xc(h,c)}return a}(this.R,n),i=function(o){if(!("targetChange"in o))return P.min();var s=o.targetChange;return s.targetIds&&s.targetIds.length?P.min():s.readTime?ut(s.readTime):P.min()}(n);return this.listener._r(r,i)},t.prototype.mr=function(n){var r={};r.database=ur(this.R),r.addTarget=function(o,s){var a,u=s.target;return(a=hi(u)?{documents:uh(o,u)}:{query:ch(o,u)}).targetId=s.targetId,s.resumeToken.approximateByteSize()>0?a.resumeToken=eh(o,s.resumeToken):s.snapshotVersion.compareTo(P.min())>0&&(a.readTime=sr(o,s.snapshotVersion.toTimestamp())),a}(this.R,n);var i=function(o,s){var a=function(u,c){switch(c){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return N()}}(0,s.purpose);return a==null?null:{"goog-listen-tags":a}}(this.R,n);i&&(r.labels=i),this.cr(r)},t.prototype.yr=function(n){var r={};r.database=ur(this.R),r.removeTarget=n,this.cr(r)},t}(Jh),Vv=function(e){function t(n,r,i,o,s){var a=this;return(a=e.call(this,n,"write_stream_connection_backoff","write_stream_idle",r,i,s)||this).R=o,a.gr=!1,a}return R(t,e),Object.defineProperty(t.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,e.prototype.start.call(this)},t.prototype.ar=function(){this.gr&&this.Er([])},t.prototype.wr=function(n){return this.Hi.Oi("Write",n)},t.prototype.onMessage=function(n){if(O(!!n.streamToken),this.lastStreamToken=n.streamToken,this.gr){this.Zi.reset();var r=function(o,s){return o&&o.length>0?(O(s!==void 0),o.map(function(a){return function(u,c){var h=u.updateTime?ut(u.updateTime):ut(c);return h.isEqual(P.min())&&(h=ut(c)),new Cp(h,u.transformResults||[])}(a,s)})):[]}(n.writeResults,n.commitTime),i=ut(n.commitTime);return this.listener.Tr(i,r)}return O(!n.writeResults||n.writeResults.length===0),this.gr=!0,this.listener.Ir()},t.prototype.Ar=function(){var n={};n.database=ur(this.R),this.cr(n)},t.prototype.Er=function(n){var r=this,i={streamToken:this.lastStreamToken,writes:n.map(function(o){return bi(r.R,o)})};this.cr(i)},t}(Jh),Uv=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).credentials=n,o.Hi=r,o.R=i,o.Rr=!1,o}return R(t,e),t.prototype.br=function(){if(this.Rr)throw new b(y.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.Ni=function(n,r,i){var o=this;return this.br(),this.credentials.getToken().then(function(s){return o.Hi.Ni(n,r,i,s)}).catch(function(s){throw s.name==="FirebaseError"?(s.code===y.UNAUTHENTICATED&&o.credentials.invalidateToken(),s):new b(y.UNKNOWN,s.toString())})},t.prototype.$i=function(n,r,i){var o=this;return this.br(),this.credentials.getToken().then(function(s){return o.Hi.$i(n,r,i,s)}).catch(function(s){throw s.name==="FirebaseError"?(s.code===y.UNAUTHENTICATED&&o.credentials.invalidateToken(),s):new b(y.UNKNOWN,s.toString())})},t.prototype.terminate=function(){this.Rr=!0},t}(function(){}),jv=function(){function e(t,n){this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return e.prototype.Sr=function(){var t=this;this.vr===0&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},e.prototype.Nr=function(t){this.state==="Online"?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},e.prototype.set=function(t){this.kr(),this.vr=0,t==="Online"&&(this.Vr=!1),this.Dr(t)},e.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},e.prototype.Cr=function(t){var n="Could not reach Cloud Firestore backend. "+t+`
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Vr?(X(n),this.Vr=!1):I("OnlineStateTracker",n)},e.prototype.kr=function(){this.Pr!==null&&(this.Pr.cancel(),this.Pr=null)},e}(),qv=function(e,t,n,r,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(s){n.enqueueAndForget(function(){return m(o,void 0,void 0,function(){return g(this,function(a){switch(a.label){case 0:return ce(this)?(I("RemoteStore","Restarting streams for network reachability change."),[4,function(u){return m(this,void 0,void 0,function(){var c;return g(this,function(h){switch(h.label){case 0:return(c=T(u)).Or.add(4),[4,wn(c)];case 1:return h.sent(),c.Br.set("Unknown"),c.Or.delete(4),[4,fr(c)];case 2:return h.sent(),[2]}})})}(this)]):[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}})})})}),this.Br=new jv(n,r)};function fr(e){return m(this,void 0,void 0,function(){var t,n;return g(this,function(r){switch(r.label){case 0:if(!ce(e))return[3,4];t=0,n=e.Mr,r.label=1;case 1:return t<n.length?[4,(0,n[t])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function wn(e){return m(this,void 0,void 0,function(){var t,n;return g(this,function(r){switch(r.label){case 0:t=0,n=e.Mr,r.label=1;case 1:return t<n.length?[4,(0,n[t])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}function Ri(e,t){var n=T(e);n.$r.has(t.targetId)||(n.$r.set(t.targetId,t),Ns(n)?Ds(n):_n(n).er()&&As(n,t))}function dr(e,t){var n=T(e),r=_n(n);n.$r.delete(t),r.er()&&Zh(n,t),n.$r.size===0&&(r.er()?r.ir():ce(n)&&n.Br.set("Unknown"))}function As(e,t){e.qr.U(t.targetId),_n(e).mr(t)}function Zh(e,t){e.qr.U(t),_n(e).yr(t)}function Ds(e){e.qr=new Vp({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.$r.get(t)||null}}),_n(e).start(),e.Br.Sr()}function Ns(e){return ce(e)&&!_n(e).tr()&&e.$r.size>0}function ce(e){return T(e).Or.size===0}function tl(e){e.qr=void 0}function Bv(e){return m(this,void 0,void 0,function(){return g(this,function(t){return e.$r.forEach(function(n,r){As(e,n)}),[2]})})}function Kv(e,t){return m(this,void 0,void 0,function(){return g(this,function(n){return tl(e),Ns(e)?(e.Br.Nr(t),Ds(e)):e.Br.set("Unknown"),[2]})})}function zv(e,t,n){return m(this,void 0,void 0,function(){var r,i,o;return g(this,function(s){switch(s.label){case 0:if(e.Br.set("Online"),!(t instanceof $c&&t.state===2&&t.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(a,u){return m(this,void 0,void 0,function(){var c,h,f,l;return g(this,function(d){switch(d.label){case 0:c=u.cause,h=0,f=u.targetIds,d.label=1;case 1:return h<f.length?(l=f[h],a.$r.has(l)?[4,a.remoteSyncer.rejectListen(l,c)]:[3,3]):[3,5];case 2:d.sent(),a.$r.delete(l),a.qr.removeTarget(l),d.label=3;case 3:d.label=4;case 4:return h++,[3,1];case 5:return[2]}})})}(e,t)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),I("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),[4,Oi(e,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof wi?e.qr.X(t):t instanceof Xc?e.qr.rt(t):e.qr.et(t),n.isEqual(P.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,qh(e.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(a,u){var c=a.qr.ut(u);return c.targetChanges.forEach(function(h,f){if(h.resumeToken.approximateByteSize()>0){var l=a.$r.get(f);l&&a.$r.set(f,l.withResumeToken(h.resumeToken,u))}}),c.targetMismatches.forEach(function(h){var f=a.$r.get(h);if(f){a.$r.set(h,f.withResumeToken(Et.EMPTY_BYTE_STRING,f.snapshotVersion)),Zh(a,h);var l=new _i(f.target,h,1,f.sequenceNumber);As(a,l)}}),a.remoteSyncer.applyRemoteEvent(c)}(e,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return I("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,Oi(e,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function Oi(e,t,n){return m(this,void 0,void 0,function(){var r=this;return g(this,function(i){switch(i.label){case 0:if(!Re(t))throw t;return e.Or.add(1),[4,wn(e)];case 1:return i.sent(),e.Br.set("Offline"),n||(n=function(){return qh(e.localStore)}),e.asyncQueue.enqueueRetryable(function(){return m(r,void 0,void 0,function(){return g(this,function(o){switch(o.label){case 0:return I("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return o.sent(),e.Or.delete(1),[4,fr(e)];case 2:return o.sent(),[2]}})})}),[2]}})})}function el(e,t){return t().catch(function(n){return Oi(e,n,t)})}function bn(e){return m(this,void 0,void 0,function(){var t,n,r,i,o;return g(this,function(s){switch(s.label){case 0:t=T(e),n=he(t),r=t.Fr.length>0?t.Fr[t.Fr.length-1].batchId:-1,s.label=1;case 1:if(!function(a){return ce(a)&&a.Fr.length<10}(t))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,bv(t.localStore,r)];case 3:return(i=s.sent())===null?(t.Fr.length===0&&n.ir(),[3,7]):(r=i.batchId,function(a,u){a.Fr.push(u);var c=he(a);c.er()&&c.pr&&c.Er(u.mutations)}(t,i),[3,6]);case 4:return o=s.sent(),[4,Oi(t,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return nl(t)&&rl(t),[2]}})})}function nl(e){return ce(e)&&!he(e).tr()&&e.Fr.length>0}function rl(e){he(e).start()}function Gv(e){return m(this,void 0,void 0,function(){return g(this,function(t){return he(e).Ar(),[2]})})}function Hv(e){return m(this,void 0,void 0,function(){var t,n,r,i;return g(this,function(o){for(t=he(e),n=0,r=e.Fr;n<r.length;n++)i=r[n],t.Er(i.mutations);return[2]})})}function Qv(e,t,n){return m(this,void 0,void 0,function(){var r,i;return g(this,function(o){switch(o.label){case 0:return r=e.Fr.shift(),i=ev.from(r,t,n),[4,el(e,function(){return e.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,bn(e)];case 2:return o.sent(),[2]}})})}function Wv(e,t){return m(this,void 0,void 0,function(){return g(this,function(n){switch(n.label){case 0:return t&&he(e).pr?[4,function(r,i){return m(this,void 0,void 0,function(){var o,s;return g(this,function(a){switch(a.label){case 0:return Hc(s=i.code)&&s!==y.ABORTED?(o=r.Fr.shift(),he(r).sr(),[4,el(r,function(){return r.remoteSyncer.rejectFailedWrite(o.batchId,i)})]):[3,3];case 1:return a.sent(),[4,bn(r)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return nl(e)&&rl(e),[2]}})})}function Cs(e,t){return m(this,void 0,void 0,function(){var n;return g(this,function(r){switch(r.label){case 0:return n=T(e),t?(n.Or.delete(2),[4,fr(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return t?[3,4]:(n.Or.add(2),[4,wn(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function _n(e){var t=this;return e.Ur||(e.Ur=function(n,r,i){var o=T(n);return o.br(),new Fv(r,o.Hi,o.credentials,o.R,i)}(e.datastore,e.asyncQueue,{Ii:Bv.bind(null,e),Ri:Kv.bind(null,e),_r:zv.bind(null,e)}),e.Mr.push(function(n){return m(t,void 0,void 0,function(){return g(this,function(r){switch(r.label){case 0:return n?(e.Ur.sr(),Ns(e)?Ds(e):e.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,e.Ur.stop()];case 2:r.sent(),tl(e),r.label=3;case 3:return[2]}})})})),e.Ur}function he(e){var t=this;return e.Kr||(e.Kr=function(n,r,i){var o=T(n);return o.br(),new Vv(r,o.Hi,o.credentials,o.R,i)}(e.datastore,e.asyncQueue,{Ii:Gv.bind(null,e),Ri:Wv.bind(null,e),Ir:Hv.bind(null,e),Tr:Qv.bind(null,e)}),e.Mr.push(function(n){return m(t,void 0,void 0,function(){return g(this,function(r){switch(r.label){case 0:return n?(e.Kr.sr(),[4,bn(e)]):[3,2];case 1:return r.sent(),[3,4];case 2:return[4,e.Kr.stop()];case 3:r.sent(),e.Fr.length>0&&(I("RemoteStore","Stopping write stream with "+e.Fr.length+" pending writes"),e.Fr=[]),r.label=4;case 4:return[2]}})})})),e.Kr}var Yv=function(){function e(t,n,r,i,o){this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new yt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(s){})}return e.createAndSchedule=function(t,n,r,i,o){var s=new e(t,n,Date.now()+r,i,o);return s.start(r),s},e.prototype.start=function(t){var n=this;this.timerHandle=setTimeout(function(){return n.handleDelayElapsed()},t)},e.prototype.skipDelay=function(){return this.handleDelayElapsed()},e.prototype.cancel=function(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new b(y.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},e.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return t.timerHandle!==null?(t.clearTimeout(),t.op().then(function(n){return t.deferred.resolve(n)})):Promise.resolve()})},e.prototype.clearTimeout=function(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},e}();function En(e,t){if(X("AsyncQueue",t+": "+e),Re(e))return new b(y.UNAVAILABLE,t+": "+e);throw e}var il=function(){function e(t){this.comparator=t?function(n,r){return t(n,r)||C.comparator(n.key,r.key)}:function(n,r){return C.comparator(n.key,r.key)},this.keyedMap=as(),this.sortedSet=new pt(this.comparator)}return e.emptySet=function(t){return new e(t.comparator)},e.prototype.has=function(t){return this.keyedMap.get(t)!=null},e.prototype.get=function(t){return this.keyedMap.get(t)},e.prototype.first=function(){return this.sortedSet.minKey()},e.prototype.last=function(){return this.sortedSet.maxKey()},e.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},e.prototype.indexOf=function(t){var n=this.keyedMap.get(t);return n?this.sortedSet.indexOf(n):-1},Object.defineProperty(e.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(n,r){return t(n),!1})},e.prototype.add=function(t){var n=this.delete(t.key);return n.copy(n.keyedMap.insert(t.key,t),n.sortedSet.insert(t,null))},e.prototype.delete=function(t){var n=this.get(t);return n?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(n)):this},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},e.prototype.toString=function(){var t=[];return this.forEach(function(n){t.push(n.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`},e.prototype.copy=function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r},e}(),ol=function(){function e(){this.Qr=new pt(C.comparator)}return e.prototype.track=function(t){var n=t.doc.key,r=this.Qr.get(n);r?t.type!==0&&r.type===3?this.Qr=this.Qr.insert(n,t):t.type===3&&r.type!==1?this.Qr=this.Qr.insert(n,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.Qr=this.Qr.insert(n,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.Qr=this.Qr.insert(n,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.Qr=this.Qr.remove(n):t.type===1&&r.type===2?this.Qr=this.Qr.insert(n,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.Qr=this.Qr.insert(n,{type:2,doc:t.doc}):N():this.Qr=this.Qr.insert(n,t)},e.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(n,r){t.push(r)}),t},e}(),xi=function(){function e(t,n,r,i,o,s,a,u){this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=u}return e.fromInitialDocuments=function(t,n,r,i){var o=[];return n.forEach(function(s){o.push({type:0,doc:s})}),new e(t,n,il.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&er(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var n=this.docChanges,r=t.docChanges;if(n.length!==r.length)return!1;for(var i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0},e}(),Xv=function(){this.Wr=void 0,this.listeners=[]},$v=function(){this.queries=new yn(function(e){return Oc(e)},er),this.onlineState="Unknown",this.Gr=new Set};function Rs(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return g(this,function(c){switch(c.label){case 0:if(n=T(e),r=t.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new Xv),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=En(a,"Initialization of query '"+is(t.query)+"' failed"),[2,void t.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(t),t.zr(n.onlineState),o.Wr&&t.Hr(o.Wr)&&xs(n),[2]}})})}function Os(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s;return g(this,function(a){return n=T(e),r=t.query,i=!1,(o=n.queries.get(r))&&(s=o.listeners.indexOf(t))>=0&&(o.listeners.splice(s,1),i=o.listeners.length===0),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function Jv(e,t){for(var n=T(e),r=!1,i=0,o=t;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,h=u.listeners;c<h.length;c++)h[c].Hr(s)&&(r=!0);u.Wr=s}}r&&xs(n)}function Zv(e,t,n){var r=T(e),i=r.queries.get(t);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(t)}function xs(e){e.Gr.forEach(function(t){t.next()})}var ks=function(){function e(t,n,r){this.query=t,this.Jr=n,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=r||{}}return e.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var n=[],r=0,i=t.docChanges;r<i.length;r++){var o=i[r];o.type!==3&&n.push(o)}t=new xi(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var s=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),s=!0):this.eo(t,this.onlineState)&&(this.no(t),s=!0),this.Xr=t,s},e.prototype.onError=function(t){this.Jr.error(t)},e.prototype.zr=function(t){this.onlineState=t;var n=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),n=!0),n},e.prototype.eo=function(t,n){if(!t.fromCache)return!0;var r=n!=="Offline";return!(this.options.so&&r||t.docs.isEmpty()&&n!=="Offline")},e.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var n=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0},e.prototype.no=function(t){t=xi.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},e}(),ty=function(){function e(t,n){this.payload=t,this.byteLength=n}return e.prototype.io=function(){return"metadata"in this.payload},e}(),sl=function(){function e(t){this.R=t}return e.prototype.qn=function(t){return Bt(this.R,t)},e.prototype.Un=function(t){return t.metadata.exists?sh(this.R,t.document,!1):at.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},e.prototype.Kn=function(t){return ut(t)},e}(),zg=function(){function e(t,n,r){this.ro=t,this.localStore=n,this.R=r,this.queries=[],this.documents=[],this.progress=ey(t)}return e.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var n=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++n):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++n),n!==this.progress.documentsLoaded?(this.progress.documentsLoaded=n,Object.assign({},this.progress)):null},e.prototype.co=function(t){for(var n=new Map,r=new sl(this.R),i=0,o=t;i<o.length;i++){var s=o[i];if(s.metadata.queries)for(var a=r.qn(s.metadata.name),u=0,c=s.metadata.queries;u<c.length;u++){var h=c[u],f=(n.get(h)||B()).add(a);n.set(h,f)}}return n},e.prototype.complete=function(){return m(this,void 0,void 0,function(){var t,n,r,i,o;return g(this,function(s){switch(s.label){case 0:return[4,Ev(this.localStore,new sl(this.R),this.documents,this.ro.id)];case 1:t=s.sent(),n=this.co(this.documents),r=0,i=this.queries,s.label=2;case 2:return r<i.length?(o=i[r],[4,Iv(this.localStore,o,n.get(o.name))]):[3,5];case 3:s.sent(),s.label=4;case 4:return r++,[3,2];case 5:return[2,(this.progress.taskState="Success",new vv(Object.assign({},this.progress),t))]}})})},e}();function ey(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}var al=function(e){this.key=e},ul=function(e){this.key=e},cl=function(){function e(t,n){this.query=t,this.uo=n,this.ao=null,this.current=!1,this.ho=B(),this.mutatedKeys=B(),this.lo=xc(t),this.fo=new il(this.lo)}return Object.defineProperty(e.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),e.prototype._o=function(t,n){var r=this,i=n?n.mo:new ol,o=n?n.fo:this.fo,s=n?n.mutatedKeys:this.mutatedKeys,a=o,u=!1,c=fi(this.query)&&o.size===this.query.limit?o.last():null,h=di(this.query)&&o.size===this.query.limit?o.first():null;if(t.inorderTraversal(function(l,d){var p=o.get(l),v=nr(r.query,d)?d:null,w=!!p&&r.mutatedKeys.has(p.key),E=!!v&&(v.hasLocalMutations||r.mutatedKeys.has(v.key)&&v.hasCommittedMutations),A=!1;p&&v?p.data.isEqual(v.data)?w!==E&&(i.track({type:3,doc:v}),A=!0):r.yo(p,v)||(i.track({type:2,doc:v}),A=!0,(c&&r.lo(v,c)>0||h&&r.lo(v,h)<0)&&(u=!0)):!p&&v?(i.track({type:0,doc:v}),A=!0):p&&!v&&(i.track({type:1,doc:p}),A=!0,(c||h)&&(u=!0)),A&&(v?(a=a.add(v),s=E?s.add(l):s.delete(l)):(a=a.delete(l),s=s.delete(l)))}),fi(this.query)||di(this.query))for(;a.size>this.query.limit;){var f=fi(this.query)?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),i.track({type:1,doc:f})}return{fo:a,mo:i,Nn:u,mutatedKeys:s}},e.prototype.yo=function(t,n){return t.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations},e.prototype.applyChanges=function(t,n,r){var i=this,o=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var s=t.mo.jr();s.sort(function(h,f){return function(l,d){var p=function(v){switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return N()}};return p(l)-p(d)}(h.type,f.type)||i.lo(h.doc,f.doc)}),this.po(r);var a=n?this.Eo():[],u=this.ho.size===0&&this.current?1:0,c=u!==this.ao;return this.ao=u,s.length!==0||c?{snapshot:new xi(this.query,t.fo,o,s,t.mutatedKeys,u===0,c,!1),To:a}:{To:a}},e.prototype.zr=function(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({fo:this.fo,mo:new ol,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},e.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},e.prototype.po=function(t){var n=this;t&&(t.addedDocuments.forEach(function(r){return n.uo=n.uo.add(r)}),t.modifiedDocuments.forEach(function(r){}),t.removedDocuments.forEach(function(r){return n.uo=n.uo.delete(r)}),this.current=t.current)},e.prototype.Eo=function(){var t=this;if(!this.current)return[];var n=this.ho;this.ho=B(),this.fo.forEach(function(i){t.Io(i.key)&&(t.ho=t.ho.add(i.key))});var r=[];return n.forEach(function(i){t.ho.has(i)||r.push(new ul(i))}),this.ho.forEach(function(i){n.has(i)||r.push(new al(i))}),r},e.prototype.Ao=function(t){this.uo=t.Bn,this.ho=B();var n=this._o(t.documents);return this.applyChanges(n,!0)},e.prototype.Ro=function(){return xi.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,this.ao===0)},e}(),ny=function(e,t,n){this.query=e,this.targetId=t,this.view=n},ry=function(e){this.key=e,this.bo=!1},iy=function(){function e(t,n,r,i,o,s){this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=s,this.vo={},this.Po=new yn(function(a){return Oc(a)},er),this.Vo=new Map,this.So=new Set,this.Do=new pt(C.comparator),this.Co=new Map,this.No=new bs,this.xo={},this.ko=new Map,this.Fo=Ii.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(e.prototype,"isPrimaryClient",{get:function(){return this.$o===!0},enumerable:!1,configurable:!0}),e}();function oy(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s,a;return g(this,function(u){switch(u.label){case 0:return n=Us(e),(o=n.Po.get(t))?(r=o.targetId,n.sharedClientState.addLocalQueryTarget(r),i=o.view.Ro(),[3,4]):[3,1];case 1:return[4,gn(n.localStore,Pt(t))];case 2:return s=u.sent(),a=n.sharedClientState.addLocalQueryTarget(s.targetId),r=s.targetId,[4,Ps(n,t,r,a==="current")];case 3:i=u.sent(),n.isPrimaryClient&&Ri(n.remoteStore,s),u.label=4;case 4:return[2,i]}})})}function Ps(e,t,n,r){return m(this,void 0,void 0,function(){var i,o,s,a,u,c;return g(this,function(h){switch(h.label){case 0:return e.Oo=function(f,l,d){return function(p,v,w,E){return m(this,void 0,void 0,function(){var A,D,k;return g(this,function(M){switch(M.label){case 0:return A=v.view._o(w),A.Nn?[4,Di(p.localStore,v.query,!1).then(function(q){var rt=q.documents;return v.view._o(rt,A)})]:[3,2];case 1:A=M.sent(),M.label=2;case 2:return D=E&&E.targetChanges.get(v.targetId),k=v.view.applyChanges(A,p.isPrimaryClient,D),[2,(Fs(p,v.targetId,k.To),k.snapshot)]}})})}(e,f,l,d)},[4,Di(e.localStore,t,!0)];case 1:return i=h.sent(),o=new cl(t,i.Bn),s=o._o(i.documents),a=cs.createSynthesizedTargetChangeForCurrentChange(n,r&&e.onlineState!=="Offline"),u=o.applyChanges(s,e.isPrimaryClient,a),Fs(e,n,u.To),c=new ny(t,n,o),[2,(e.Po.set(t,c),e.Vo.has(n)?e.Vo.get(n).push(t):e.Vo.set(n,[t]),u.snapshot)]}})})}function sy(e,t){return m(this,void 0,void 0,function(){var n,r,i;return g(this,function(o){switch(o.label){case 0:return n=T(e),r=n.Po.get(t),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(s){return!er(s,t)})),void n.Po.delete(t))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,mn(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),dr(n.remoteStore,r.targetId),In(n,r.targetId)}).catch(xe)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return In(n,r.targetId),[4,mn(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function ay(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s;return g(this,function(a){switch(a.label){case 0:r=js(e),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(u,c){var h,f=T(u),l=_t.now(),d=c.reduce(function(p,v){return p.add(v.key)},B());return f.persistence.runTransaction("Locally write mutations","readwrite",function(p){return f.Mn.pn(p,d).next(function(v){h=v;for(var w=[],E=0,A=c;E<A.length;E++){var D=A[E],k=Op(D,h.get(D.key));k!=null&&w.push(new re(D.key,k,Tc(k.value.mapValue),dt.exists(!0)))}return f._n.addMutationBatch(p,l,w,c)})}).then(function(p){return p.applyToLocalDocumentSet(h),{batchId:p.batchId,changes:h}})}(r.localStore,t)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(u,c,h){var f=u.xo[u.currentUser.toKey()];f||(f=new pt(L)),f=f.insert(c,h),u.xo[u.currentUser.toKey()]=f}(r,i.batchId,n),[4,le(r,i.changes)];case 3:return a.sent(),[4,bn(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=En(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function hl(e,t){return m(this,void 0,void 0,function(){var n,r;return g(this,function(i){switch(i.label){case 0:n=T(e),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,wv(n.localStore,t)];case 2:return r=i.sent(),t.targetChanges.forEach(function(o,s){var a=n.Co.get(s);a&&(O(o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size<=1),o.addedDocuments.size>0?a.bo=!0:o.modifiedDocuments.size>0?O(a.bo):o.removedDocuments.size>0&&(O(a.bo),a.bo=!1))}),[4,le(n,r,t)];case 3:return i.sent(),[3,6];case 4:return[4,xe(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function ll(e,t,n){var r=T(e);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){var i=[];r.Po.forEach(function(o,s){var a=s.view.zr(t);a.snapshot&&i.push(a.snapshot)}),function(o,s){var a=T(o);a.onlineState=s;var u=!1;a.queries.forEach(function(c,h){for(var f=0,l=h.listeners;f<l.length;f++)l[f].zr(s)&&(u=!0)}),u&&xs(a)}(r.eventManager,t),i.length&&r.vo._r(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function uy(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s,a,u;return g(this,function(c){switch(c.label){case 0:return(r=T(e)).sharedClientState.updateQueryState(t,"rejected",n),i=r.Co.get(t),(o=i&&i.key)?(s=(s=new pt(C.comparator)).insert(o,at.newNoDocument(o,P.min())),a=B().add(o),u=new us(P.min(),new Map,new tt(L),s,a),[4,hl(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(t),Vs(r),[3,4];case 2:return[4,mn(r.localStore,t,!1).then(function(){return In(r,t,n)}).catch(xe)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function cy(e,t){return m(this,void 0,void 0,function(){var n,r,i;return g(this,function(o){switch(o.label){case 0:n=T(e),r=t.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,mv(n.localStore,t)];case 2:return i=o.sent(),Ms(n,r,null),Ls(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,le(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,xe(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function hy(e,t,n){return m(this,void 0,void 0,function(){var r,i;return g(this,function(o){switch(o.label){case 0:r=T(e),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(s,a){var u=T(s);return u.persistence.runTransaction("Reject batch","readwrite-primary",function(c){var h;return u._n.lookupMutationBatch(c,a).next(function(f){return O(f!==null),h=f.keys(),u._n.removeMutationBatch(c,f)}).next(function(){return u._n.performConsistencyCheck(c)}).next(function(){return u.Mn.pn(c,h)})})}(r.localStore,t)];case 2:return i=o.sent(),Ms(r,t,n),Ls(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),[4,le(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,xe(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function ly(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s;return g(this,function(a){switch(a.label){case 0:ce((n=T(e)).remoteStore)||I("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(u){var c=T(u);return c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(h){return c._n.getHighestUnacknowledgedBatchId(h)})}(n.localStore)];case 2:return(r=a.sent())===-1?[2,void t.resolve()]:((i=n.ko.get(r)||[]).push(t),n.ko.set(r,i),[3,4]);case 3:return o=a.sent(),s=En(o,"Initialization of waitForPendingWrites() operation failed"),t.reject(s),[3,4];case 4:return[2]}})})}function Ls(e,t){(e.ko.get(t)||[]).forEach(function(n){n.resolve()}),e.ko.delete(t)}function Ms(e,t,n){var r=T(e),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(t);o&&(n?o.reject(n):o.resolve(),i=i.remove(t)),r.xo[r.currentUser.toKey()]=i}}function In(e,t,n){n===void 0&&(n=null),e.sharedClientState.removeLocalQueryTarget(t);for(var r=0,i=e.Vo.get(t);r<i.length;r++){var o=i[r];e.Po.delete(o),n&&e.vo.Mo(o,n)}e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach(function(s){e.No.containsKey(s)||fl(e,s)})}function fl(e,t){e.So.delete(t.path.canonicalString());var n=e.Do.get(t);n!==null&&(dr(e.remoteStore,n),e.Do=e.Do.remove(t),e.Co.delete(n),Vs(e))}function Fs(e,t,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof al?(e.No.addReference(o.key,t),fy(e,o)):o instanceof ul?(I("SyncEngine","Document no longer in limbo: "+o.key),e.No.removeReference(o.key,t),e.No.containsKey(o.key)||fl(e,o.key)):N()}}function fy(e,t){var n=t.key,r=n.path.canonicalString();e.Do.get(n)||e.So.has(r)||(I("SyncEngine","New document in limbo: "+n),e.So.add(r),Vs(e))}function Vs(e){for(;e.So.size>0&&e.Do.size<e.maxConcurrentLimboResolutions;){var t=e.So.values().next().value;e.So.delete(t);var n=new C(U.fromString(t)),r=e.Fo.next();e.Co.set(r,new ry(n)),e.Do=e.Do.insert(n,r),Ri(e.remoteStore,new _i(Pt(en(n.path)),r,2,Dt.o))}}function le(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s;return g(this,function(a){switch(a.label){case 0:return r=T(e),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(u,c){s.push(r.Oo(c,t,n).then(function(h){if(h){r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,h.fromCache?"not-current":"current"),i.push(h);var f=yv.Pn(c.targetId,h);o.push(f)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(u,c){return m(this,void 0,void 0,function(){var h,f,l,d,p,v,w,E,A;return g(this,function(D){switch(D.label){case 0:h=T(u),D.label=1;case 1:return D.trys.push([1,3,,4]),[4,h.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(k){return _.forEach(c,function(M){return _.forEach(M.bn,function(q){return h.persistence.referenceDelegate.addReference(k,M.targetId,q)}).next(function(){return _.forEach(M.vn,function(q){return h.persistence.referenceDelegate.removeReference(k,M.targetId,q)})})})})];case 2:return D.sent(),[3,4];case 3:if(!Re(f=D.sent()))throw f;return I("LocalStore","Failed to update sequence numbers: "+f),[3,4];case 4:for(l=0,d=c;l<d.length;l++)p=d[l],v=p.targetId,p.fromCache||(w=h.kn.get(v),E=w.snapshotVersion,A=w.withLastLimboFreeSnapshotVersion(E),h.kn=h.kn.insert(v,A));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function dy(e,t){return m(this,void 0,void 0,function(){var n,r;return g(this,function(i){switch(i.label){case 0:return(n=T(e)).currentUser.isEqual(t)?[3,3]:(I("SyncEngine","User change. New user:",t.toKey()),[4,jh(n.localStore,t)]);case 1:return r=i.sent(),n.currentUser=t,function(o,s){o.ko.forEach(function(a){a.forEach(function(u){u.reject(new b(y.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),o.ko.clear()}(n),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),[4,le(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function py(e,t){var n=T(e),r=n.Co.get(t);if(r&&r.bo)return B().add(r.key);var i=B(),o=n.Vo.get(t);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.Po.get(u);i=i.unionWith(c.view.wo)}return i}function vy(e,t){return m(this,void 0,void 0,function(){var n,r,i;return g(this,function(o){switch(o.label){case 0:return[4,Di((n=T(e)).localStore,t.query,!0)];case 1:return r=o.sent(),i=t.view.Ao(r),[2,(n.isPrimaryClient&&Fs(n,t.targetId,i.To),i)]}})})}function yy(e){return m(this,void 0,void 0,function(){var t;return g(this,function(n){return[2,zh((t=T(e)).localStore).then(function(r){return le(t,r)})]})})}function gy(e,t,n,r){return m(this,void 0,void 0,function(){var i,o;return g(this,function(s){switch(s.label){case 0:return[4,function(a,u){var c=T(a),h=T(c._n);return c.persistence.runTransaction("Lookup mutation documents","readonly",function(f){return h.jt(f,u).next(function(l){return l?c.Mn.pn(f,l):_.resolve(null)})})}((i=T(e)).localStore,t)];case 1:return(o=s.sent())===null?[3,6]:n!=="pending"?[3,3]:[4,bn(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:n==="acknowledged"||n==="rejected"?(Ms(i,t,r||null),Ls(i,t),function(a,u){T(T(a)._n).Gt(u)}(i.localStore,t)):N(),s.label=4;case 4:return[4,le(i,o)];case 5:return s.sent(),[3,7];case 6:I("SyncEngine","Cannot apply mutation batch with id: "+t),s.label=7;case 7:return[2]}})})}function my(e,t){return m(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return g(this,function(h){switch(h.label){case 0:return Us(n=T(e)),js(n),t!==!0||n.$o===!0?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,dl(n,r.toArray())]);case 1:return i=h.sent(),n.$o=!0,[4,Cs(n.remoteStore,!0)];case 2:for(h.sent(),o=0,s=i;o<s.length;o++)a=s[o],Ri(n.remoteStore,a);return[3,7];case 3:return t!==!1||n.$o===!1?[3,7]:(u=[],c=Promise.resolve(),n.Vo.forEach(function(f,l){n.sharedClientState.isLocalQueryTarget(l)?u.push(l):c=c.then(function(){return In(n,l),mn(n.localStore,l,!0)}),dr(n.remoteStore,l)}),[4,c]);case 4:return h.sent(),[4,dl(n,u)];case 5:return h.sent(),function(f){var l=T(f);l.Co.forEach(function(d,p){dr(l.remoteStore,p)}),l.No.ts(),l.Co=new Map,l.Do=new pt(C.comparator)}(n),n.$o=!1,[4,Cs(n.remoteStore,!1)];case 6:h.sent(),h.label=7;case 7:return[2]}})})}function dl(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,f,l,d,p,v,w;return g(this,function(E){switch(E.label){case 0:r=T(e),i=[],o=[],s=0,a=t,E.label=1;case 1:return s<a.length?(u=a[s],c=void 0,(h=r.Vo.get(u))&&h.length!==0?[4,gn(r.localStore,Pt(h[0]))]:[3,7]):[3,13];case 2:c=E.sent(),f=0,l=h,E.label=3;case 3:return f<l.length?(d=l[f],p=r.Po.get(d),[4,vy(r,p)]):[3,6];case 4:(v=E.sent()).snapshot&&o.push(v.snapshot),E.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,Kh(r.localStore,u)];case 8:return w=E.sent(),[4,gn(r.localStore,w)];case 9:return c=E.sent(),[4,Ps(r,pl(w),u,!1)];case 10:E.sent(),E.label=11;case 11:i.push(c),E.label=12;case 12:return s++,[3,1];case 13:return[2,(r.vo._r(o),i)]}})})}function pl(e){return Cc(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function wy(e){var t=T(e);return T(T(t.localStore).persistence).fn()}function by(e,t,n,r){return m(this,void 0,void 0,function(){var i,o,s;return g(this,function(a){switch(a.label){case 0:return(i=T(e)).$o?(I("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(t))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,zh(i.localStore)];case 3:return o=a.sent(),s=us.createSynthesizedRemoteEventForCurrentChange(t,n==="current"),[4,le(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,mn(i.localStore,t,!0)];case 6:return a.sent(),In(i,t,r),[3,8];case 7:N(),a.label=8;case 8:return[2]}})})}function _y(e,t,n){return m(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,f,l;return g(this,function(d){switch(d.label){case 0:if(!(r=Us(e)).$o)return[3,10];i=0,o=t,d.label=1;case 1:return i<o.length?(s=o[i],r.Vo.has(s)?(I("SyncEngine","Adding an already active target "+s),[3,5]):[4,Kh(r.localStore,s)]):[3,6];case 2:return a=d.sent(),[4,gn(r.localStore,a)];case 3:return u=d.sent(),[4,Ps(r,pl(a),u.targetId,!1)];case 4:d.sent(),Ri(r.remoteStore,u),d.label=5;case 5:return i++,[3,1];case 6:c=function(p){return g(this,function(v){switch(v.label){case 0:return r.Vo.has(p)?[4,mn(r.localStore,p,!1).then(function(){dr(r.remoteStore,p),In(r,p)}).catch(xe)]:[3,2];case 1:v.sent(),v.label=2;case 2:return[2]}})},h=0,f=n,d.label=7;case 7:return h<f.length?(l=f[h],[5,c(l)]):[3,10];case 8:d.sent(),d.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function Us(e){var t=T(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=hl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=py.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=uy.bind(null,t),t.vo._r=Jv.bind(null,t.eventManager),t.vo.Mo=Zv.bind(null,t.eventManager),t}function js(e){var t=T(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=cy.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=hy.bind(null,t),t}var vl=function(){function e(){this.synchronizeTabs=!1}return e.prototype.initialize=function(t){return m(this,void 0,void 0,function(){return g(this,function(n){switch(n.label){case 0:return this.R=Ci(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return n.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},e.prototype.Uo=function(t){return null},e.prototype.Ko=function(t){return Uh(this.persistence,new Vh,t.initialUser,this.R)},e.prototype.qo=function(t){return new Cv(Ov.bs,this.R)},e.prototype.Bo=function(t){return new Yh},e.prototype.terminate=function(){return m(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},e}(),yl=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).Qo=n,o.cacheSizeBytes=r,o.forceOwnership=i,o.synchronizeTabs=!1,o}return R(t,e),t.prototype.initialize=function(n){return m(this,void 0,void 0,function(){var r=this;return g(this,function(i){switch(i.label){case 0:return[4,e.prototype.initialize.call(this,n)];case 1:return i.sent(),[4,_v(this.localStore)];case 2:return i.sent(),[4,this.Qo.initialize(this,n)];case 3:return i.sent(),[4,js(this.Qo.syncEngine)];case 4:return i.sent(),[4,bn(this.Qo.remoteStore)];case 5:return i.sent(),[4,this.persistence.He(function(){return r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(r.localStore),Promise.resolve()})];case 6:return i.sent(),[2]}})})},t.prototype.Ko=function(n){return Uh(this.persistence,new Vh,n.initialUser,this.R)},t.prototype.Uo=function(n){var r=this.persistence.referenceDelegate.garbageCollector;return new uv(r,n.asyncQueue)},t.prototype.qo=function(n){var r=ws(n.databaseInfo.databaseId,n.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?zt.withCacheSize(this.cacheSizeBytes):zt.DEFAULT;return new pv(this.synchronizeTabs,r,n.clientId,i,n.asyncQueue,$h(),Ni(),this.R,this.sharedClientState,!!this.forceOwnership)},t.prototype.Bo=function(n){return new Yh},t}(vl),Ey=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r,!1)||this).Qo=n,i.cacheSizeBytes=r,i.synchronizeTabs=!0,i}return R(t,e),t.prototype.initialize=function(n){return m(this,void 0,void 0,function(){var r,i=this;return g(this,function(o){switch(o.label){case 0:return[4,e.prototype.initialize.call(this,n)];case 1:return o.sent(),r=this.Qo.syncEngine,this.sharedClientState instanceof Ts?(this.sharedClientState.syncEngine={ui:gy.bind(null,r),ai:by.bind(null,r),hi:_y.bind(null,r),fn:wy.bind(null,r),ci:yy.bind(null,r)},[4,this.sharedClientState.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.He(function(s){return m(i,void 0,void 0,function(){return g(this,function(a){switch(a.label){case 0:return[4,my(this.Qo.syncEngine,s)];case 1:return a.sent(),this.gcScheduler&&(s&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):s||this.gcScheduler.stop()),[2]}})})})];case 4:return o.sent(),[2]}})})},t.prototype.Bo=function(n){var r=$h();if(!Ts.yt(r))throw new b(y.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var i=ws(n.databaseInfo.databaseId,n.databaseInfo.persistenceKey);return new Ts(r,n.asyncQueue,i,n.clientId,n.initialUser)},t}(yl),qs=function(){function e(){}return e.prototype.initialize=function(t,n){return m(this,void 0,void 0,function(){var r=this;return g(this,function(i){switch(i.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(o){return ll(r.syncEngine,o,1)},this.remoteStore.remoteSyncer.handleCredentialChange=dy.bind(null,this.syncEngine),[4,Cs(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:i.sent(),i.label=2;case 2:return[2]}})})},e.prototype.createEventManager=function(t){return new $v},e.prototype.createDatastore=function(t){var n,r=Ci(t.databaseInfo.databaseId),i=(n=t.databaseInfo,new Mv(n));return function(o,s,a){return new Uv(o,s,a)}(t.credentials,i,r)},e.prototype.createRemoteStore=function(t){var n,r,i,o,s,a=this;return n=this.localStore,r=this.datastore,i=t.asyncQueue,o=function(u){return ll(a.syncEngine,u,0)},s=Xh.yt()?new Xh:new kv,new qv(n,r,i,o,s)},e.prototype.createSyncEngine=function(t,n){return function(r,i,o,s,a,u,c){var h=new iy(r,i,o,s,a,u);return c&&(h.$o=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)},e.prototype.terminate=function(){return function(t){return m(this,void 0,void 0,function(){var n;return g(this,function(r){switch(r.label){case 0:return n=T(t),I("RemoteStore","RemoteStore shutting down."),n.Or.add(5),[4,wn(n)];case 1:return r.sent(),n.Lr.shutdown(),n.Br.set("Unknown"),[2]}})})}(this.remoteStore)},e}();var ki=function(){function e(t){this.observer=t,this.muted=!1}return e.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},e.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},e.prototype.Wo=function(){this.muted=!0},e.prototype.jo=function(t,n){var r=this;this.muted||setTimeout(function(){r.muted||t(n)},0)},e}(),Gg=function(){function e(t,n){var r=this;this.Go=t,this.R=n,this.metadata=new yt,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(i){i&&i.io()?r.metadata.resolve(i.payload.metadata):r.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             `+JSON.stringify(i==null?void 0:i.payload)))},function(i){return r.metadata.reject(i)})}return e.prototype.close=function(){return this.Go.cancel()},e.prototype.getMetadata=function(){return m(this,void 0,void 0,function(){return g(this,function(t){return[2,this.metadata.promise]})})},e.prototype.Lo=function(){return m(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},e.prototype.Ho=function(){return m(this,void 0,void 0,function(){var t,n,r,i;return g(this,function(o){switch(o.label){case 0:return[4,this.Jo()];case 1:return(t=o.sent())===null?[2,null]:(n=this.zo.decode(t),r=Number(n),isNaN(r)&&this.Yo("length string ("+n+") is not valid number"),[4,this.Xo(r)]);case 2:return i=o.sent(),[2,new ty(JSON.parse(i),t.length+r)]}})})},e.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},e.prototype.Jo=function(){return m(this,void 0,void 0,function(){var t,n;return g(this,function(r){switch(r.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(r.sent())return[3,3];r.label=2;case 2:return[3,0];case 3:return this.buffer.length===0?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),n)])}})})},e.prototype.Xo=function(t){return m(this,void 0,void 0,function(){var n;return g(this,function(r){switch(r.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:r.sent()&&this.Yo("Reached the end of bundle when more is expected."),r.label=2;case 2:return[3,0];case 3:return n=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),n)]}})})},e.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},e.prototype.tc=function(){return m(this,void 0,void 0,function(){var t,n;return g(this,function(r){switch(r.label){case 0:return[4,this.Go.read()];case 1:return(t=r.sent()).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),[2,t.done]}})})},e}(),Iy=function(){function e(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return e.prototype.lookup=function(t){return m(this,void 0,void 0,function(){var n,r=this;return g(this,function(i){switch(i.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new b(y.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(o,s){return m(this,void 0,void 0,function(){var a,u,c,h,f,l;return g(this,function(d){switch(d.label){case 0:return a=T(o),u=ur(a.R)+"/documents",c={documents:s.map(function(p){return ar(a.R,p)})},[4,a.$i("BatchGetDocuments",u,c)];case 1:return h=d.sent(),f=new Map,h.forEach(function(p){var v=function(w,E){return"found"in E?function(A,D){O(!!D.found),D.found.name,D.found.updateTime;var k=Bt(A,D.found.name),M=ut(D.found.updateTime),q=new Nt({mapValue:{fields:D.found.fields}});return at.newFoundDocument(k,M,q)}(w,E):"missing"in E?function(A,D){O(!!D.missing),O(!!D.readTime);var k=Bt(A,D.missing),M=ut(D.readTime);return at.newNoDocument(k,M)}(w,E):N()}(a.R,p);f.set(v.key.toString(),v)}),l=[],[2,(s.forEach(function(p){var v=f.get(p.toString());O(!!v),l.push(v)}),l)]}})})}(this.datastore,t)];case 1:return[2,((n=i.sent()).forEach(function(o){return r.recordVersion(o)}),n)]}})})},e.prototype.set=function(t,n){this.write(n.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.update=function(t,n){try{this.write(n.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(t.toString())},e.prototype.delete=function(t){this.write(new or(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.commit=function(){return m(this,void 0,void 0,function(){var t,n=this;return g(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(i){t.delete(i.key.toString())}),t.forEach(function(i,o){var s=C.fromPath(o);n.mutations.push(new ss(s,n.precondition(s)))}),[4,function(i,o){return m(this,void 0,void 0,function(){var s,a,u;return g(this,function(c){switch(c.label){case 0:return s=T(i),a=ur(s.R)+"/documents",u={writes:o.map(function(h){return bi(s.R,h)})},[4,s.Ni("Commit",a,u)];case 1:return c.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return r.sent(),this.committed=!0,[2]}})})},e.prototype.recordVersion=function(t){var n;if(t.isFoundDocument())n=t.version;else{if(!t.isNoDocument())throw N();n=P.min()}var r=this.readVersions.get(t.key.toString());if(r){if(!n.isEqual(r))throw new b(y.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),n)},e.prototype.precondition=function(t){var n=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&n?dt.updateTime(n):dt.none()},e.prototype.preconditionForUpdate=function(t){var n=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&n){if(n.isEqual(P.min()))throw new b(y.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return dt.updateTime(n)}return dt.exists(!0)},e.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},e.prototype.ensureCommitNotCalled=function(){},e}(),Ty=function(){function e(t,n,r,i){this.asyncQueue=t,this.datastore=n,this.updateFunction=r,this.deferred=i,this.ec=5,this.Zi=new Ss(this.asyncQueue,"transaction_retry")}return e.prototype.run=function(){this.ec-=1,this.nc()},e.prototype.nc=function(){var t=this;this.Zi.ji(function(){return m(t,void 0,void 0,function(){var n,r,i=this;return g(this,function(o){return n=new Iy(this.datastore),(r=this.sc(n))&&r.then(function(s){i.asyncQueue.enqueueAndForget(function(){return n.commit().then(function(){i.deferred.resolve(s)}).catch(function(a){i.ic(a)})})}).catch(function(s){i.ic(s)}),[2]})})})},e.prototype.sc=function(t){try{var n=this.updateFunction(t);return!Se(n)&&n.catch&&n.then?n:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(r){return this.deferred.reject(r),null}},e.prototype.ic=function(t){var n=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return n.nc(),Promise.resolve()})):this.deferred.reject(t)},e.prototype.rc=function(t){if(t.name==="FirebaseError"){var n=t.code;return n==="aborted"||n==="failed-precondition"||!Hc(n)}return!1},e}(),Sy=function(){function e(t,n,r){var i=this;this.credentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=ht.UNAUTHENTICATED,this.clientId=pc.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(n,function(o){return m(i,void 0,void 0,function(){return g(this,function(s){switch(s.label){case 0:return I("FirestoreClient","Received user=",o.uid),[4,this.credentialListener(o)];case 1:return s.sent(),this.user=o,[2]}})})})}return e.prototype.getConfiguration=function(){return m(this,void 0,void 0,function(){return g(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},e.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},e.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new b(y.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new yt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return m(t,void 0,void 0,function(){var r,i;return g(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:o.sent(),o.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:o.sent(),o.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return r=o.sent(),i=En(r,"Failed to shutdown persistence"),n.reject(i),[3,6];case 6:return[2]}})})}),n.promise},e}();function gl(e,t){return m(this,void 0,void 0,function(){var n,r,i=this;return g(this,function(o){switch(o.label){case 0:return e.asyncQueue.verifyOperationInProgress(),I("FirestoreClient","Initializing OfflineComponentProvider"),[4,e.getConfiguration()];case 1:return n=o.sent(),[4,t.initialize(n)];case 2:return o.sent(),r=n.initialUser,e.setCredentialChangeListener(function(s){return m(i,void 0,void 0,function(){return g(this,function(a){switch(a.label){case 0:return r.isEqual(s)?[3,2]:[4,jh(t.localStore,s)];case 1:a.sent(),r=s,a.label=2;case 2:return[2]}})})}),t.persistence.setDatabaseDeletedListener(function(){return e.terminate()}),e.offlineComponents=t,[2]}})})}function ml(e,t){return m(this,void 0,void 0,function(){var n,r;return g(this,function(i){switch(i.label){case 0:return e.asyncQueue.verifyOperationInProgress(),[4,Bs(e)];case 1:return n=i.sent(),I("FirestoreClient","Initializing OnlineComponentProvider"),[4,e.getConfiguration()];case 2:return r=i.sent(),[4,t.initialize(n,r)];case 3:return i.sent(),e.setCredentialChangeListener(function(o){return function(s,a){return m(this,void 0,void 0,function(){var u,c;return g(this,function(h){switch(h.label){case 0:return(u=T(s)).asyncQueue.verifyOperationInProgress(),I("RemoteStore","RemoteStore received new credentials"),c=ce(u),u.Or.add(3),[4,wn(u)];case 1:return h.sent(),c&&u.Br.set("Unknown"),[4,u.remoteSyncer.handleCredentialChange(a)];case 2:return h.sent(),u.Or.delete(3),[4,fr(u)];case 3:return h.sent(),[2]}})})}(t.remoteStore,o)}),e.onlineComponents=t,[2]}})})}function Bs(e){return m(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(I("FirestoreClient","Using default OfflineComponentProvider"),[4,gl(e,new vl)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}})})}function Pi(e){return m(this,void 0,void 0,function(){return g(this,function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(I("FirestoreClient","Using default OnlineComponentProvider"),[4,ml(e,new qs)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}})})}function wl(e){return Bs(e).then(function(t){return t.persistence})}function bl(e){return Bs(e).then(function(t){return t.localStore})}function _l(e){return Pi(e).then(function(t){return t.remoteStore})}function El(e){return Pi(e).then(function(t){return t.syncEngine})}function Tn(e){return m(this,void 0,void 0,function(){var t,n;return g(this,function(r){switch(r.label){case 0:return[4,Pi(e)];case 1:return t=r.sent(),[2,((n=t.eventManager).onListen=oy.bind(null,t.syncEngine),n.onUnlisten=sy.bind(null,t.syncEngine),n)]}})})}function Il(e,t,n){var r=this;n===void 0&&(n={});var i=new yt;return e.asyncQueue.enqueueAndForget(function(){return m(r,void 0,void 0,function(){var o;return g(this,function(s){switch(s.label){case 0:return o=function(a,u,c,h,f){var l=new ki({next:function(p){u.enqueueAndForget(function(){return Os(a,d)});var v=p.docs.has(c);!v&&p.fromCache?f.reject(new b(y.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&p.fromCache&&h&&h.source==="server"?f.reject(new b(y.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(p)},error:function(p){return f.reject(p)}}),d=new ks(en(c.path),l,{includeMetadataChanges:!0,so:!0});return Rs(a,d)},[4,Tn(e)];case 1:return[2,o.apply(void 0,[s.sent(),e.asyncQueue,t,n,i])]}})})}),i.promise}function Tl(e,t,n){var r=this;n===void 0&&(n={});var i=new yt;return e.asyncQueue.enqueueAndForget(function(){return m(r,void 0,void 0,function(){var o;return g(this,function(s){switch(s.label){case 0:return o=function(a,u,c,h,f){var l=new ki({next:function(p){u.enqueueAndForget(function(){return Os(a,d)}),p.fromCache&&h.source==="server"?f.reject(new b(y.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(p)},error:function(p){return f.reject(p)}}),d=new ks(c,l,{includeMetadataChanges:!0,so:!0});return Rs(a,d)},[4,Tn(e)];case 1:return[2,o.apply(void 0,[s.sent(),e.asyncQueue,t,n,i])]}})})}),i.promise}var Ay=function(e,t,n,r,i,o,s,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},Li=function(){function e(t,n){this.projectId=t,this.database=n||"(default)"}return Object.defineProperty(e.prototype,"isDefaultDatabase",{get:function(){return this.database==="(default)"},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database},e}(),Sl=new Map,Al=function(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+e},Dl=function(){function e(){this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(null)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t,n){this.changeListener=n,t.enqueueRetryable(function(){return n(ht.UNAUTHENTICATED)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),Dy=function(){function e(t){this.token=t,this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(this.token)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t,n){var r=this;this.changeListener=n,t.enqueueRetryable(function(){return n(r.token.user)})},e.prototype.removeChangeListener=function(){this.changeListener=null},e}(),Ny=function(){function e(t){var n=this;this.currentUser=ht.UNAUTHENTICATED,this.oc=new yt,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){n.cc++,n.currentUser=n.ac(),n.oc.resolve(),n.changeListener&&n.asyncQueue.enqueueRetryable(function(){return n.changeListener(n.currentUser)})};var r=function(i){I("FirebaseCredentialsProvider","Auth detected"),n.auth=i,n.auth.addAuthTokenListener(n.uc)};t.onInit(function(i){return r(i)}),setTimeout(function(){if(!n.auth){var i=t.getImmediate({optional:!0});i?r(i):(I("FirebaseCredentialsProvider","Auth not yet detected"),n.oc.resolve())}},0)}return e.prototype.getToken=function(){var t=this,n=this.cc,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then(function(i){return t.cc!==n?(I("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):i?(O(typeof i.accessToken=="string"),new Al(i.accessToken,t.currentUser)):null}):Promise.resolve(null)},e.prototype.invalidateToken=function(){this.forceRefresh=!0},e.prototype.setChangeListener=function(t,n){var r=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return m(r,void 0,void 0,function(){return g(this,function(i){switch(i.label){case 0:return[4,this.oc.promise];case 1:return i.sent(),[4,n(this.currentUser)];case 2:return i.sent(),this.changeListener=n,[2]}})})})},e.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},e.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return O(t===null||typeof t=="string"),new ht(t)},e}(),Cy=function(){function e(t,n,r){this.hc=t,this.lc=n,this.fc=r,this.type="FirstParty",this.user=ht.FIRST_PARTY}return Object.defineProperty(e.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},n=this.hc.auth.getAuthHeaderValueForFirstParty([]);return n&&(t.Authorization=n),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),e}(),Ry=function(){function e(t,n,r){this.hc=t,this.lc=n,this.fc=r}return e.prototype.getToken=function(){return Promise.resolve(new Cy(this.hc,this.lc,this.fc))},e.prototype.setChangeListener=function(t,n){t.enqueueRetryable(function(){return n(ht.FIRST_PARTY)})},e.prototype.removeChangeListener=function(){},e.prototype.invalidateToken=function(){},e}();function Ks(e,t,n){if(!n)throw new b(y.INVALID_ARGUMENT,"Function "+e+"() cannot be called with an empty "+t+".")}function zs(e,t){if(t===void 0)return{merge:!1};if(t.mergeFields!==void 0&&t.merge!==void 0)throw new b(y.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" and "mergeFields".');return t}function Nl(e,t,n,r){if(t===!0&&r===!0)throw new b(y.INVALID_ARGUMENT,e+" and "+n+" cannot be used together.")}function Cl(e){if(!C.isDocumentKey(e))throw new b(y.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e+" has "+e.length+".")}function Rl(e){if(C.isDocumentKey(e))throw new b(y.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e+" has "+e.length+".")}function Mi(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";var t=function(n){if(n.constructor){var r=/function\s+([^\s(]+)\s*\(/.exec(n.constructor.toString());if(r&&r.length>1)return r[1]}return null}(e);return t?"a custom "+t+" object":"an object"}return typeof e=="function"?"a function":N()}function j(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new b(y.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Mi(e);throw new b(y.INVALID_ARGUMENT,"Expected type '"+t.name+"', but it was: "+n)}return e}function Ol(e,t){if(t<=0)throw new b(y.INVALID_ARGUMENT,"Function "+e+"() requires a positive number, but it was: "+t+".")}var xl=function(){function e(t){var n;if(t.host===void 0){if(t.ssl!==void 0)throw new b(y.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(n=t.ssl)===null||n===void 0||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new b(y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Nl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return e.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},e}(),pr=function(){function e(t,n){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xl({}),this._settingsFrozen=!1,t instanceof Li?(this._databaseId=t,this._credentials=new Dl):(this._app=t,this._databaseId=function(r){if(!Object.prototype.hasOwnProperty.apply(r.options,["projectId"]))throw new b(y.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Li(r.options.projectId)}(t),this._credentials=new Ny(n))}return Object.defineProperty(e.prototype,"app",{get:function(){if(!this._app)throw new b(y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_terminated",{get:function(){return this._terminateTask!==void 0},enumerable:!1,configurable:!0}),e.prototype._setSettings=function(t){if(this._settingsFrozen)throw new b(y.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xl(t),t.credentials!==void 0&&(this._credentials=function(n){if(!n)return new Dl;switch(n.type){case"gapi":var r=n.client;return O(!(typeof r!="object"||r===null||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new Ry(r,n.sessionIndex||"0",n.iamToken||null);case"provider":return n.client;default:throw new b(y.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},e.prototype._getSettings=function(){return this._settings},e.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},e.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},e.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},e.prototype._terminate=function(){return t=this,(n=Sl.get(t))&&(I("ComponentProvider","Removing Datastore"),Sl.delete(t),n.terminate()),Promise.resolve();var t,n},e}(),H=function(){function e(t,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=t}return Object.defineProperty(e.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new fe(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._key)},e}(),xt=function(){function e(t,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=t}return e.prototype.withConverter=function(t){return new e(this.firestore,t,this._query)},e}(),fe=function(e){function t(n,r,i){var o=this;return(o=e.call(this,n,r,en(i))||this)._path=i,o.type="collection",o}return R(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var n=this._path.popLast();return n.isEmpty()?null:new H(this.firestore,null,new C(n))},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(n){return new t(this.firestore,n,this._path)},t}(xt);function kl(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e=W(e),Ks("collection","path",t),e instanceof pr)return Rl(n=U.fromString.apply(U,z([t],r))),new fe(e,null,n);if(!(e instanceof H||e instanceof fe))throw new b(y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Rl(n=U.fromString.apply(U,z([e.path],r)).child(U.fromString(t))),new fe(e.firestore,null,n)}function Fi(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e=W(e),arguments.length===1&&(t=pc.u()),Ks("doc","path",t),e instanceof pr)return Cl(n=U.fromString.apply(U,z([t],r))),new H(e,null,new C(n));if(!(e instanceof H||e instanceof fe))throw new b(y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Cl(n=e._path.child(U.fromString.apply(U,z([t],r)))),new H(e.firestore,e instanceof fe?e.converter:null,new C(n))}function Pl(e,t){return e=W(e),t=W(t),(e instanceof H||e instanceof fe)&&(t instanceof H||t instanceof fe)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function Ll(e,t){return e=W(e),t=W(t),e instanceof xt&&t instanceof xt&&e.firestore===t.firestore&&er(e._query,t._query)&&e.converter===t.converter}var Oy=function(){function e(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new Ss(this,"async_queue_retry"),this.Ic=function(){var r=Ni();r&&I("AsyncQueue","Visibility state changed to "+r.visibilityState),t.Zi.Gi()};var n=Ni();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(e.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),e.prototype.enqueueAndForget=function(t){this.enqueue(t)},e.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},e.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var n=Ni();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Ic)}},e.prototype.enqueue=function(t){var n=this;if(this.Ac(),this._c)return new Promise(function(){});var r=new yt;return this.Rc(function(){return n._c&&n.Ec?Promise.resolve():(t().then(r.resolve,r.reject),r.promise)}).then(function(){return r.promise})},e.prototype.enqueueRetryable=function(t){var n=this;this.enqueueAndForget(function(){return n.wc.push(t),n.bc()})},e.prototype.bc=function(){return m(this,void 0,void 0,function(){var t,n=this;return g(this,function(r){switch(r.label){case 0:if(this.wc.length===0)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return r.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Re(t=r.sent()))throw t;return I("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return n.bc()}),r.label=5;case 5:return[2]}})})},e.prototype.Rc=function(t){var n=this,r=this.dc.then(function(){return n.gc=!0,t().catch(function(i){throw n.yc=i,n.gc=!1,X("INTERNAL UNHANDLED ERROR: ",function(o){var s=o.message||"";return o.stack&&(s=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),s}(i)),i}).then(function(i){return n.gc=!1,i})});return this.dc=r,r},e.prototype.enqueueAfterDelay=function(t,n,r){var i=this;this.Ac(),this.Tc.indexOf(t)>-1&&(n=0);var o=Yv.createAndSchedule(this,t,n,r,function(s){return i.vc(s)});return this.mc.push(o),o},e.prototype.Ac=function(){this.yc&&N()},e.prototype.verifyOperationInProgress=function(){},e.prototype.Pc=function(){return m(this,void 0,void 0,function(){var t;return g(this,function(n){switch(n.label){case 0:return[4,t=this.dc];case 1:n.sent(),n.label=2;case 2:if(t!==this.dc)return[3,0];n.label=3;case 3:return[2]}})})},e.prototype.Vc=function(t){for(var n=0,r=this.mc;n<r.length;n++)if(r[n].timerId===t)return!0;return!1},e.prototype.Sc=function(t){var n=this;return this.Pc().then(function(){n.mc.sort(function(s,a){return s.targetTimeMs-a.targetTimeMs});for(var r=0,i=n.mc;r<i.length;r++){var o=i[r];if(o.skipDelay(),t!=="all"&&o.timerId===t)break}return n.Pc()})},e.prototype.Dc=function(t){this.Tc.push(t)},e.prototype.vc=function(t){var n=this.mc.indexOf(t);this.mc.splice(n,1)},e}();function Sn(e){return function(t,n){if(typeof t!="object"||t===null)return!1;for(var r=t,i=0,o=["next","error","complete"];i<o.length;i++){var s=o[i];if(s in r&&typeof r[s]=="function")return!0}return!1}(e)}var Hg=function(){function e(){this._progressObserver={},this._taskCompletionResolver=new yt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return e.prototype.onProgress=function(t,n,r){this._progressObserver={next:t,error:n,complete:r}},e.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},e.prototype.then=function(t,n){return this._taskCompletionResolver.promise.then(t,n)},e.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},e.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},e.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)},e}(),Ml=-1,Z=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this).type="firestore",i._queue=new Oy,i._persistenceKey="name"in n?n.name:"[DEFAULT]",i}return R(t,e),t.prototype._terminate=function(){return this._firestoreClient||Fl(this),this._firestoreClient.terminate()},t}(pr);function gt(e){return e._firestoreClient||Fl(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Fl(e){var t,n=e._freezeSettings(),r=function(i,o,s,a){return new Ay(i,o,s,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams)}(e._databaseId,((t=e._app)===null||t===void 0?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Sy(e._credentials,e._queue,r)}function Vl(e,t,n){var r=this,i=new yt;return e.asyncQueue.enqueue(function(){return m(r,void 0,void 0,function(){var o;return g(this,function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,gl(e,n)];case 1:return s.sent(),[4,ml(e,t)];case 2:return s.sent(),i.resolve(),[3,4];case 3:if(!function(a){return a.name==="FirebaseError"?a.code===y.FAILED_PRECONDITION||a.code===y.UNIMPLEMENTED:!(typeof DOMException!="undefined"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11}(o=s.sent()))throw o;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+o),i.reject(o),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function Ul(e){if(e._initialized||e._terminated)throw new b(y.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Gt=function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=0;r<t.length;++r)if(t[r].length===0)throw new b(y.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Vt(t)}return e.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},e}(),ke=function(){function e(t){this._byteString=t}return e.fromBase64String=function(t){try{return new e(Et.fromBase64String(t))}catch(n){throw new b(y.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}},e.fromUint8Array=function(t){return new e(Et.fromUint8Array(t))},e.prototype.toBase64=function(){return this._byteString.toBase64()},e.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},e.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},e.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},e}(),Pe=function(e){this._methodName=e},vr=function(){function e(t,n){if(!isFinite(t)||t<-90||t>90)throw new b(y.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new b(y.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return Object.defineProperty(e.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},e.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},e.prototype._compareTo=function(t){return L(this._lat,t._lat)||L(this._long,t._long)},e}(),xy=/^__.*__$/,ky=function(){function e(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}return e.prototype.toMutation=function(t,n){return this.fieldMask!==null?new re(t,this.data,this.fieldMask,n,this.fieldTransforms):new ir(t,this.data,n,this.fieldTransforms)},e}(),jl=function(){function e(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}return e.prototype.toMutation=function(t,n){return new re(t,this.data,this.fieldMask,n,this.fieldTransforms)},e}();function ql(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw N()}}var Bl=function(){function e(t,n,r,i,o,s){this.settings=t,this.databaseId=n,this.R=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Cc(),this.fieldTransforms=o||[],this.fieldMask=s||[]}return Object.defineProperty(e.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),e.prototype.xc=function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},e.prototype.kc=function(t){var n,r=(n=this.path)===null||n===void 0?void 0:n.child(t),i=this.xc({path:r,Fc:!1});return i.$c(t),i},e.prototype.Oc=function(t){var n,r=(n=this.path)===null||n===void 0?void 0:n.child(t),i=this.xc({path:r,Fc:!1});return i.Cc(),i},e.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},e.prototype.Lc=function(t){return Ui(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},e.prototype.contains=function(t){return this.fieldMask.find(function(n){return t.isPrefixOf(n)})!==void 0||this.fieldTransforms.find(function(n){return t.isPrefixOf(n.field)})!==void 0},e.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},e.prototype.$c=function(t){if(t.length===0)throw this.Lc("Document fields must not be empty");if(ql(this.Nc)&&xy.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},e}(),Py=function(){function e(t,n,r){this.databaseId=t,this.ignoreUndefinedProperties=n,this.R=r||Ci(t)}return e.prototype.Uc=function(t,n,r,i){return i===void 0&&(i=!1),new Bl({Nc:t,methodName:n,qc:r,path:Vt.emptyPath(),Fc:!1,Bc:i},this.databaseId,this.R,this.ignoreUndefinedProperties)},e}();function Le(e){var t=e._freezeSettings(),n=Ci(e._databaseId);return new Py(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Vi(e,t,n,r,i,o){o===void 0&&(o={});var s=e.Uc(o.merge||o.mergeFields?2:0,t,n,i);Ws("Data must be an object, but it was:",s,r);var a,u,c=Gl(r,s);if(o.merge)a=new $e(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var d=Ys(t,l[f],n);if(!s.contains(d))throw new b(y.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Ql(h,d)||h.push(d)}a=new $e(h),u=s.fieldTransforms.filter(function(p){return a.covers(p.field)})}else a=null,u=s.fieldTransforms;return new ky(new Nt(c),a,u)}var Gs=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype._toFieldTransform=function(n){if(n.Nc!==2)throw n.Nc===1?n.Lc(this._methodName+"() can only appear at the top level of your update data"):n.Lc(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return n.fieldMask.push(n.path),null},t.prototype.isEqual=function(n){return n instanceof t},t}(Pe);function Kl(e,t,n){return new Bl({Nc:3,qc:t.settings.qc,methodName:e._methodName,Fc:n},t.databaseId,t.R,t.ignoreUndefinedProperties)}var Ly=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype._toFieldTransform=function(n){return new rr(n.path,new rn)},t.prototype.isEqual=function(n){return n instanceof t},t}(Pe),My=function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).Kc=r,i}return R(t,e),t.prototype._toFieldTransform=function(n){var r=Kl(this,n,!0),i=this.Kc.map(function(s){return Me(s,r)}),o=new De(i);return new rr(n.path,o)},t.prototype.isEqual=function(n){return this===n},t}(Pe),Fy=function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).Kc=r,i}return R(t,e),t.prototype._toFieldTransform=function(n){var r=Kl(this,n,!0),i=this.Kc.map(function(s){return Me(s,r)}),o=new Ne(i);return new rr(n.path,o)},t.prototype.isEqual=function(n){return this===n},t}(Pe),Vy=function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).Qc=r,i}return R(t,e),t.prototype._toFieldTransform=function(n){var r=new on(n.R,Lc(n.R,this.Qc));return new rr(n.path,r)},t.prototype.isEqual=function(n){return this===n},t}(Pe);function Hs(e,t,n,r){var i=e.Uc(1,t,n);Ws("Data must be an object, but it was:",i,r);var o=[],s=Nt.empty();Te(r,function(u,c){var h=Xs(t,u,n);c=W(c);var f=i.Oc(h);if(c instanceof Gs)o.push(h);else{var l=Me(c,f);l!=null&&(o.push(h),s.set(h,l))}});var a=new $e(o);return new jl(s,a,i.fieldTransforms)}function Qs(e,t,n,r,i,o){var s=e.Uc(1,t,n),a=[Ys(t,r,n)],u=[i];if(o.length%2!=0)throw new b(y.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Ys(t,o[c])),u.push(o[c+1]);for(var h=[],f=Nt.empty(),l=a.length-1;l>=0;--l)if(!Ql(h,a[l])){var d=a[l],p=u[l];p=W(p);var v=s.Oc(d);if(p instanceof Gs)h.push(d);else{var w=Me(p,v);w!=null&&(h.push(d),f.set(d,w))}}var E=new $e(h);return new jl(f,E,s.fieldTransforms)}function zl(e,t,n,r){return r===void 0&&(r=!1),Me(n,e.Uc(r?4:3,t))}function Me(e,t){if(Hl(e=W(e)))return Ws("Unsupported field value:",t,e),Gl(e,t);if(e instanceof Pe)return function(n,r){if(!ql(r.Nc))throw r.Lc(n._methodName+"() can only be used with update() and set()");if(!r.path)throw r.Lc(n._methodName+"() is not currently supported inside arrays");var i=n._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(e,t),null;if(e===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Fc&&t.Nc!==4)throw t.Lc("Nested arrays are not supported");return function(n,r){for(var i=[],o=0,s=0,a=n;s<a.length;s++){var u=Me(a[s],r.Mc(o));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),o++}return{arrayValue:{values:i}}}(e,t)}return function(n,r){if((n=W(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Lc(r.R,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){var i=_t.fromDate(n);return{timestampValue:sr(r.R,i)}}if(n instanceof _t)return i=new _t(n.seconds,1e3*Math.floor(n.nanoseconds/1e3)),{timestampValue:sr(r.R,i)};if(n instanceof vr)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof ke)return{bytesValue:eh(r.R,n._byteString)};if(n instanceof H){i=r.databaseId;var o=n.firestore._databaseId;if(!o.isEqual(i))throw r.Lc("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:hs(n.firestore._databaseId||r.databaseId,n._key.path)}}throw r.Lc("Unsupported field value: "+Mi(n))}(e,t)}function Gl(e,t){var n={};return gc(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Te(e,function(r,i){var o=Me(i,t.kc(r));o!=null&&(n[r]=o)}),{mapValue:{fields:n}}}function Hl(e){return!(typeof e!="object"||e===null||e instanceof Array||e instanceof Date||e instanceof _t||e instanceof vr||e instanceof ke||e instanceof H||e instanceof Pe)}function Ws(e,t,n){if(!Hl(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){var r=Mi(n);throw r==="an object"?t.Lc(e+" a custom object"):t.Lc(e+" "+r)}}function Ys(e,t,n){if((t=W(t))instanceof Gt)return t._internalPath;if(typeof t=="string")return Xs(e,t);throw Ui("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}var Uy=new RegExp("[~\\*/\\[\\]]");function Xs(e,t,n){if(t.search(Uy)>=0)throw Ui("Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,n);try{return new(Gt.bind.apply(Gt,z([void 0],t.split("."))))()._internalPath}catch(r){throw Ui("Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,n)}}function Ui(e,t,n,r,i){var o=r&&!r.isEmpty(),s=i!==void 0,a="Function "+t+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new b(y.INVALID_ARGUMENT,(a+=". ")+e+u)}function Ql(e,t){return e.some(function(n){return n.isEqual(t)})}var yr=function(){function e(t,n,r,i,o){this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}return Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new H(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),e.prototype.exists=function(){return this._document!==null},e.prototype.data=function(){if(this._document){if(this._converter){var t=new jy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},e.prototype.get=function(t){if(this._document){var n=this._document.data.field(ji("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n)}},e}(),jy=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.data=function(){return e.prototype.data.call(this)},t}(yr);function ji(e,t){return typeof t=="string"?Xs(e,t):t instanceof Gt?t._internalPath:t._delegate._internalPath}var Fe=function(){function e(t,n){this.hasPendingWrites=t,this.fromCache=n}return e.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},e}(),$t=function(e){function t(n,r,i,o,s,a){var u=this;return(u=e.call(this,n,r,i,o,a)||this)._firestore=n,u._firestoreImpl=n,u.metadata=s,u}return R(t,e),t.prototype.exists=function(){return e.prototype.exists.call(this)},t.prototype.data=function(n){if(n===void 0&&(n={}),this._document){if(this._converter){var r=new gr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,n)}return this._userDataWriter.convertValue(this._document.data.value,n.serverTimestamps)}},t.prototype.get=function(n,r){if(r===void 0&&(r={}),this._document){var i=this._document.data.field(ji("DocumentSnapshot.get",n));if(i!==null)return this._userDataWriter.convertValue(i,r.serverTimestamps)}},t}(yr),gr=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.data=function(n){return n===void 0&&(n={}),e.prototype.data.call(this,n)},t}($t),de=function(){function e(t,n,r,i){this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new Fe(i.hasPendingWrites,i.fromCache),this.query=r}return Object.defineProperty(e.prototype,"docs",{get:function(){var t=[];return this.forEach(function(n){return t.push(n)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this.size===0},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t,n){var r=this;this._snapshot.docs.forEach(function(i){t.call(n,new gr(r._firestore,r._userDataWriter,i.key,i,new Fe(r._snapshot.mutatedKeys.has(i.key),r._snapshot.fromCache),r.query.converter))})},e.prototype.docChanges=function(t){t===void 0&&(t={});var n=!!t.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new b(y.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){var o=0;return r._snapshot.docChanges.map(function(a){return{type:"added",doc:new gr(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Fe(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:o++}})}var s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(function(a){return i||a.type!==3}).map(function(a){var u=new gr(r._firestore,r._userDataWriter,a.doc.key,a.doc,new Fe(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter),c=-1,h=-1;return a.type!==0&&(c=s.indexOf(a.doc.key),s=s.delete(a.doc.key)),a.type!==1&&(h=(s=s.add(a.doc)).indexOf(a.doc.key)),{type:qy(a.type),doc:u,oldIndex:c,newIndex:h}})}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges},e}();function qy(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return N()}}function Wl(e,t){return e instanceof $t&&t instanceof $t?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(e._document===null?t._document===null:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof de&&t instanceof de&&e._firestore===t._firestore&&Ll(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function Yl(e){if(di(e)&&e.explicitOrderBy.length===0)throw new b(y.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var mr=function(){};function pe(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){var o=i[r];e=o._apply(e)}return e}var By=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).jc=n,o.Wc=r,o.Gc=i,o.type="where",o}return R(t,e),t.prototype._apply=function(n){var r=Le(n.firestore),i=function(o,s,a,u,c,h,f){var l;if(c.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new b(y.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+h+"' queries on FieldPath.documentId().");if(h==="in"||h==="not-in"){ef(f,h);for(var d=[],p=0,v=f;p<v.length;p++){var w=v[p];d.push(tf(u,o,w))}l={arrayValue:{values:d}}}else l=tf(u,o,f)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||ef(f,h),l=zl(a,"where",f,h==="in"||h==="not-in");var E=Ct.create(c,h,l);return function(A,D){if(D.g()){var k=ns(A);if(k!==null&&!k.isEqual(D.field))throw new b(y.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+k.toString()+"' and '"+D.field.toString()+"'");var M=es(A);M!==null&&nf(A,D.field,M)}var q=function(rt,Hi){for(var Nn=0,ia=rt.filters;Nn<ia.length;Nn++){var oa=ia[Nn];if(Hi.indexOf(oa.op)>=0)return oa.op}return null}(A,function(rt){switch(rt){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(D.op));if(q!==null)throw q===D.op?new b(y.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+D.op.toString()+"' filter."):new b(y.INVALID_ARGUMENT,"Invalid query. You cannot use '"+D.op.toString()+"' filters with '"+q.toString()+"' filters.")}(o,E),E}(n._query,0,r,n.firestore._databaseId,this.jc,this.Wc,this.Gc);return new xt(n.firestore,n.converter,function(o,s){var a=o.filters.concat([s]);return new Wt(o.path,o.collectionGroup,o.explicitOrderBy.slice(),a,o.limit,o.limitType,o.startAt,o.endAt)}(n._query,i))},t}(mr),Ky=function(e){function t(n,r){var i=this;return(i=e.call(this)||this).jc=n,i.zc=r,i.type="orderBy",i}return R(t,e),t.prototype._apply=function(n){var r=function(i,o,s){if(i.startAt!==null)throw new b(y.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new b(y.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var a=new tn(o,s);return function(u,c){if(es(u)===null){var h=ns(u);h!==null&&nf(u,h,c.field)}}(i,a),a}(n._query,this.jc,this.zc);return new xt(n.firestore,n.converter,function(i,o){var s=i.explicitOrderBy.concat([o]);return new Wt(i.path,i.collectionGroup,s,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(n._query,r))},t}(mr),Xl=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Hc=r,o.Jc=i,o}return R(t,e),t.prototype._apply=function(n){return new xt(n.firestore,n.converter,Rc(n._query,this.Hc,this.Jc))},t}(mr),$l=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Yc=r,o.Xc=i,o}return R(t,e),t.prototype._apply=function(n){var r=Zl(n,this.type,this.Yc,this.Xc);return new xt(n.firestore,n.converter,function(i,o){return new Wt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,o,i.endAt)}(n._query,r))},t}(mr),Jl=function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Yc=r,o.Xc=i,o}return R(t,e),t.prototype._apply=function(n){var r=Zl(n,this.type,this.Yc,this.Xc);return new xt(n.firestore,n.converter,function(i,o){return new Wt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,o)}(n._query,r))},t}(mr);function Zl(e,t,n,r){if(n[0]=W(n[0]),n[0]instanceof yr)return function(o,s,a,u,c){if(!u)throw new b(y.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+a+"().");for(var h=[],f=0,l=nn(o);f<l.length;f++){var d=l[f];if(d.field.isKeyField())h.push(ai(s,u.key));else{var p=u.data.field(d.field);if(Xo(p))throw new b(y.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+d.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(p===null){var v=d.field.canonicalString();throw new b(y.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+v+"' (used as the orderBy) does not exist.")}h.push(p)}}return new tr(h,c)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=Le(e.firestore);return function(o,s,a,u,c,h){var f=o.explicitOrderBy;if(c.length>f.length)throw new b(y.INVALID_ARGUMENT,"Too many arguments provided to "+u+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var l=[],d=0;d<c.length;d++){var p=c[d];if(f[d].field.isKeyField()){if(typeof p!="string")throw new b(y.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+u+"(), but got a "+typeof p);if(!rs(o)&&p.indexOf("/")!==-1)throw new b(y.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+u+"() must be a plain document ID, but '"+p+"' contains a slash.");var v=o.path.child(U.fromString(p));if(!C.isDocumentKey(v))throw new b(y.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+u+"() must result in a valid document path, but '"+v+"' is not because it contains an odd number of segments.");var w=new C(v);l.push(ai(s,w))}else{var E=zl(a,u,p);l.push(E)}}return new tr(l,h)}(e._query,e.firestore._databaseId,i,t,n,r)}function tf(e,t,n){if(typeof(n=W(n))=="string"){if(n==="")throw new b(y.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!rs(t)&&n.indexOf("/")!==-1)throw new b(y.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=t.path.child(U.fromString(n));if(!C.isDocumentKey(r))throw new b(y.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return ai(e,new C(r))}if(n instanceof H)return ai(e,n._key);throw new b(y.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Mi(n)+".")}function ef(e,t){if(!Array.isArray(e)||e.length===0)throw new b(y.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+t.toString()+"' filters.");if(e.length>10)throw new b(y.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a maximum of 10 elements in the value array.")}function nf(e,t,n){if(!n.isEqual(t))throw new b(y.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var $s=function(){function e(){}return e.prototype.convertValue=function(t,n){switch(n===void 0&&(n="none"),Ae(t)){case 0:return null;case 1:return t.booleanValue;case 2:return $(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,n);case 5:return t.stringValue;case 6:return this.convertBytes(Je(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,n);case 10:return this.convertObject(t.mapValue,n);default:throw N()}},e.prototype.convertObject=function(t,n){var r=this,i={};return Te(t.fields,function(o,s){i[o]=r.convertValue(s,n)}),i},e.prototype.convertGeoPoint=function(t){return new vr($(t.latitude),$(t.longitude))},e.prototype.convertArray=function(t,n){var r=this;return(t.values||[]).map(function(i){return r.convertValue(i,n)})},e.prototype.convertServerTimestamp=function(t,n){switch(n){case"previous":var r=wc(t);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Xn(t));default:return null}},e.prototype.convertTimestamp=function(t){var n=ne(t);return new _t(n.seconds,n.nanos)},e.prototype.convertDocumentKey=function(t,n){var r=U.fromString(t);O(ph(r));var i=new Li(r.get(1),r.get(3)),o=new C(r.popFirst(5));return i.isEqual(n)||X("Document "+o+" contains a document reference within a different database ("+i.projectId+"/"+i.database+") which is not supported. It will be treated as a reference in the current database ("+n.projectId+"/"+n.database+") instead."),o},e}();function qi(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var zy=function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return R(t,e),t.prototype.convertBytes=function(n){return new ke(n)},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return new H(this.firestore,null,r)},t}($s),Gy=function(){function e(t,n){this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Le(t)}return e.prototype.set=function(t,n,r){this._verifyNotCommitted();var i=ve(t,this._firestore),o=qi(i.converter,n,r),s=Vi(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(s.toMutation(i._key,dt.none())),this},e.prototype.update=function(t,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];this._verifyNotCommitted();var s,a=ve(t,this._firestore);return s=typeof(n=W(n))=="string"||n instanceof Gt?Qs(this._dataReader,"WriteBatch.update",a._key,n,r,i):Hs(this._dataReader,"WriteBatch.update",a._key,n),this._mutations.push(s.toMutation(a._key,dt.exists(!0))),this},e.prototype.delete=function(t){this._verifyNotCommitted();var n=ve(t,this._firestore);return this._mutations=this._mutations.concat(new or(n._key,dt.none())),this},e.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},e.prototype._verifyNotCommitted=function(){if(this._committed)throw new b(y.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},e}();function ve(e,t){if((e=W(e)).firestore!==t)throw new b(y.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}var Ve=function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return R(t,e),t.prototype.convertBytes=function(n){return new ke(n)},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return new H(this.firestore,null,r)},t}($s);function rf(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e=j(e,H);var o=j(e.firestore,Z),s=Le(o);return wr(o,[(typeof(t=W(t))=="string"||t instanceof Gt?Qs(s,"updateDoc",e._key,t,n,r):Hs(s,"updateDoc",e._key,t)).toMutation(e._key,dt.exists(!0))])}function of(e){for(var t,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];e=W(e);var s={includeMetadataChanges:!1},a=0;typeof i[a]!="object"||Sn(i[a])||(s=i[a],a++);var u,c,h,f={includeMetadataChanges:s.includeMetadataChanges};if(Sn(i[a])){var l=i[a];i[a]=(t=l.next)===null||t===void 0?void 0:t.bind(l),i[a+1]=(n=l.error)===null||n===void 0?void 0:n.bind(l),i[a+2]=(r=l.complete)===null||r===void 0?void 0:r.bind(l)}if(e instanceof H)c=j(e.firestore,Z),h=en(e._key.path),u={next:function(v){i[a]&&i[a](Js(c,e,v))},error:i[a+1],complete:i[a+2]};else{var d=j(e,xt);c=j(d.firestore,Z),h=d._query;var p=new Ve(c);u={next:function(v){i[a]&&i[a](new de(c,p,d,v))},error:i[a+1],complete:i[a+2]},Yl(e._query)}return function(v,w,E,A){var D=this,k=new ki(A),M=new ks(w,k,E);return v.asyncQueue.enqueueAndForget(function(){return m(D,void 0,void 0,function(){var q;return g(this,function(rt){switch(rt.label){case 0:return q=Rs,[4,Tn(v)];case 1:return[2,q.apply(void 0,[rt.sent(),M])]}})})}),function(){k.Wo(),v.asyncQueue.enqueueAndForget(function(){return m(D,void 0,void 0,function(){var q;return g(this,function(rt){switch(rt.label){case 0:return q=Os,[4,Tn(v)];case 1:return[2,q.apply(void 0,[rt.sent(),M])]}})})})}}(gt(c),h,f,u)}function wr(e,t){return function(n,r){var i=this,o=new yt;return n.asyncQueue.enqueueAndForget(function(){return m(i,void 0,void 0,function(){var s;return g(this,function(a){switch(a.label){case 0:return s=ay,[4,El(n)];case 1:return[2,s.apply(void 0,[a.sent(),r,o])]}})})}),o.promise}(gt(e),t)}function Js(e,t,n){var r=n.docs.get(t._key),i=new Ve(e);return new $t(e,i,t._key,r,new Fe(n.hasPendingWrites,n.fromCache),t.converter)}var Hy=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this)._firestore=n,i}return R(t,e),t.prototype.get=function(n){var r=this,i=ve(n,this._firestore),o=new Ve(this._firestore);return e.prototype.get.call(this,n).then(function(s){return new $t(r._firestore,o,i._key,s._document,new Fe(!1,!1),i.converter)})},t}(function(){function e(t,n){this._firestore=t,this._transaction=n,this._dataReader=Le(t)}return e.prototype.get=function(t){var n=this,r=ve(t,this._firestore),i=new zy(this._firestore);return this._transaction.lookup([r._key]).then(function(o){if(!o||o.length!==1)return N();var s=o[0];if(s.isFoundDocument())return new yr(n._firestore,i,s.key,s,r.converter);if(s.isNoDocument())return new yr(n._firestore,i,r._key,null,r.converter);throw N()})},e.prototype.set=function(t,n,r){var i=ve(t,this._firestore),o=qi(i.converter,n,r),s=Vi(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,r);return this._transaction.set(i._key,s),this},e.prototype.update=function(t,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s,a=ve(t,this._firestore);return s=typeof(n=W(n))=="string"||n instanceof Gt?Qs(this._dataReader,"Transaction.update",a._key,n,r,i):Hs(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,s),this},e.prototype.delete=function(t){var n=ve(t,this._firestore);return this._transaction.delete(n._key),this},e}());function sf(){if(typeof Uint8Array=="undefined")throw new b(y.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function af(){if(typeof atob=="undefined")throw new b(y.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Zs=function(){function e(t){this._delegate=t}return e.fromBase64String=function(t){return af(),new e(ke.fromBase64String(t))},e.fromUint8Array=function(t){return sf(),new e(ke.fromUint8Array(t))},e.prototype.toBase64=function(){return af(),this._delegate.toBase64()},e.prototype.toUint8Array=function(){return sf(),this._delegate.toUint8Array()},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e}(),uf=function(){function e(){}return e.prototype.enableIndexedDbPersistence=function(t,n){return function(r,i){Ul(r=j(r,Z));var o=gt(r),s=r._freezeSettings(),a=new qs;return Vl(o,a,new yl(a,s.cacheSizeBytes,i==null?void 0:i.forceOwnership))}(t._delegate,{forceOwnership:n})},e.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(n){Ul(n=j(n,Z));var r=gt(n),i=n._freezeSettings(),o=new qs;return Vl(r,o,new Ey(o,i.cacheSizeBytes))}(t._delegate)},e.prototype.clearIndexedDbPersistence=function(t){return function(n){var r=this;if(n._initialized&&!n._terminated)throw new b(y.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var i=new yt;return n._queue.enqueueAndForgetEvenWhileRestricted(function(){return m(r,void 0,void 0,function(){var o;return g(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,function(a){return m(this,void 0,void 0,function(){var u;return g(this,function(c){switch(c.label){case 0:return hn.yt()?(u=a+"main",[4,hn.delete(u)]):[2,Promise.resolve()];case 1:return c.sent(),[2]}})})}(ws(n._databaseId,n._persistenceKey))];case 1:return s.sent(),i.resolve(),[3,3];case 2:return o=s.sent(),i.reject(o),[3,3];case 3:return[2]}})})}),i.promise}(t._delegate)},e}(),ta=function(){function e(t,n,r){var i=this;this._delegate=n,this.Zc=r,this.INTERNAL={delete:function(){return i.terminate()}},t instanceof Li||(this.tu=t)}return Object.defineProperty(e.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),e.prototype.settings=function(t){var n=this._delegate._getSettings();t.merge||n.host===t.host||oi("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},n),t)).merge,this._delegate._setSettings(t)},e.prototype.useEmulator=function(t,n,r){r===void 0&&(r={}),function(i,o,s,a){var u;a===void 0&&(a={});var c=(i=j(i,pr))._getSettings();if(c.host!=="firestore.googleapis.com"&&c.host!==o&&oi("Host has been set in both settings() and useEmulator(), emulator host will be used"),i._setSettings(Object.assign(Object.assign({},c),{host:o+":"+s,ssl:!1})),a.mockUserToken){var h,f;if(typeof a.mockUserToken=="string")h=a.mockUserToken,f=ht.MOCK_USER;else{h=xa(a.mockUserToken,(u=i._app)===null||u===void 0?void 0:u.options.projectId);var l=a.mockUserToken.sub||a.mockUserToken.user_id;if(!l)throw new b(y.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new ht(l)}i._credentials=new Dy(new Al(h,f))}}(this._delegate,t,n,r)},e.prototype.enableNetwork=function(){return function(t){var n=this;return t.asyncQueue.enqueue(function(){return m(n,void 0,void 0,function(){var r,i;return g(this,function(o){switch(o.label){case 0:return[4,wl(t)];case 1:return r=o.sent(),[4,_l(t)];case 2:return i=o.sent(),[2,(r.setNetworkEnabled(!0),function(s){var a=T(s);return a.Or.delete(0),fr(a)}(i))]}})})})}(gt(j(this._delegate,Z)))},e.prototype.disableNetwork=function(){return function(t){var n=this;return t.asyncQueue.enqueue(function(){return m(n,void 0,void 0,function(){var r,i;return g(this,function(o){switch(o.label){case 0:return[4,wl(t)];case 1:return r=o.sent(),[4,_l(t)];case 2:return i=o.sent(),[2,(r.setNetworkEnabled(!1),function(s){return m(this,void 0,void 0,function(){var a;return g(this,function(u){switch(u.label){case 0:return(a=T(s)).Or.add(0),[4,wn(a)];case 1:return u.sent(),a.Br.set("Offline"),[2]}})})}(i))]}})})})}(gt(j(this._delegate,Z)))},e.prototype.enablePersistence=function(t){var n=!1,r=!1;return t&&Nl("synchronizeTabs",n=!!t.synchronizeTabs,"experimentalForceOwningTab",r=!!t.experimentalForceOwningTab),n?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,r)},e.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},e.prototype.waitForPendingWrites=function(){return function(t){var n=this,r=new yt;return t.asyncQueue.enqueueAndForget(function(){return m(n,void 0,void 0,function(){var i;return g(this,function(o){switch(o.label){case 0:return i=ly,[4,El(t)];case 1:return[2,i.apply(void 0,[o.sent(),r])]}})})}),r.promise}(gt(j(this._delegate,Z)))},e.prototype.onSnapshotsInSync=function(t){return function(n,r){return function(i,o){var s=this,a=new ki(o);return i.asyncQueue.enqueueAndForget(function(){return m(s,void 0,void 0,function(){var u;return g(this,function(c){switch(c.label){case 0:return u=function(h,f){T(h).Gr.add(f),f.next()},[4,Tn(i)];case 1:return[2,u.apply(void 0,[c.sent(),a])]}})})}),function(){a.Wo(),i.asyncQueue.enqueueAndForget(function(){return m(s,void 0,void 0,function(){var u;return g(this,function(c){switch(c.label){case 0:return u=function(h,f){T(h).Gr.delete(f)},[4,Tn(i)];case 1:return[2,u.apply(void 0,[c.sent(),a])]}})})})}}(gt(n=j(n,Z)),Sn(r)?r:{next:r})}(this._delegate,t)},Object.defineProperty(e.prototype,"app",{get:function(){if(!this.tu)throw new b(y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new _r(this,kl(this._delegate,t))}catch(n){throw It(n,"collection()","Firestore.collection()")}},e.prototype.doc=function(t){try{return new ye(this,Fi(this._delegate,t))}catch(n){throw It(n,"doc()","Firestore.doc()")}},e.prototype.collectionGroup=function(t){try{return new br(this,function(n,r){if(n=j(n,pr),Ks("collectionGroup","collection id",r),r.indexOf("/")>=0)throw new b(y.INVALID_ARGUMENT,"Invalid collection ID '"+r+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new xt(n,null,function(i){return new Wt(U.emptyPath(),i)}(r))}(this._delegate,t))}catch(n){throw It(n,"collectionGroup()","Firestore.collectionGroup()")}},e.prototype.runTransaction=function(t){var n=this;return function(r,i){return function(o,s){var a=this,u=new yt;return o.asyncQueue.enqueueAndForget(function(){return m(a,void 0,void 0,function(){var c;return g(this,function(h){switch(h.label){case 0:return[4,function(f){return Pi(f).then(function(l){return l.datastore})}(o)];case 1:return c=h.sent(),new Ty(o.asyncQueue,c,s,u).run(),[2]}})})}),u.promise}(gt(r),function(o){return i(new Hy(r,o))})}(this._delegate,function(r){return t(new ea(n,r))})},e.prototype.batch=function(){var t=this;return gt(this._delegate),new na(new Gy(this._delegate,function(n){return wr(t._delegate,n)}))},e.prototype.loadBundle=function(t){throw new b(y.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},e.prototype.namedQuery=function(t){throw new b(y.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},e}(),Bi=function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return R(t,e),t.prototype.convertBytes=function(n){return new Zs(new ke(n))},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return ye.eu(r,this.firestore,null)},t}($s);function cf(e){var t;t=e,Ft.setLogLevel(t)}var ea=function(){function e(t,n){this._firestore=t,this._delegate=n,this._userDataWriter=new Bi(t)}return e.prototype.get=function(t){var n=this,r=Ue(t);return this._delegate.get(r).then(function(i){return new An(n._firestore,new $t(n._firestore._delegate,n._userDataWriter,i._key,i._document,i.metadata,r.converter))})},e.prototype.set=function(t,n,r){var i=Ue(t);return r?(zs("Transaction.set",r),this._delegate.set(i,n,r)):this._delegate.set(i,n),this},e.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=Ue(t);return arguments.length===2?this._delegate.update(a,n):(i=this._delegate).update.apply(i,z([a,n,r],o)),this},e.prototype.delete=function(t){var n=Ue(t);return this._delegate.delete(n),this},e}(),na=function(){function e(t){this._delegate=t}return e.prototype.set=function(t,n,r){var i=Ue(t);return r?(zs("WriteBatch.set",r),this._delegate.set(i,n,r)):this._delegate.set(i,n),this},e.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=Ue(t);return arguments.length===2?this._delegate.update(a,n):(i=this._delegate).update.apply(i,z([a,n,r],o)),this},e.prototype.delete=function(t){var n=Ue(t);return this._delegate.delete(n),this},e.prototype.commit=function(){return this._delegate.commit()},e}(),Ki=function(){function e(t,n,r){this._firestore=t,this._userDataWriter=n,this._delegate=r}return e.prototype.fromFirestore=function(t,n){var r=new gr(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Dn(this._firestore,r),n??{})},e.prototype.toFirestore=function(t,n){return n?this._delegate.toFirestore(t,n):this._delegate.toFirestore(t)},e.nu=function(t,n){var r=e.su,i=r.get(t);i||(i=new WeakMap,r.set(t,i));var o=i.get(n);return o||(o=new e(t,new Bi(t),n),i.set(n,o)),o},e}();Ki.su=new WeakMap;var ye=function(){function e(t,n){this.firestore=t,this._delegate=n,this._userDataWriter=new Bi(t)}return e.iu=function(t,n,r){if(t.length%2!=0)throw new b(y.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new e(n,new H(n._delegate,r,new C(t)))},e.eu=function(t,n,r){return new e(n,new H(n._delegate,r,t))},Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new _r(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new _r(this.firestore,kl(this._delegate,t))}catch(n){throw It(n,"collection()","DocumentReference.collection()")}},e.prototype.isEqual=function(t){return(t=W(t))instanceof H&&Pl(this._delegate,t)},e.prototype.set=function(t,n){n=zs("DocumentReference.set",n);try{return function(r,i,o){r=j(r,H);var s=j(r.firestore,Z),a=qi(r.converter,i,o);return wr(s,[Vi(Le(s),"setDoc",r._key,a,r.converter!==null,o).toMutation(r._key,dt.none())])}(this._delegate,t,n)}catch(r){throw It(r,"setDoc()","DocumentReference.set()")}},e.prototype.update=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];try{return arguments.length===1?rf(this._delegate,t):rf.apply(void 0,z([this._delegate,t,n],r))}catch(o){throw It(o,"updateDoc()","DocumentReference.update()")}},e.prototype.delete=function(){return wr(j((t=this._delegate).firestore,Z),[new or(t._key,dt.none())]);var t},e.prototype.onSnapshot=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=hf(n),o=lf(n,function(s){return new An(t.firestore,new $t(t.firestore._delegate,t._userDataWriter,s._key,s._document,s.metadata,t._delegate.converter))});return of(this._delegate,i,o)},e.prototype.get=function(t){var n=this;return((t==null?void 0:t.source)==="cache"?function(r){r=j(r,H);var i=j(r.firestore,Z),o=gt(i),s=new Ve(i);return function(a,u){var c=this,h=new yt;return a.asyncQueue.enqueueAndForget(function(){return m(c,void 0,void 0,function(){var f;return g(this,function(l){switch(l.label){case 0:return f=function(d,p,v){return m(this,void 0,void 0,function(){var w,E;return g(this,function(A){switch(A.label){case 0:return A.trys.push([0,2,,3]),[4,function(D,k){var M=T(D);return M.persistence.runTransaction("read document","readonly",function(q){return M.Mn.mn(q,k)})}(d,p)];case 1:return(E=A.sent()).isFoundDocument()?v.resolve(E):E.isNoDocument()?v.resolve(null):v.reject(new b(y.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return w=A.sent(),E=En(w,"Failed to get document '"+p+" from cache"),v.reject(E),[3,3];case 3:return[2]}})})},[4,bl(a)];case 1:return[2,f.apply(void 0,[l.sent(),u,h])]}})})}),h.promise}(o,r._key).then(function(a){return new $t(i,s,r._key,a,new Fe(a!==null&&a.hasLocalMutations,!0),r.converter)})}(this._delegate):(t==null?void 0:t.source)==="server"?function(r){r=j(r,H);var i=j(r.firestore,Z);return Il(gt(i),r._key,{source:"server"}).then(function(o){return Js(i,r,o)})}(this._delegate):function(r){r=j(r,H);var i=j(r.firestore,Z);return Il(gt(i),r._key).then(function(o){return Js(i,r,o)})}(this._delegate)).then(function(r){return new An(n.firestore,new $t(n.firestore._delegate,n._userDataWriter,r._key,r._document,r.metadata,n._delegate.converter))})},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(Ki.nu(this.firestore,t)):this._delegate.withConverter(null))},e}();function It(e,t,n){return e.message=e.message.replace(t,n),e}function hf(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(typeof r=="object"&&!Sn(r))return r}return{}}function lf(e,t){var n,r,i;return{next:function(o){i.next&&i.next(t(o))},error:(n=(i=Sn(e[0])?e[0]:Sn(e[1])?e[1]:typeof e[0]=="function"?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)===null||n===void 0?void 0:n.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var An=function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"ref",{get:function(){return new ye(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(t){return this._delegate.data(t)},e.prototype.get=function(t,n){return this._delegate.get(t,n)},e.prototype.isEqual=function(t){return Wl(this._delegate,t._delegate)},e}(),Dn=function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return R(t,e),t.prototype.data=function(n){return this._delegate.data(n)},t}(An),br=function(){function e(t,n){this.firestore=t,this._delegate=n,this._userDataWriter=new Bi(t)}return e.prototype.where=function(t,n,r){try{return new e(this.firestore,pe(this._delegate,function(i,o,s){var a=o,u=ji("where",i);return new By(u,a,s)}(t,n,r)))}catch(i){throw It(i,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.orderBy=function(t,n){try{return new e(this.firestore,pe(this._delegate,function(r,i){i===void 0&&(i="asc");var o=i,s=ji("orderBy",r);return new Ky(s,o)}(t,n)))}catch(r){throw It(r,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.limit=function(t){try{return new e(this.firestore,pe(this._delegate,function(n){return Ol("limit",n),new Xl("limit",n,"F")}(t)))}catch(n){throw It(n,"limit()","Query.limit()")}},e.prototype.limitToLast=function(t){try{return new e(this.firestore,pe(this._delegate,function(n){return Ol("limitToLast",n),new Xl("limitToLast",n,"L")}(t)))}catch(n){throw It(n,"limitToLast()","Query.limitToLast()")}},e.prototype.startAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,pe(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new $l("startAt",r,!0)}.apply(void 0,t)))}catch(r){throw It(r,"startAt()","Query.startAt()")}},e.prototype.startAfter=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,pe(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new $l("startAfter",r,!1)}.apply(void 0,t)))}catch(r){throw It(r,"startAfter()","Query.startAfter()")}},e.prototype.endBefore=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,pe(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new Jl("endBefore",r,!0)}.apply(void 0,t)))}catch(r){throw It(r,"endBefore()","Query.endBefore()")}},e.prototype.endAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,pe(this._delegate,function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new Jl("endAt",r,!1)}.apply(void 0,t)))}catch(r){throw It(r,"endAt()","Query.endAt()")}},e.prototype.isEqual=function(t){return Ll(this._delegate,t._delegate)},e.prototype.get=function(t){var n=this;return((t==null?void 0:t.source)==="cache"?function(r){r=j(r,xt);var i=j(r.firestore,Z),o=gt(i),s=new Ve(i);return function(a,u){var c=this,h=new yt;return a.asyncQueue.enqueueAndForget(function(){return m(c,void 0,void 0,function(){var f;return g(this,function(l){switch(l.label){case 0:return f=function(d,p,v){return m(this,void 0,void 0,function(){var w,E,A,D,k;return g(this,function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),[4,Di(d,p,!0)];case 1:return k=M.sent(),w=new cl(p,k.Bn),E=w._o(k.documents),A=w.applyChanges(E,!1),v.resolve(A.snapshot),[3,3];case 2:return D=M.sent(),k=En(D,"Failed to execute query '"+p+" against cache"),v.reject(k),[3,3];case 3:return[2]}})})},[4,bl(a)];case 1:return[2,f.apply(void 0,[l.sent(),u,h])]}})})}),h.promise}(o,r._query).then(function(a){return new de(i,s,r,a)})}(this._delegate):(t==null?void 0:t.source)==="server"?function(r){r=j(r,xt);var i=j(r.firestore,Z),o=gt(i),s=new Ve(i);return Tl(o,r._query,{source:"server"}).then(function(a){return new de(i,s,r,a)})}(this._delegate):function(r){r=j(r,xt);var i=j(r.firestore,Z),o=gt(i),s=new Ve(i);return Yl(r._query),Tl(o,r._query).then(function(a){return new de(i,s,r,a)})}(this._delegate)).then(function(r){return new zi(n.firestore,new de(n.firestore._delegate,n._userDataWriter,n._delegate,r._snapshot))})},e.prototype.onSnapshot=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=hf(n),o=lf(n,function(s){return new zi(t.firestore,new de(t.firestore._delegate,t._userDataWriter,t._delegate,s._snapshot))});return of(this._delegate,i,o)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(Ki.nu(this.firestore,t)):this._delegate.withConverter(null))},e}(),Qy=function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doc",{get:function(){return new Dn(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),e}(),zi=function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"query",{get:function(){return new br(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(n){return new Dn(t._firestore,n)})},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(t){var n=this;return this._delegate.docChanges(t).map(function(r){return new Qy(n._firestore,r)})},e.prototype.forEach=function(t,n){var r=this;this._delegate.forEach(function(i){t.call(n,new Dn(r._firestore,i))})},e.prototype.isEqual=function(t){return Wl(this._delegate,t._delegate)},e}(),_r=function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this).firestore=n,i._delegate=r,i}return R(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var n=this._delegate.parent;return n?new ye(this.firestore,n):null},enumerable:!1,configurable:!0}),t.prototype.doc=function(n){try{return new ye(this.firestore,n===void 0?Fi(this._delegate):Fi(this._delegate,n))}catch(r){throw It(r,"doc()","CollectionReference.doc()")}},t.prototype.add=function(n){var r=this;return function(i,o){var s=j(i.firestore,Z),a=Fi(i),u=qi(i.converter,o);return wr(s,[Vi(Le(i.firestore),"addDoc",a._key,u,i.converter!==null,{}).toMutation(a._key,dt.exists(!1))]).then(function(){return a})}(this._delegate,n).then(function(i){return new ye(r.firestore,i)})},t.prototype.isEqual=function(n){return Pl(this._delegate,n._delegate)},t.prototype.withConverter=function(n){return new t(this.firestore,n?this._delegate.withConverter(Ki.nu(this.firestore,n)):this._delegate.withConverter(null))},t}(br);function Ue(e){return j(e,H)}var ff=function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._delegate=new(Gt.bind.apply(Gt,z([void 0],t)))}return e.documentId=function(){return new e(Vt.keyField().canonicalString())},e.prototype.isEqual=function(t){return(t=W(t))instanceof Gt&&this._delegate._internalPath.isEqual(t._internalPath)},e}(),df=function(){function e(t){this._delegate=t}return e.serverTimestamp=function(){var t=new Ly("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)},e.delete=function(){var t=new Gs("deleteField");return t._methodName="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return new My("arrayUnion",i)}.apply(void 0,t);return r._methodName="FieldValue.arrayUnion",new e(r)},e.arrayRemove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return new Fy("arrayRemove",i)}.apply(void 0,t);return r._methodName="FieldValue.arrayRemove",new e(r)},e.increment=function(t){var n=function(r){return new Vy("increment",r)}(t);return n._methodName="FieldValue.increment",new e(n)},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e}();var Wy={Firestore:ta,GeoPoint:vr,Timestamp:_t,Blob:Zs,Transaction:ea,WriteBatch:na,DocumentReference:ye,DocumentSnapshot:An,Query:br,QueryDocumentSnapshot:Dn,QuerySnapshot:zi,CollectionReference:_r,FieldPath:ff,FieldValue:df,setLogLevel:cf,CACHE_SIZE_UNLIMITED:Ml};function Yy(e){(function(t,n){t.INTERNAL.registerComponent(new Be("firestore",function(r){var i=r.getProvider("app").getImmediate();return n(i,r.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Wy)))})(e,function(t,n){return new ta(t,new Z(t,n),new uf)}),e.registerVersion("@firebase/firestore","2.4.0")}Yy(jt);var Xy={apiKey:"AIzaSyA0ubf-8UyTjJ7FBk6d_yhfPvN27W1aebk",authDomain:"talki-4a1f4.firebaseapp.com",databaseURL:"https://talki-4a1f4-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"talki-4a1f4",storageBucket:"talki-4a1f4.appspot.com",messagingSenderId:"920123086755",appId:"1:920123086755:web:ddc3bdae04b5276e992c16",measurementId:"G-9L3QCRD771"};jt.apps.length||jt.initializeApp(Xy);var pf=jt.firestore(),$y={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10},kt=new RTCPeerConnection($y),Gi=null,ra=null,vf=document.getElementById("webcamButton"),Jy=document.getElementById("webcamVideo"),yf=document.getElementById("callButton"),gf=document.getElementById("callInput"),mf=document.getElementById("answerButton"),Zy=document.getElementById("remoteVideo"),tg=document.getElementById("hangupButton");vf.onclick=async()=>{Gi=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),ra=new MediaStream,Gi.getTracks().forEach(e=>{kt.addTrack(e,Gi)}),kt.ontrack=e=>{e.streams[0].getTracks().forEach(t=>{ra.addTrack(t)})},Jy.srcObject=Gi,Zy.srcObject=ra,yf.disabled=!1,mf.disabled=!1,vf.disabled=!0};yf.onclick=async()=>{let e=pf.collection("calls").doc(),t=e.collection("offerCandidates"),n=e.collection("answerCandidates");gf.value=e.id,kt.onicecandidate=o=>{o.candidate&&t.add(o.candidate.toJSON())};let r=await kt.createOffer();await kt.setLocalDescription(r);let i={sdp:r.sdp,type:r.type};await e.set({offer:i}),e.onSnapshot(o=>{let s=o.data();if(!kt.currentRemoteDescription&&s?.answer){let a=new RTCSessionDescription(s.answer);kt.setRemoteDescription(a)}}),n.onSnapshot(o=>{o.docChanges().forEach(s=>{if(s.type==="added"){let a=new RTCIceCandidate(s.doc.data());kt.addIceCandidate(a)}})}),tg.disabled=!1};mf.onclick=async()=>{let e=gf.value,t=pf.collection("calls").doc(e),n=t.collection("answerCandidates"),r=t.collection("offerCandidates");kt.onicecandidate=u=>{u.candidate&&n.add(u.candidate.toJSON())};let o=(await t.get()).data().offer;await kt.setRemoteDescription(new RTCSessionDescription(o));let s=await kt.createAnswer();await kt.setLocalDescription(s);let a={type:s.type,sdp:s.sdp};await t.update({answer:a}),r.onSnapshot(u=>{u.docChanges().forEach(c=>{if(console.log(c),c.type==="added"){let h=c.doc.data();kt.addIceCandidate(new RTCIceCandidate(h))}})})};})();
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

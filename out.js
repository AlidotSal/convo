(()=>{var g=(Math.random()*1e4).toString().substr(0,4),n,a,s,r,i=!0,t=new Peer(g),c=document.getElementById("localVideo"),l=document.getElementById("remoteVideo"),p=document.getElementById("callButton"),v=document.getElementById("answer"),y=document.getElementById("camera"),B=document.getElementById("mic"),b=document.getElementById("camSwitch"),I=document.getElementById("hangUp"),h=document.getElementById("toggleFullScreen"),m=document.getElementById("input"),f=document.getElementById("number"),k=document.getElementById("text"),T=document.getElementById("send"),w=document.getElementById("chat");function E(e){c.classList.add("small"),l.classList.add("active"),l.srcObject=e}window.onload=async()=>{n=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0})};var j=document.createTextNode(g);f.appendChild(j);b.addEventListener("click",async()=>{i=!i,c.srcObject.getTracks().forEach(e=>{e.stop()}),n=await navigator.mediaDevices.getUserMedia({audio:!0,video:{facingMode:i?"user":"environment"}}),c.srcObject=n});y.addEventListener("click",()=>{a.getVideoTracks()[0].enabled=!a.getVideoTracks()[0].enabled});B.addEventListener("click",async()=>{a.getAuduiTracks()[0].enabled=!a.getAudioTracks()[0].enabled});h.addEventListener("click",()=>L());function L(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}T.addEventListener("click",()=>{r.send(k.value)});I.addEventListener("click",()=>{s.close(),t.disconnect(),t.destroy(),c.srcObject=null,l.srcObject=null});p.onclick=()=>{c.srcObject=n,s=t.call(m.value,n,{sdpTransform:e=>{}}),s.on("stream",E),r=t.connect(m.value)};t.on("call",e=>{let o=document.createElement("H2"),d=document.createTextNode(`The ID ${e.peer} is calling...`);o.appendChild(d),document.body.appendChild(o),v.addEventListener("click",()=>{e.answer(n,{sdpTransform:u=>{}}),c.srcObject=n,e.on("stream",E),r=t.connect(m.value)})});t.on("connection",function(e){e.on("open",function(){e.on("data",function(o){let d=document.createElement("P"),u=document.createTextNode(o);d.appendChild(u),w.appendChild(d)})})});t.on("disconnected",()=>{t.destroy(),c.srcObject=null,l.srcObject=null});})();

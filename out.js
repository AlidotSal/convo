(()=>{var u=(Math.random()*1e4).toString().substr(0,4),s,o,a,i;var t=new Peer(u),d=document.getElementById("localVideo"),l=document.getElementById("remoteVideo"),g=document.getElementById("callButton"),m=document.getElementById("answer"),v=document.getElementById("camera"),p=document.getElementById("mic"),E=document.getElementById("hangUp"),b=document.getElementById("toggleFullScreen"),B=document.getElementById("input"),h=document.getElementById("number"),y=document.getElementById("text"),T=document.getElementById("send"),L=document.getElementById("chat"),f=document.getElementsByClassName("messaging-area")[0];function I(e){d.classList.add("small"),l.classList.add("active"),l.srcObject=e,g.classList.remove("visiable"),m.classList.remove("visiable"),f.classList.add("visiable"),E.classList.add("visiable"),b.classList.add("visiable"),v.classList.add("visiable"),p.classList.add("visiable"),d.srcObject=s}window.onload=async()=>{s=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0})};var k=document.createTextNode(u);h.appendChild(k);v.addEventListener("click",()=>{o.getVideoTracks()[0].enabled=!o.getVideoTracks()[0].enabled});p.addEventListener("click",async()=>{o.getAuduiTracks()[0].enabled=!o.getAudioTracks()[0].enabled});b.addEventListener("click",()=>w());function w(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}T.addEventListener("click",()=>{let e=document.createElement("P"),n=document.createTextNode(y.value);e.appendChild(n),L.appendChild(e),e.classList.add("sent"),i.send(y.value)});E.addEventListener("click",()=>{a.close(),t.disconnect(),t.destroy(),d.srcObject=null,l.srcObject=null});g.onclick=()=>{d.srcObject=s,a=t.call(B.value,s,{sdpTransform:e=>{}}),a.on("stream",I),i=t.connect(B.value)};t.on("call",e=>{let n=document.createElement("H2"),c=document.createTextNode(`The ID ${e.peer} is calling...`);n.appendChild(c),document.body.appendChild(n),m.classList.add("visiable"),m.addEventListener("click",()=>{e.answer(s,{sdpTransform:r=>{}}),n.remove(),e.on("stream",I),i=t.connect(e.peer)})});t.on("connection",function(e){e.on("open",function(){e.on("data",function(n){console.log(n);let c=document.createElement("P"),r=document.createTextNode(n);c.appendChild(r),L.appendChild(c),c.classList.add("received")})})});t.on("disconnected",()=>{t.destroy(),d.srcObject=null,l.srcObject=null});})();

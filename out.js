(()=>{var i=(Math.random()*1e4).toString().substr(0,4),n,a,m,s=!0,c=new Peer(i),o=document.getElementById("localVideo"),t=document.getElementById("remoteVideo"),E=document.getElementById("callButton"),B=document.getElementById("answer"),v=document.getElementById("camera"),b=document.getElementById("mic"),y=document.getElementById("camSwitch"),p=document.getElementById("hangUp"),I=document.getElementById("toggleFullScreen"),r=document.getElementById("input"),h=document.getElementById("number"),k=document.getElementById("text"),w=document.getElementById("send"),f=document.getElementById("chat");function u(e){o.classList.add("small"),t.classList.add("active"),t.srcObject=e}window.onload=async()=>{n=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0})};var T=document.createTextNode(i);h.appendChild(T);y.addEventListener("click",async()=>{s=!s,o.srcObject.getTracks().forEach(e=>{e.stop()}),n=await navigator.mediaDevices.getUserMedia({audio:!0,video:{facingMode:s?"user":"environment"}}),o.srcObject=n});v.addEventListener("click",()=>{t.getVideoTracks()[0].enabled=!t.getVideoTracks()[0].enabled});b.addEventListener("click",async()=>{t.getAuduiTracks()[0].enabled=!t.getAudioTracks()[0].enabled});I.addEventListener("click",()=>j());function j(){document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():document.documentElement.requestFullscreen()}E.onclick=()=>{o.srcObject=n,a=c.call(r.value,n),a.on("stream",u),m=c.connect(r.value)};c.on("call",e=>{let d=document.createElement("H2"),l=document.createTextNode(`The ID ${e.peer} is calling...`);d.appendChild(l),document.body.appendChild(d),B.addEventListener("click",()=>{e.answer(n),o.srcObject=n,e.on("stream",u)})});c.on("connection",function(e){e.on("data",function(d){let l=document.createElement("P"),g=document.createTextNode(d);l.appendChild(g),f.appendChild(l)}),w.addEventListener("click",()=>{m.send(k.value)})});p.addEventListener("click",()=>{a.close(),c.disconnect(),o.srcObject=null,t.srcObject=null});c.on("close",()=>{c.disconnect(),o.srcObject=null,t.srcObject=null});})();
